var cs=Object.defineProperty;var ds=(t,a,o)=>a in t?cs(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;var Vt=(t,a,o)=>ds(t,typeof a!="symbol"?a+"":a,o);import{j as e,u as et,r as s,W as us,G as xa,T as ha,o as fs,_ as ya,B as ms,a as gs,L as hs,i as ps,b as bs,c as ws,R as xs,d as Na}from"./vendor-CCrPfgt9.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=o(r);fetch(r.href,i)}})();const da=[{code:"auto",name:"languages.autoDetect"},{code:"en",name:"languages.english",asrCode:"en"},{code:"zh-Hant",name:"languages.chineseTraditional",asrCode:"zh"},{code:"zh-Hant-HK",name:"languages.chineseTraditionalHK",asrCode:"zh"},{code:"zh-Hans",name:"languages.chineseSimplified",asrCode:"zh"},{code:"es",name:"languages.spanish",asrCode:"es"},{code:"ja",name:"languages.japanese",asrCode:"ja"},{code:"fr",name:"languages.french",asrCode:"fr"},{code:"de",name:"languages.german",asrCode:"de"},{code:"ko",name:"languages.korean",asrCode:"ko"},{code:"ru",name:"languages.russian",asrCode:"ru"},{code:"it",name:"languages.italian",asrCode:"it"}],ua=[{name:"Gemma-3n-E2B (3.04 GB)",value:"gemma-3n-E2B-it-int4-Web.litertlm",url:"https://huggingface.co/willopcbeta/Gemma-3n-Web/resolve/main/gemma-3n-E2B-it-int4-Web.litertlm"},{name:"Gemma-3n-E4B (4.28 GB)",value:"gemma-3n-E4B-it-int4-Web.litertlm",url:"https://huggingface.co/willopcbeta/Gemma-3n-Web/resolve/main/gemma-3n-E4B-it-int4-Web.litertlm"},{name:"Gemma-3-4B (2.4 GB)",value:"gemma3-4b-it-int4-web.task",url:"https://huggingface.co/willopcbeta/Gemma-3n-Web/resolve/main/gemma3-4b-it-int4-web.task"}],Qe=[{id:"nicky48/whisper-large-v3-turbo-ONNX",name:"whisper-large-v3-turbo (q4f16)",quantization:{encoder_model:"q4f16",decoder_model_merged:"q4f16"},size:"~600 MB"},{id:"Xenova/whisper-small",name:"Whisper small (q4)",quantization:{encoder_model:"q4",decoder_model_merged:"q4"},size:"~300 MB"},{id:"Xenova/whisper-base",name:"Whisper Base (q4)",quantization:{encoder_model:"q4",decoder_model_merged:"q4"},size:"~150 MB"}],fa={ch_v5:{name:"ch_PP-OCRv5_mobile",description:"Chinese/English/Japanese",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/ch_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/ch_PP-OCRv5_rec_mobile_infer/ppocrv5_dict.txt"}},latin_v5:{name:"latin_PP-OCRv5_mobile",description:"Latin languages (French, German, Spanish, etc.)",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/latin_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/latin_PP-OCRv5_rec_mobile_infer/ppocrv5_latin_dict.txt"}},kr_v5:{name:"korean_PP-OCRv5_mobile",description:"Korean Only",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/korean_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/korean_PP-OCRv5_rec_mobile_infer/ppocrv5_korean_dict.txt"}}},ys=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),vs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4a4 4 0 100 8 4 4 0 000-8zM8 21v-2a4 4 0 014-4h0a4 4 0 014 4v2"})}),Ss=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4a4 4 0 100 8 4 4 0 000-8zM6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"})}),js=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),Cs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),ks=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),Os=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),Is=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),As=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5h12M9 3v2m4 13-4-4-4 4M5 11h10a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2a2 2 0 012-2zM19 9l-2 2-2-2"})}),Yt=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),Ls=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16V4m0 12L4 9m3 3l3-3m6 8V4m0 12l3-3m-3 3l-3-3"})}),Ns=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 1l4 4-4 4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 11V9a4 4 0 014-4h14"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 23l-4-4 4-4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13v2a4 4 0 01-4 4H3"})]}),Ba=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),wa=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Rs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),Es=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825L10 14h- hükümet 3L13 10V3L5.125 10.125m13.75 3.75L15 10m-2.125 8.825L18 14h-3l-1.875 4.825zM1 1l22 22"})}),Ms=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Ts=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.111 16.222c1.733-1.733 4.589-1.733 6.322 0M5.444 13.556c3.222-3.222 8.444-3.222 11.667 0M2.778 10.889c4.711-4.711 12.333-4.711 17.044 0"})}),Ps=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.111 16.222c1.733-1.733 4.589-1.733 6.322 0M5.444 13.556c.9-1.033 2.022-1.9 3.222-2.589m5.667.122c.711.389 1.356.844 1.933 1.389M2.778 10.889a14.838 14.838 0 012.667-3.022m11.6.022a14.833 14.833 0 012.667 3.022M1 1l22 22"})}),Ds=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 017.5 5.25h9a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-9z"})}),_a=({selectedLang:t,setSelectedLang:a,languages:o})=>{const{t:n}=et(),[r,i]=s.useState(!1),[d,u]=s.useState("bottom"),c=s.useRef(null),y=s.useRef(null),b=p=>{a(p),i(!1)};s.useEffect(()=>{if(r&&y.current){const p=y.current.getBoundingClientRect(),S=240;window.innerHeight-p.bottom<S&&p.top>S?u("top"):u("bottom")}},[r]),s.useEffect(()=>{const p=S=>{c.current&&!c.current.contains(S.target)&&i(!1)};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[]);const m=d==="top"?"bottom-full mb-2":"mt-2";return e.jsxs("div",{className:"relative",ref:c,children:[e.jsxs("button",{ref:y,onClick:()=>i(!r),className:"flex items-center space-x-2 text-lg font-semibold text-gray-700 hover:text-blue-600",children:[e.jsx("span",{children:n(t.name)}),e.jsx(ks,{className:`h-2.5 w-2.5 transition-transform ${r?"rotate-180":""}`})]}),r&&e.jsx("div",{className:`absolute z-10 ${m} w-56 bg-white rounded-md shadow-lg border border-gray-100 max-h-60 overflow-y-auto`,children:e.jsx("ul",{className:"py-1",children:o.map(p=>e.jsx("li",{children:e.jsx("button",{onClick:()=>b(p),className:`w-full text-left px-4 py-2 text-sm ${t.code===p.code?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-100"}`,children:n(p.name)})},p.code))})})]})},Ra=3e3,Fs=({inputText:t,setInputText:a,sourceLang:o,setSourceLang:n,isLoading:r,onTranslate:i,onCancel:d,isRecording:u,onToggleRecording:c,onOpenCamera:y,onOpenSettings:b,isOnline:m,isOfflineModeEnabled:p,isOfflineModelReady:S,recordingCountdown:v})=>{const{t:k}=et(),A=I=>{I.target.value.length<=Ra&&a(I.target.value)},R=!t.trim()||u||(p?!S:!m),F=()=>{r?d():i()};return e.jsxs("div",{className:"bg-white rounded-xl shadow-md h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(_a,{selectedLang:o,setSelectedLang:n,languages:da}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-500",children:[e.jsx("div",{title:k(m?"translationInput.online":"translationInput.offline"),children:m?e.jsx(Ts,{className:"text-green-500"}):e.jsx(Ps,{className:"text-gray-400"})}),e.jsx("button",{onClick:y,className:"hover:text-blue-500","aria-label":k("translationInput.cameraAriaLabel"),children:e.jsx(Os,{})}),e.jsx("button",{onClick:b,className:"hover:text-blue-500","aria-label":k("translationInput.settingsAriaLabel"),children:e.jsx(Is,{})})]})]}),e.jsxs("div",{className:"relative border border-gray-200 rounded-lg flex-grow",children:[e.jsx("textarea",{value:t,onChange:A,placeholder:k(u?"translationInput.placeholderListening":"translationInput.placeholderEnterText"),className:"w-full h-full p-4 pr-12 text-lg border-none focus:ring-0 resize-none bg-transparent",disabled:u}),t&&!u&&e.jsx("button",{onClick:()=>a(""),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600","aria-label":k("translationInput.clearText"),children:e.jsx(Yt,{})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-sm text-gray-400 w-20",children:u&&p&&v!==null?e.jsxs("span",{className:"text-red-500 font-semibold text-base tabular-nums",children:[k("translationInput.countdownPrefix"),String(v).padStart(2,"0")]}):`${t.length}/${Ra}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:c,className:`p-3 rounded-lg flex items-center justify-center transition-colors ${u?"bg-red-500 text-white animate-pulse":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,"aria-label":k(u?"translationInput.recordingStop":"translationInput.recordingStart"),children:e.jsx(Ba,{})}),e.jsx("button",{onClick:F,disabled:!r&&R,title:k(r?"translationInput.cancelTranslation":p?"translationInput.translateOffline":"translationInput.translate"),className:`text-white rounded-lg p-3 flex items-center justify-center transition-colors ${r?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed"}`,children:r?e.jsx(Ds,{}):e.jsx(As,{})})]})]})]})},zs=({translatedText:t,targetLang:a,setTargetLang:o,isLoading:n,onSpeak:r,onSwapLanguages:i,onOpenHistory:d,onClearText:u,isOfflineModeEnabled:c,isOfflineModelInitializing:y,isOfflineModelReady:b,offlineModelName:m,isSpeaking:p,speakingGender:S,onlineProvider:v,isOfflineTtsEnabled:k,isAstRecording:A,onToggleAstRecording:R,recordingCountdown:F})=>{const{t:I}=et(),[X,ae]=s.useState(!1),ee=()=>{t&&navigator.clipboard.writeText(t)},Y=()=>{ae(B=>!B)},ue=()=>{if(!c){const oe=v.charAt(0).toUpperCase()+v.slice(1);return I("translationOutput.modeOnline",{provider:oe})}const B=ua.find(oe=>oe.value===m),M=B?B.name.split(" ")[0]:"";return y?I("translationOutput.modeOfflineInitializing",{modelName:M}):b?I("translationOutput.modeOfflineReady",{modelName:M}):m?I("translationOutput.modeOfflineNotReady",{modelName:M}):I("translationOutput.modeOfflineNoModel")};return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-4 h-full flex flex-col transition-transform duration-500 ease-in-out ${X?"rotate-180":""}`,children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx(_a,{selectedLang:a,setSelectedLang:o,languages:da.filter(B=>B.code!=="auto")}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-500",children:e.jsx(Ls,{})}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-500",children:[e.jsx("button",{onClick:Y,className:"hover:text-blue-500","aria-label":I("translationOutput.flipScreenAriaLabel"),children:e.jsx(Ns,{})}),e.jsx("button",{onClick:ee,disabled:!t,className:"hover:text-blue-500 disabled:text-gray-300 disabled:cursor-not-allowed","aria-label":I("translationOutput.copyAriaLabel"),children:e.jsx(js,{})}),e.jsx("button",{onClick:d,className:"hover:text-blue-500","aria-label":I("translationOutput.historyAriaLabel"),children:e.jsx(Cs,{})}),e.jsx("button",{onClick:u,disabled:!t,className:"hover:text-red-500 disabled:text-gray-300 disabled:cursor-not-allowed","aria-label":I("translationOutput.clearAriaLabel"),children:e.jsx(Yt,{})})]})]}),e.jsx("div",{className:"text-right text-xs text-gray-400 mb-2 px-1",children:ue()})]}),e.jsx("div",{className:"text-2xl text-gray-800 break-words flex-grow overflow-y-auto min-h-0 whitespace-pre-wrap",children:n&&!t?e.jsxs("div",{className:"space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2"})]}):t||e.jsx("span",{className:"text-gray-400",children:I("translationOutput.placeholder")})}),e.jsxs("div",{className:"flex items-center justify-start mt-4 space-x-2 flex-shrink-0",children:[k?e.jsx("button",{onClick:()=>r("female"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors ${p?"bg-indigo-600 animate-pulse":"bg-indigo-500 hover:bg-indigo-600"}`,"aria-label":I(p?"translationOutput.speakStop":"translationOutput.speakCustomVoice"),children:e.jsx(ys,{})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("female"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-pink-200 disabled:cursor-not-allowed transition-colors ${p&&S==="female"?"bg-pink-600 animate-pulse":"bg-pink-400 hover:bg-pink-500"}`,"aria-label":I(p&&S==="female"?"translationOutput.speakStop":"translationOutput.speakFemale"),children:e.jsx(vs,{})}),e.jsx("button",{onClick:()=>r("male"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors ${p&&S==="male"?"bg-blue-700 animate-pulse":"bg-blue-500 hover:bg-blue-600"}`,"aria-label":I(p&&S==="male"?"translationOutput.speakStop":"translationOutput.speakMale"),children:e.jsx(Ss,{})})]}),e.jsx("button",{onClick:R,disabled:n,className:`text-white rounded-lg p-3 flex items-center justify-center transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed ${A?"bg-red-500 animate-pulse":"bg-indigo-500 hover:bg-indigo-600"}`,"aria-label":I(A?"translationOutput.astStop":"translationOutput.astStart"),title:I("translationOutput.astTitle"),children:e.jsx(Ba,{})}),A&&F!==null?e.jsxs("span",{className:"text-red-500 font-semibold text-base tabular-nums ml-2",children:[I("translationInput.countdownPrefix"),String(F).padStart(2,"0")]}):null]})]})},Bs=({onClose:t,onImageCaptured:a})=>{const{t:o}=et(),n=s.useRef(null),r=s.useRef(null),[i,d]=s.useState(null),[u,c]=s.useState(null),[y,b]=s.useState(!1),m=s.useRef(!1),[p,S]=s.useState(!1),[v,k]=s.useState(!1),[A,R]=s.useState(0),[F,I]=s.useState(!1),[X,ae]=s.useState({min:1,max:1}),ee=s.useCallback((L,T,N)=>T===N?T:T*Math.pow(N/T,L/100),[]),Y=s.useCallback((L,T,N)=>T===N?0:Math.log(L/T)/Math.log(N/T)*100,[]),ue=s.useCallback(L=>{d(L);const T=L.getVideoTracks()[0];if(!T)return;const N=T.getCapabilities()||{};if(N.torch&&k(!0),N.zoom){I(!0),ae({min:N.zoom.min,max:N.zoom.max});const te=T.getSettings().zoom||N.zoom.min;R(Y(te,N.zoom.min,N.zoom.max))}},[Y]),B=async L=>{if(!i||!F||m.current)return;const T=parseFloat(L.target.value);R(T);const N=ee(T,X.min,X.max),te=i.getVideoTracks()[0];try{m.current=!0,await te.applyConstraints({advanced:[{zoom:N}]})}catch(fe){console.error("Failed to apply zoom:",fe)}finally{m.current=!1}},M=async()=>{if(!i||!v||m.current)return;const L=!p,T=i.getVideoTracks()[0];try{m.current=!0,await T.applyConstraints({advanced:[{torch:L}]}),S(L)}catch(N){console.error("Failed to apply torch:",N)}finally{m.current=!1}},oe=s.useCallback(()=>{if(!(y||!n.current)){b(!0),c(null);try{const L=n.current.getScreenshot({width:1920,height:1080});if(L)a(L);else throw new Error("Could not get screenshot from camera.")}catch(L){const T=L instanceof Error?L.message:"Capture failed.";c(o("camera.errorCapture",{message:T})),b(!1)}}},[y,a,o]),$=L=>{var N;const T=(N=L.target.files)==null?void 0:N[0];if(!(!T||y)){b(!0);try{const te=new FileReader;te.onload=fe=>{var G;const Oe=(G=fe.target)==null?void 0:G.result;Oe&&a(Oe)},te.readAsDataURL(T)}catch{c(o("camera.errorLoad",{message:"File read error"})),b(!1)}}},ke={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}};return e.jsx("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center overflow-hidden",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(us,{ref:n,audio:!1,screenshotFormat:"image/jpeg",screenshotQuality:1,videoConstraints:ke,onUserMedia:ue,onUserMediaError:L=>c(o("camera.errorAccess")),className:"w-full h-full object-cover"}),e.jsx("input",{type:"file",accept:"image/*",ref:r,onChange:$,className:"hidden"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-between items-center p-4 z-20 pointer-events-none",children:[e.jsxs("div",{className:"w-full flex justify-between items-start pointer-events-auto",children:[e.jsx("div",{className:"text-white text-xs font-medium bg-black/40 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-white/10"}),e.jsx("button",{onClick:t,className:"text-white bg-black/40 backdrop-blur-sm rounded-full p-2 border border-white/10 hover:bg-black/60 transition-colors shadow-lg","aria-label":o("camera.closeAriaLabel"),children:e.jsx(Yt,{className:"w-8 h-8"})})]}),u&&e.jsx("div",{className:"bg-red-600 text-white px-4 py-2 rounded-full text-sm shadow-xl pointer-events-auto animate-bounce",role:"alert",children:u}),e.jsxs("div",{className:"w-full flex flex-col items-center pb-8 space-y-6 pointer-events-auto",children:[F&&e.jsxs("div",{className:"w-full max-w-xs flex flex-col items-center space-y-2",children:[e.jsxs("div",{className:"flex justify-between w-full px-2 text-[10px] text-white/70 font-bold uppercase tracking-widest",children:[e.jsx("span",{children:"1x"}),e.jsxs("span",{className:"bg-blue-500/80 px-2 py-0.5 rounded text-white",children:[ee(A,X.min,X.max).toFixed(1),"x"]}),e.jsxs("span",{children:[X.max.toFixed(0),"x"]})]}),e.jsx("div",{className:"w-full h-12 flex items-center px-2 bg-black/30 backdrop-blur-md rounded-2xl border border-white/5",children:e.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:A,onChange:B,className:"w-full h-1.5 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-500","aria-label":o("camera.zoomAriaLabel")})})]}),e.jsxs("div",{className:"w-full flex justify-around items-center max-w-sm",children:[e.jsx("button",{onClick:()=>{var L;return(L=r.current)==null?void 0:L.click()},className:"p-3 bg-white/10 backdrop-blur-md rounded-full border border-white/20 text-white hover:bg-white/20 transition-all shadow-lg","aria-label":o("camera.galleryAriaLabel"),children:e.jsx(Ms,{className:"w-8 h-8"})}),e.jsxs("button",{onClick:oe,disabled:y,className:"group relative w-20 h-20 flex items-center justify-center disabled:opacity-50","aria-label":o("camera.captureAriaLabel"),children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full animate-pulse group-hover:bg-white/30"}),e.jsx("div",{className:"relative w-16 h-16 bg-white rounded-full shadow-2xl flex items-center justify-center transition-transform active:scale-90",children:y&&e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin",role:"status","aria-label":o("camera.processingAriaLabel")})})]}),v?e.jsx("button",{onClick:M,className:`p-3 backdrop-blur-md rounded-full border transition-all shadow-lg ${p?"bg-yellow-400 border-yellow-500 text-black":"bg-white/10 border-white/20 text-white hover:bg-white/20"}`,"aria-label":o(p?"camera.flashOnAriaLabel":"camera.flashOffAriaLabel"),children:p?e.jsx(Rs,{className:"w-8 h-8"}):e.jsx(Es,{className:"w-8 h-8"})}):e.jsx("div",{className:"w-14 h-14"})]})]})]})]})})},_s=({isOpen:t,onClose:a,onSave:o,currentApiKey:n,currentModelName:r,currentOnlineProvider:i,currentOpenaiApiUrl:d,currentHuggingFaceApiKey:u,currentOfflineModelName:c,currentIsOfflineModeEnabled:y,currentIsTwoStepJpCnEnabled:b,downloadProgress:m,onStartDownload:p,onResumeDownload:S,onPauseDownload:v,onDeleteModel:k,isOfflineModelInitializing:A,voices:R,targetLang:F,currentIsOfflineTtsEnabled:I,currentOfflineTtsVoiceURI:X,currentOfflineTtsRate:ae,currentOfflineTtsPitch:ee,currentOfflineMaxTokens:Y,currentOfflineTopK:ue,currentOfflineTemperature:B,currentOfflineRandomSeed:M,currentOfflineSupportAudio:oe,currentOfflineMaxNumImages:$,currentIsOfflineAsrEnabled:ke,currentIsWebSpeechApiEnabled:L,currentAsrModelId:T,currentIsNoiseCancellationEnabled:N,currentAudioGainValue:te,asrModelsCacheStatus:fe,isAsrInitializing:Oe,asrLoadingProgress:G,onDownloadAsrModel:Zt,onClearAsrCache:Ie,ocrEngineStatus:Ae,ocrEngineError:Sa,onInitializeOcr:ma,currentSelectedOcrModel:Le,currentIsOcrAutoInitEnabled:At})=>{const{t:x,i18n:Lt}=et(),[me,Ne]=s.useState("online"),[Re,Ee]=s.useState("models"),[ve,tt]=s.useState(n),[at,st]=s.useState(r),[Se,$e]=s.useState(i),[nt,ot]=s.useState(d),[z,Nt]=s.useState(u),[rt,it]=s.useState(c),[J,we]=s.useState(y),[Me,Te]=s.useState(b),[K,Ue]=s.useState(ke),[lt,ct]=s.useState(L),[We,dt]=s.useState(T),[ut,ft]=s.useState(N),[ge,mt]=s.useState(te),[Pe,gt]=s.useState(I),[V,He]=s.useState(X),[q,ht]=s.useState(ae),[je,pt]=s.useState(ee),[re,Ge]=s.useState([]),[Rt,De]=s.useState(Y),[Qt,Je]=s.useState(ue),[ea,Ke]=s.useState(B),[Fe,bt]=s.useState(M),[ze,qe]=s.useState(oe),[Et,Ve]=s.useState($),[Xe,Be]=s.useState(Le),[se,Mt]=s.useState(At);if(s.useEffect(()=>{t&&(tt(n),st(r),$e(i),ot(d),Nt(u),it(c),we(y),Te(b),gt(I),He(X),ht(ae),pt(ee),De(Y),Je(ue),Ke(B),bt(M),qe(oe),Ve($),Ue(ke),ct(L),dt(T),ft(N),mt(te),Be(Le),Mt(At))},[t,n,r,i,d,u,c,y,b,I,X,ae,ee,Y,ue,B,M,oe,$,ke,L,T,N,te,Le,At]),s.useEffect(()=>{var f;if(t&&R.length>0&&F){const O=R.filter(U=>U.lang.startsWith(F.code));Ge(O),V&&!O.some(U=>U.voiceURI===V)&&He(((f=O[0])==null?void 0:f.voiceURI)||"")}},[t,R,F,V]),!t)return null;const ta=()=>{o(ve,at,z,rt,We,J,K,lt,Se,nt,Pe,V,q,je,Me,Rt,Qt,ea,Fe,ze,Et,ut,ge,Xe,se),a()},Tt=()=>{tt(""),st("gemini-3-flash-preview"),$e("gemini"),ot(""),Nt(""),it(""),we(!1),Te(!1),gt(!1),He(""),ht(1),pt(1),De(4096),Je(40),Ke(.3),bt(10),qe(!1),Ve(0),Be("ch_v5"),Mt(!1),Ue(!1),ct(!0),dt(Qe[0].id),ft(!1),mt(1),Ie(),ua.forEach(f=>f.value&&k(f.value)),o("","gemini-3-flash-preview","","",Qe[0].id,!1,!1,!0,"gemini","",!1,"",1,1,!1,4096,40,.3,10,!1,0,!1,0,"ch_v5",!1)},aa=f=>{it(f.target.value)},wt=f=>{dt(f.target.value)},sa=async()=>{const f={key:Xe,...fa[Xe].paths};await ma(f)},he=({tabName:f,label:O})=>e.jsx("button",{onClick:()=>Ne(f),className:`px-4 py-2 text-sm font-medium rounded-md focus:outline-none ${me===f?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"}`,"aria-selected":me===f,role:"tab",children:O}),Pt=({subTabName:f,label:O})=>e.jsx("button",{onClick:()=>Ee(f),className:`w-full px-4 py-2 text-sm font-medium rounded-md focus:outline-none transition-colors ${Re===f?"bg-white text-blue-700 shadow-sm":"text-gray-500 hover:bg-gray-200"}`,"aria-selected":Re===f,role:"tab",children:O}),xt=(f,O=2)=>{if(!f||f===0)return"0 Bytes";const U=1024,P=O<0?0:O,C=["Bytes","KB","MB","GB","TB"],_=Math.floor(Math.log(f)/Math.log(U));return parseFloat((f/Math.pow(U,_)).toFixed(P))+" "+C[_]},yt=f=>{const O=m[f.value]||{status:"not_started",percent:0,downloaded:0,total:0},U=A&&rt===f.value,P=({onClick:pe,text:ne,className:le="bg-blue-500 hover:bg-blue-600",disabled:vt})=>e.jsx("button",{onClick:pe,disabled:vt,className:`text-white text-xs font-semibold py-1 px-3 rounded-md transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed ${le}`,children:ne}),C=U||O.status==="consolidating",_=O.status,Ye=x(`common.status.${_}`);return e.jsxs("div",{className:"flex flex-col space-y-2 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`model-${f.value}`,name:"offline-model-selection",value:f.value,checked:rt===f.value,onChange:aa,disabled:O.status!=="completed"||C,className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:`model-${f.value}`,className:"ml-2 text-sm font-medium text-gray-800",children:f.name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[O.status==="not_started"&&e.jsx(P,{onClick:()=>p(f.value,f.url),text:x("settings.download")}),O.status==="downloading"&&e.jsx(P,{onClick:()=>v(f.value),text:x("settings.pause"),className:"bg-yellow-500 hover:bg-yellow-600"}),O.status==="paused"&&e.jsx(P,{onClick:()=>S(f.value,f.url),text:x("settings.resume")}),O.status==="error"&&e.jsx(P,{onClick:()=>S(f.value,f.url),text:x("settings.retry")}),O.status!=="not_started"&&O.status!=="downloading"&&O.status!=="consolidating"&&e.jsx("button",{onClick:()=>k(f.value),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-full","aria-label":x("settings.deleteModelAriaLabel",{modelName:f.name}),children:e.jsx(wa,{className:"w-4 h-4"})})]})]}),(O.status!=="not_started"||C)&&e.jsxs("div",{children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 relative overflow-hidden",children:e.jsx("div",{className:`h-2 rounded-full ${C?"bg-green-400 w-full animate-pulse":"bg-blue-500"}`,style:{width:`${O.percent}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex justify-between",children:[e.jsx("span",{children:Ye}),O.status==="downloading"&&!C&&e.jsxs("span",{children:[xt(O.downloaded)," / ",xt(O.total)," (",Math.round(O.percent),"%)"]})]})]}),O.status==="error"&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:x("settings.statusError",{error:O.error})})]})},xe=({id:f,label:O,value:U,onChange:P,min:C,max:_,step:Ye})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:f,className:"flex justify-between items-center text-sm font-medium text-gray-700 mb-1",children:[e.jsx("span",{children:O}),e.jsx("span",{className:"text-gray-500 font-normal",children:U})]}),e.jsx("input",{type:"range",id:f,min:C,max:_,step:Ye,value:U,onChange:P,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),ie=({id:f,isEnabled:O,setIsEnabled:U,title:P,description:C,disabled:_})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:f,className:`text-sm font-medium ${_?"text-gray-400":"text-gray-700"}`,children:[P,e.jsx("span",{className:`block text-xs ${_?"text-gray-300":"text-gray-500"}`,children:C})]}),e.jsx("button",{id:f,onClick:()=>!_&&U(!O),disabled:_,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${O?"bg-blue-600":"bg-gray-200"} ${_?"opacity-50 cursor-not-allowed":""}`,role:"switch","aria-checked":O,children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform ${O?"translate-x-6":"translate-x-1"}`})})]});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"settings-title",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl h-full w-full max-w-md overflow-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{id:"settings-title",className:"text-xl font-semibold text-gray-800",children:x("settings.title")}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600","aria-label":x("settings.closeAriaLabel"),children:e.jsx(Yt,{})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language-select",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.languageLabel")}),e.jsxs("select",{id:"language-select",value:Lt.language,onChange:f=>Lt.changeLanguage(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"zh-TW",children:"繁體中文"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-2 p-2 overflow-x-auto",role:"tablist","aria-label":"Settings tabs",children:[e.jsx(he,{tabName:"online",label:x("settings.tabOnline")}),e.jsx(he,{tabName:"offline",label:x("settings.tabOffline")}),e.jsx(he,{tabName:"speech",label:x("settings.tabSpeech")}),e.jsx(he,{tabName:"tts",label:x("settings.tabTts")}),e.jsx(he,{tabName:"ocr",label:x("settings.tabOcr")})]})}),e.jsxs("div",{className:"p-6 space-y-6 min-h-[350px]",children:[me==="online"&&e.jsxs("div",{role:"tabpanel",id:"online-settings","aria-labelledby":"online-tab",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:x("settings.providerLabel")}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"provider-gemini",name:"online-provider",type:"radio",value:"gemini",checked:Se==="gemini",onChange:f=>$e(f.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"provider-gemini",className:"ml-2 block text-sm text-gray-900",children:x("settings.providerGemini")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"provider-openai",name:"online-provider",type:"radio",value:"openai",checked:Se==="openai",onChange:f=>$e(f.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"provider-openai",className:"ml-2 block text-sm text-gray-900",children:x("settings.providerOpenAI")})]})]})]}),Se==="openai"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"openai-api-url",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.openaiUrlLabel")}),e.jsx("input",{type:"text",id:"openai-api-url",value:nt,onChange:f=>ot(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:x("settings.openaiUrlPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"api-key",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.apiKeyLabel")}),e.jsx("input",{type:"password",id:"api-key",value:ve,onChange:f=>tt(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:x("settings.apiKeyPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"model-name",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.modelNameLabel")}),e.jsx("input",{type:"text",id:"model-name",value:at,onChange:f=>st(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white",placeholder:x(Se==="gemini"?"settings.modelNameGeminiPlaceholder":"settings.modelNameOpenAIPlaceholder")})]})]}),me==="offline"&&e.jsxs("div",{role:"tabpanel",id:"offline-settings","aria-labelledby":"offline-tab",className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-1 p-1 bg-gray-100 rounded-lg",children:[e.jsx(Pt,{subTabName:"models",label:x("settings.subTabModels")}),e.jsx(Pt,{subTabName:"params",label:x("settings.subTabParameters")})]}),Re==="models"&&e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:x("settings.manageModelsLabel")}),ua.filter(f=>f.value).map(f=>e.jsx("div",{children:yt(f)},f.value))]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx(ie,{id:"offline-toggle",isEnabled:J,setIsEnabled:we,title:x("settings.enableOfflineLabel"),description:x("settings.enableOfflineDescription")}),e.jsx(ie,{id:"twostep-toggle",isEnabled:Me,setIsEnabled:Te,title:x("settings.enableTwoStepLabel"),description:x("settings.enableTwoStepDescription")})]})]}),Re==="params"&&e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:x("settings.offlineParamsDescription")}),e.jsx(xe,{id:"max-tokens-slider",label:x("settings.maxTokensLabel"),value:Rt,onChange:f=>De(parseInt(f.target.value,10)),min:256,max:8192,step:256}),e.jsx(xe,{id:"top-k-slider",label:x("settings.topKLabel"),value:Qt,onChange:f=>Je(parseInt(f.target.value,10)),min:1,max:100,step:1}),e.jsx(xe,{id:"temperature-slider",label:x("settings.temperatureLabel"),value:ea,onChange:f=>Ke(parseFloat(f.target.value)),min:0,max:1,step:.05}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"random-seed",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.randomSeedLabel")}),e.jsx("input",{type:"number",id:"random-seed",value:Fe,onChange:f=>bt(parseInt(f.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx(ie,{id:"max-num-images-toggle",isEnabled:Et===1,setIsEnabled:f=>Ve(f?1:0),title:x("settings.maxNumImagesLabel"),description:x("settings.maxNumImagesDescription")}),e.jsx(ie,{id:"support-audio-toggle",isEnabled:ze,setIsEnabled:f=>{qe(f),f&&Ue(!1)},title:x("settings.enableGemmaAudioLabel"),description:x("settings.enableGemmaAudioDescription"),disabled:!J})]})]}),me==="speech"&&e.jsxs("div",{role:"tabpanel",id:"speech-settings","aria-labelledby":"speech-tab",className:"space-y-6",children:[e.jsx(ie,{id:"web-speech-toggle",isEnabled:lt,setIsEnabled:f=>{ct(f)},title:x("settings.enableWebSpeechLabel"),description:x("settings.enableWebSpeechDescription")}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx(ie,{id:"asr-toggle",isEnabled:K,setIsEnabled:f=>{Ue(f),f&&qe(!1)},title:x("settings.enableOfflineAsrLabel"),description:x("settings.enableOfflineAsrDescription")}),e.jsxs("div",{className:`space-y-3 transition-opacity ${K?"":"opacity-50"}`,children:[e.jsx("label",{className:`block text-sm font-medium ${K?"text-gray-700":"text-gray-400"}`,children:x("settings.asrModelLabel")}),Qe.map(f=>{const O=fe[f.id]||!1,U=Oe&&We===f.id;return e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg bg-gray-50 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`asr-model-${f.id}`,name:"asr-model-selection",value:f.id,checked:We===f.id,onChange:wt,className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:!K}),e.jsxs("label",{htmlFor:`asr-model-${f.id}`,className:`ml-3 text-sm font-medium ${K?"text-gray-800":"text-gray-400"}`,children:[f.name," ",e.jsxs("span",{className:"text-gray-500 font-normal",children:["(",f.size,")"]})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:!U&&(O?e.jsx("span",{className:"text-sm font-medium text-green-600",children:x("settings.modelCached")||"Cached"}):e.jsx("button",{onClick:()=>Zt(f.id),disabled:Oe||!K,className:"text-sm font-medium text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:x("settings.modelDownload")||"Download"}))})]}),U&&e.jsxs("div",{className:"pt-1 text-center text-sm text-blue-600",children:[G.file," (",Math.round(G.progress),"%)"]})]},f.id)}),e.jsx("div",{children:e.jsxs("button",{onClick:Ie,disabled:!K,className:"w-full flex items-center justify-center space-x-2 text-red-600 font-medium py-2 px-4 rounded-lg border border-red-200 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors mt-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(wa,{className:"h-5 w-5"}),e.jsx("span",{children:x("settings.clearAsrCacheButton")})]})})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:`space-y-4 transition-opacity ${K?"":"opacity-50"}`,children:[e.jsx("label",{className:`block text-sm font-medium -mb-2 ${K?"text-gray-700":"text-gray-400"}`,children:x("settings.audioProcessingLabel")}),e.jsx(ie,{id:"noise-cancellation-toggle",isEnabled:ut,setIsEnabled:ft,title:x("settings.enableNoiseCancellationLabel"),description:x("settings.enableNoiseCancellationDescription"),disabled:!K}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"gain-slider",className:`flex justify-between items-center text-sm font-medium mb-1 ${K?"text-gray-700":"text-gray-400"}`,children:[e.jsx("span",{children:x("settings.audioGainLabel")}),e.jsxs("span",{className:"font-normal text-gray-500",children:[ge.toFixed(1),"x"]})]}),e.jsx("input",{type:"range",id:"gain-slider",min:.5,max:5,step:.1,value:ge,onChange:f=>mt(parseFloat(f.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!K})]})]})]}),me==="tts"&&e.jsxs("div",{role:"tabpanel",id:"tts-settings","aria-labelledby":"tts-tab",className:"space-y-6",children:[e.jsx(ie,{id:"tts-toggle",isEnabled:Pe,setIsEnabled:gt,title:x("settings.enableCustomTtsLabel"),description:x("settings.enableCustomTtsDescription")}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"voice-select",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.voiceLabel")}),e.jsx("select",{id:"voice-select",value:V,onChange:f=>He(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",disabled:re.length===0,children:re.length>0?re.map(f=>e.jsxs("option",{value:f.voiceURI,children:[f.name," (",f.lang,")"]},f.voiceURI)):e.jsx("option",{value:"",children:x("settings.voicePlaceholder",{languageName:x(F.name)})})})]}),e.jsx(xe,{id:"rate-slider",label:x("settings.rateLabel"),value:q,onChange:f=>ht(parseFloat(f.target.value)),min:.5,max:2,step:.1}),e.jsx(xe,{id:"pitch-slider",label:x("settings.pitchLabel"),value:je,onChange:f=>pt(parseFloat(f.target.value)),min:0,max:2,step:.1})]}),me==="ocr"&&e.jsxs("div",{role:"tabpanel",id:"ocr-settings","aria-labelledby":"ocr-tab",className:"space-y-6",children:[e.jsx(ie,{id:"ocr-auto-init-toggle",isEnabled:se,setIsEnabled:Mt,title:x("settings.enableOcrAutoInitLabel"),description:x("settings.enableOcrAutoInitDescription")}),e.jsxs("div",{className:"border-t pt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ocr-model-select",className:"block text-sm font-medium text-gray-700 mb-1",children:x("settings.ocrModelLabel")}),e.jsx("select",{id:"ocr-model-select",value:Xe,onChange:f=>Be(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:Object.entries(fa).map(([f,O])=>e.jsx("option",{value:f,children:O.description},f))})]}),e.jsx("button",{onClick:sa,disabled:Ae==="initializing",className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg text-sm font-medium transition disabled:bg-indigo-300 disabled:cursor-wait",children:x(Ae==="initializing"?"common.status.initializing":Ae==="ready"?"settings.switchOcr":"settings.initializeOcr")}),Ae==="ready"&&e.jsx("p",{className:"text-sm text-center text-green-600",children:"OCR Engine Ready."}),Ae==="error"&&e.jsxs("p",{className:"text-sm text-center text-red-600",children:["OCR Engine failed to initialize: ",Sa]})]})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 rounded-b-lg flex justify-between items-center",children:[e.jsx("button",{onClick:Tt,className:"text-red-600 font-medium py-2 px-4 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors","aria-label":x("history.clearAriaLabel"),children:x("settings.clearSettingsButton")}),e.jsx("button",{onClick:ta,className:"bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:x("settings.saveSettingsButton")})]})]})})},$s=({isOpen:t,onClose:a,history:o,onSelectHistory:n,onClearHistory:r})=>{const{t:i}=et();return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"history-title",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md h-[70vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{id:"history-title",className:"text-xl font-semibold text-gray-800",children:i("history.title")}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600","aria-label":i("history.closeAriaLabel"),children:e.jsx(Yt,{})})]}),e.jsx("div",{className:"p-2 flex-grow overflow-y-auto",children:o.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:i("history.empty")}):e.jsx("ul",{children:o.map(d=>e.jsx("li",{className:"border-b border-gray-200 last:border-b-0",children:e.jsxs("button",{onClick:()=>n(d),className:"w-full text-left p-4 hover:bg-gray-50 transition-colors","aria-label":i("history.selectAriaLabel",{sourceLang:i(d.sourceLang.name),targetLang:i(d.targetLang.name)}),children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 py-1 px-2 rounded-full",children:i(d.sourceLang.name)}),e.jsx("p",{className:"text-gray-800 mt-1 truncate",children:d.inputText})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-blue-500 bg-blue-50 py-1 px-2 rounded-full",children:i(d.targetLang.name)}),e.jsx("p",{className:"text-blue-700 font-medium mt-1 truncate",children:d.translatedText})]})]})},d.id))})}),o.length>0&&e.jsx("div",{className:"p-4 bg-gray-50 rounded-b-lg flex justify-end items-center",children:e.jsxs("button",{onClick:r,className:"flex items-center space-x-2 text-red-600 font-medium py-2 px-4 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors","aria-label":i("history.clearAriaLabel"),children:[e.jsx(wa,{className:"h-5 w-5"}),e.jsx("span",{children:i("history.clearButton")})]})})]})}):null},Us=t=>new Promise((a,o)=>{const n=new FileReader;n.onloadend=()=>{const i=n.result.split(",")[1];a(i)},n.onerror=o,n.readAsDataURL(t)}),Ea=async(t,a,o,n,r,i,d)=>{if(!n)throw new Error("Gemini API Key is not set. Please add it in the settings.");if(!r)throw new Error("Model Name is not configured. Please add it in the settings.");try{const u=new xa({apiKey:n}),y=`${a==="Auto Detect"?"First, auto-detect the source language of the following text.":`The source language is ${a}.`} Then, translate the text to ${o}.
Do not add any extra explanations, comments, or annotations. Return only the translated text.`,b=await u.models.generateContentStream({model:r,contents:t,config:{systemInstruction:y,thinkingConfig:{thinkingBudget:0}}});let m="";for await(const p of b){if(d.aborted)throw new DOMException("Translation cancelled by user.","AbortError");const S=p.text;S&&(m+=S,i(S))}return m.trim()}catch(u){throw console.error("Error translating text:",u),u instanceof DOMException&&u.name==="AbortError"?u:new Error("Gemini API request failed.")}},Ws=async(t,a,o,n)=>{var b;if(!o)throw new Error("Gemini API Key is not set. Please add it in the settings.");const r=new xa({apiKey:o}),i=t.match(/^data:(image\/\w+);base64,(.*)$/);if(!i)throw new Error("Invalid image data URL format.");const d=i[1],u=i[2],c={inlineData:{mimeType:d,data:u}},y={text:`1. First, accurately extract all text from the provided image.
2. Then, translate the extracted text into ${a}.
3. Finally, return a single JSON object with two keys: "sourceText" containing the exact extracted text, and "translatedText" containing the translation. Do not include any other explanations or markdown formatting.`};try{const p=((b=(await r.models.generateContent({model:n,contents:{parts:[y,c]},config:{responseMimeType:"application/json",responseSchema:{type:ha.OBJECT,properties:{sourceText:{type:ha.STRING,description:"The text extracted from the image."},translatedText:{type:ha.STRING,description:"The translated text."}},required:["sourceText","translatedText"]}}})).text)==null?void 0:b.trim())||"{}",S=JSON.parse(p);if(typeof S.sourceText=="string"&&typeof S.translatedText=="string")return S;throw new Error("Invalid JSON structure in API response.")}catch(m){throw console.error("Error translating image:",m),m instanceof SyntaxError?new Error("Failed to parse the response from the Gemini API. The response was not valid JSON."):new Error("Gemini API request for image translation failed.")}},Ma=async(t,a,o,n,r)=>{var b;if(!o)throw new Error("Gemini API Key is not set. Please add it in the settings.");const i=new xa({apiKey:o}),d=await Us(t);let u=t.type;u.includes(";")&&(u=u.split(";")[0]),u||(u="audio/wav");const c={inlineData:{mimeType:u,data:d}},y=`Transcribe the following audio. The language is ${a}. Return only the transcribed text.`;try{const m=await i.models.generateContent({model:n,contents:{parts:[c,{text:y}]}});if(r!=null&&r.aborted)throw new DOMException("Transcription cancelled by user.","AbortError");return((b=m.text)==null?void 0:b.trim())||""}catch(m){throw console.error("Error transcribing audio:",m),m instanceof DOMException&&m.name==="AbortError"?m:new Error("Gemini API transcription request failed.")}},Ta=async(t,a,o,n,r,i,d,u)=>{var b,m,p,S;if(!n)throw new Error("OpenAI API Key is not set.");if(!r)throw new Error("Model Name is not configured.");if(!i)throw new Error("OpenAI API URL is not set.");const y=`${a==="Auto Detect"?"First, auto-detect the source language of the following text.":`The source language is ${a}.`} Then, translate the text to ${o}. Do not add any extra explanations, comments, or annotations. Return only the translated text.`;try{const v=await fetch(`${i}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:r,messages:[{role:"system",content:y},{role:"user",content:t}],temperature:1,stream:!0}),signal:u});if(!v.ok){if(u.aborted)throw new DOMException("Request aborted by user","AbortError");const F=await v.json();throw new Error(((b=F.error)==null?void 0:b.message)||`OpenAI API request failed with status ${v.status}`)}if(!v.body)throw new Error("Response body is null, cannot stream.");const k=v.body.getReader(),A=new TextDecoder;let R="";for(;;){const{done:F,value:I}=await k.read();if(F)break;const ae=A.decode(I,{stream:!0}).split(`
`).filter(ee=>ee.trim().startsWith("data:"));for(const ee of ae){const Y=ee.replace(/^data: /,"").trim();if(Y==="[DONE]")break;try{const B=(S=(p=(m=JSON.parse(Y).choices)==null?void 0:m[0])==null?void 0:p.delta)==null?void 0:S.content;B&&(R+=B,d(B))}catch{}}}return R.trim()}catch(v){throw console.error("Error translating text with OpenAI:",v),v instanceof Error&&v.name==="AbortError"?v:new Error("OpenAI API request failed.")}},Hs=async(t,a,o,n,r)=>{var d,u,c;if(!o)throw new Error("OpenAI API Key is not set.");if(!r)throw new Error("OpenAI API URL is not set.");if(!t.startsWith("data:image/")||!t.includes(";base64,"))throw new Error("Invalid image data URL format. It must be a base64 encoded image data URL.");const i=`1. First, accurately extract all text from the provided image.
2. Then, translate the extracted text into ${a}.
3. Finally, return a single JSON object with two keys: "sourceText" containing the exact extracted text, and "translatedText" containing the translation. Do not include any other explanations, markdown formatting, or code fences.`;try{const y=await fetch(`${r}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:n,messages:[{role:"user",content:[{type:"text",text:i},{type:"image_url",image_url:{url:t}}]}],max_tokens:2048,response_format:{type:"json_object"},stream:!1})});if(!y.ok){const S=await y.json();throw new Error(((d=S.error)==null?void 0:d.message)||`OpenAI API image request failed with status ${y.status}`)}const m=(c=(u=(await y.json()).choices[0])==null?void 0:u.message)==null?void 0:c.content;if(!m)throw new Error("No content in OpenAI API response.");const p=JSON.parse(m);if(typeof p.sourceText=="string"&&typeof p.translatedText=="string")return p;throw new Error("Invalid JSON structure in API response.")}catch(y){throw console.error("Error translating image with OpenAI:",y),y instanceof SyntaxError?new Error("Failed to parse the response from the OpenAI API. The response was not valid JSON."):y instanceof Error?y:new Error("OpenAI API request for image translation failed.")}},Pa=async(t,a,o,n,r)=>{var u;if(!o)throw new Error("OpenAI API Key is not set.");if(!n)throw new Error("OpenAI API URL is not set.");const i=new FormData,d=t.type.includes("wav")?"wav":"webm";i.append("file",t,`recording.${d}`),i.append("model","whisper-1"),a&&a!=="auto"&&i.append("language",a);try{const c=await fetch(`${n}/v1/audio/transcriptions`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i,signal:r});if(!c.ok){if(r!=null&&r.aborted)throw new DOMException("Request aborted by user","AbortError");const b=await c.json();throw new Error(((u=b.error)==null?void 0:u.message)||`OpenAI API audio request failed with status ${c.status}`)}return(await c.json()).text||""}catch(c){throw console.error("Error transcribing audio with OpenAI:",c),c instanceof Error&&c.name==="AbortError"?c:new Error("OpenAI API request for audio transcription failed.")}},Gs="offline-model-db",ye="model-chunks",Q="model-meta",Xt="consolidated-models",Js=3;class Ks{constructor(){Vt(this,"dbPromise");Vt(this,"controllers",new Map);Vt(this,"isOpfsSupported");Vt(this,"opfsRootPromise");this.dbPromise=fs(Gs,Js,{upgrade(a){a.objectStoreNames.contains(ye)||a.createObjectStore(ye,{keyPath:["modelName","chunkIndex"]}).createIndex("modelName","modelName",{unique:!1}),a.objectStoreNames.contains(Q)||a.createObjectStore(Q,{keyPath:"modelName"}),a.objectStoreNames.contains(Xt)||a.createObjectStore(Xt,{keyPath:"modelName"})}}),this.isOpfsSupported="getDirectory"in navigator.storage,this.opfsRootPromise=this.isOpfsSupported?navigator.storage.getDirectory().catch(a=>(console.error("Failed to get OPFS root directory:",a),null)):Promise.resolve(null),this.isOpfsSupported?console.log("Origin Private File System is supported and will be used for model storage."):console.log("Origin Private File System not supported, falling back to IndexedDB.")}async getOpfsRoot(){return this.opfsRootPromise}async startDownload(a,o,n,r){if(this.controllers.has(a)){console.warn(`Download for ${a} is already in progress.`);return}this.isOpfsSupported?await this.runOpfsDownload(a,o,n,r,!1):await this.runIdbDownload(a,o,n,r,!1)}async resumeDownload(a,o,n,r){this.controllers.has(a)||(this.isOpfsSupported?await this.runOpfsDownload(a,o,n,r,!0):await this.runIdbDownload(a,o,n,r,!0))}async runOpfsDownload(a,o,n,r,i){const d=new AbortController;this.controllers.set(a,d);let u=0,c=0;try{const y=await this.getOpfsRoot();if(!y)throw new Error("Could not access OPFS.");const b=await y.getFileHandle(a,{create:!0}),m=await this.getDb(),p=await m.get(Q,a);if(i&&p&&p.total>0&&(c=p.total,u=(await b.getFile()).size,u>=c&&(console.warn(`Resuming download for ${a}, but existing file is complete or corrupt. Restarting.`),u=0)),c===0){const v=await fetch(o,{method:"HEAD",signal:d.signal});if(!v.ok)throw new Error(`Failed to get model info. Status: ${v.status}`);if(c=Number(v.headers.get("Content-Length")),isNaN(c)||c===0)throw new Error("Could not determine file size.");u=0}if(await m.put(Q,{modelName:a,total:c,status:"downloading"}),r({downloaded:u,total:c,percent:c>0?u/c*100:0,status:"downloading"}),u<c){const v=await fetch(o,{headers:{Range:`bytes=${u}-`},signal:d.signal});if(!v.ok||!v.body)throw new Error(`Download request failed. Status: ${v.status}`);const k=await b.createWritable({keepExistingData:!0});await k.seek(u);const A=v.body.getReader();for(;;){const{done:R,value:F}=await A.read();if(R)break;await k.write(F),u+=F.length,r({downloaded:u,total:c,percent:u/c*100,status:"downloading"})}await k.close()}const S=await b.getFile();if(S.size!==c)throw new Error(`Final file size ${S.size} does not match expected size ${c}`);await m.put(Q,{modelName:a,total:c,status:"completed"}),r({downloaded:c,total:c,percent:100,status:"completed"}),console.log(`Model ${a} downloaded to OPFS successfully.`)}catch(y){this.handleDownloadError(y,a,u,c,r)}finally{this.controllers.delete(a)}}async runIdbDownload(a,o,n,r,i){const d=new AbortController;this.controllers.set(a,d);let u=0,c=0,y=0;const b=5*1024*1024;try{const m=await this.getDb();if(i){const p=await m.get(Q,a);if(!p||!p.total)return this.runIdbDownload(a,o,n,r,!1);c=p.total;const S=await m.getAllFromIndex(ye,"modelName",a);u=S.reduce((v,k)=>v+k.data.byteLength,0),y=S.length}else{await this.deleteModel(a);const p=await fetch(o,{method:"HEAD",signal:d.signal});if(!p.ok)throw new Error(`Failed to get model info. Status: ${p.status}`);if(c=Number(p.headers.get("Content-Length")),isNaN(c)||c===0)throw new Error("Could not determine file size.")}for(await m.put(Q,{modelName:a,total:c,status:"downloading"});u<c;){const p=u,S=Math.min(u+b-1,c-1),v=await fetch(o,{headers:{Range:`bytes=${p}-${S}`},signal:d.signal});if(!v.ok)throw new Error(`Chunk download failed. Status: ${v.status}`);const k=await v.arrayBuffer();await m.put(ye,{modelName:a,chunkIndex:y,data:k}),u+=k.byteLength,y++,r({downloaded:u,total:c,percent:u/c*100,status:"downloading"})}await this._consolidateModel(a,r)}catch(m){this.handleDownloadError(m,a,u,c,r)}finally{this.controllers.delete(a)}}handleDownloadError(a,o,n,r,i){if(a instanceof DOMException&&a.name==="AbortError")console.log(`Download for ${o} was paused.`),this.getDb().then(d=>d.put(Q,{modelName:o,total:r,status:"paused",downloaded:n})),i({downloaded:n,total:r,percent:r>0?n/r*100:0,status:"paused"});else{const d=a instanceof Error?a.message:"Unknown download error";console.error(`Download error for ${o}:`,a),this.getDb().then(u=>u.put(Q,{modelName:o,status:"error",error:d,total:r})),i({downloaded:n,total:r,percent:r>0?n/r*100:0,status:"error",error:d})}}async _consolidateModel(a,o){const n=await this.getDb(),r=await n.get(Q,a);if(!r)return;const i=r.total||0,d=r.downloaded||i;try{o({downloaded:d,total:i,percent:100,status:"consolidating"});const u=await this.getModelFromChunksAsStream(a);if(!u)throw new Error("Failed to reconstruct model from chunks.");await n.put(Xt,{modelName:a,blob:u}),await this._deleteChunks(a),await n.put(Q,{modelName:a,total:i,status:"completed",downloaded:i}),o({downloaded:i,total:i,percent:100,status:"completed"}),console.log(`Model ${a} consolidated successfully.`)}catch(u){const c=u instanceof Error?u.message:"Unknown consolidation error";console.error(`Consolidation error for ${a}:`,u),await n.put(Q,{modelName:a,status:"error",error:c,total:i}),o({downloaded:d,total:i,percent:d/i*100,status:"error",error:`Consolidation failed: ${c}`})}}async _deleteChunks(a){const n=(await this.getDb()).transaction(ye,"readwrite");let i=await n.objectStore(ye).index("modelName").openCursor(IDBKeyRange.only(a));for(;i;)i.delete(),i=await i.continue();await n.done}pauseDownload(a){const o=this.controllers.get(a);o&&(o.abort(),this.controllers.delete(a))}async deleteModel(a){if(this.pauseDownload(a),this.isOpfsSupported)try{const n=await this.getOpfsRoot();n&&await n.removeEntry(a)}catch(n){n instanceof DOMException&&n.name==="NotFoundError"||console.error(`Error deleting ${a} from OPFS:`,n)}const o=await this.getDb();await o.delete(Q,a),await o.delete(Xt,a),await this._deleteChunks(a)}async getStatus(a){const o=await this.getDb(),n=await o.get(Q,a);if(!n)return{downloaded:0,total:0,percent:0,status:"not_started"};const r=n.total||0;if(n.status==="completed")return{downloaded:r,total:r,percent:100,status:"completed"};let i=0;if(this.isOpfsSupported)try{const d=await this.getOpfsRoot();d&&(i=(await(await d.getFileHandle(a)).getFile()).size)}catch{}else i=(await o.getAllFromIndex(ye,"modelName",a)).reduce((u,c)=>u+c.data.byteLength,0);return{downloaded:i,total:r,percent:r>0?i/r*100:0,status:n.status,error:n.error}}async getModelAsBlob(a){const o=await this.getDb(),n=await o.get(Q,a);if(!n||n.status!=="completed")return null;if(this.isOpfsSupported)try{const i=await this.getOpfsRoot();if(i){const u=await(await i.getFileHandle(a)).getFile();return u.size===n.total?u:(console.error(`OPFS file for ${a} is incomplete. Expected ${n.total}, found ${u.size}.`),null)}}catch(i){console.warn(`Could not get model ${a} from OPFS, will check IndexedDB.`,i)}const r=await o.get(Xt,a);return r&&r.blob?r.blob:(console.warn(`Consolidated model for ${a} not found in store. Reconstructing from chunks as a fallback.`),this.getModelFromChunksAsStream(a))}async getModelFromChunksAsStream(a){const o=await this.getDb();if(!await o.getFromIndex(ye,"modelName",a))return null;const r=new ReadableStream({async start(i){let c=await o.transaction(ye,"readonly").objectStore(ye).index("modelName").openCursor(IDBKeyRange.only(a));for(;c;)i.enqueue(new Uint8Array(c.value.data)),c=await c.continue();i.close()}});try{return await new Response(r).blob()}catch{return null}}getDb(){return this.dbPromise}}const Ot=new Ks,va="transformers-cache";ya.backends.onnx.executionProviders=["webgpu","wasm"];ya.useBrowserCache=!0;ya.cacheDir=va;const Da=async t=>{if(!("caches"in window))return!1;try{const a=await caches.open(va),o=`https://huggingface.co/${t}/resolve/main/config.json`;return!!await a.match(o)}catch(a){return console.error(`Error checking ASR cache status for ${t}:`,a),!1}},qs=async()=>{if("caches"in window)try{await caches.delete(va),console.log("ASR model cache cleared successfully.")}catch(t){throw console.error("Error clearing ASR model cache:",t),t}},ia=async(t,a={})=>{const{noiseSuppression:o=!1,gain:n=1}=a,r=window.AudioContext||window.webkitAudioContext,i=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!r)throw new Error("Your browser does not support the Web Audio API, which is required for transcription.");const d=await t.arrayBuffer(),u=new r,c=await u.decodeAudioData(d);let y;if(c.numberOfChannels>1){y=new Float32Array(c.length);for(let A=0;A<c.length;A++){let R=0;for(let F=0;F<c.numberOfChannels;F++)R+=c.getChannelData(F)[A];y[A]=R/c.numberOfChannels}}else y=c.getChannelData(0);const b=16e3,m=u.createBuffer(1,y.length,c.sampleRate);m.copyToChannel(y,0);const p=new i(1,Math.ceil(m.duration*b),b),S=p.createBufferSource();S.buffer=m;let v=S;if(o){const A=p.createBiquadFilter();A.type="highpass",A.frequency.value=100,v.connect(A),v=A}if(n&&n!==1){const A=p.createGain();A.gain.value=n,v.connect(A),v=A}v.connect(p.destination),S.start();const k=await p.startRendering();return await u.close(),k.getChannelData(0)},Fa=window.SpeechRecognition||window.webkitSpeechRecognition,Vs=({onResult:t,onError:a,onStart:o,onEnd:n})=>{const[r,i]=s.useState(!1),d=s.useRef(null),u=s.useRef(!1);s.useEffect(()=>{if(!Fa){console.warn("Web Speech API is not supported by this browser.");return}const b=new Fa;return b.continuous=!0,b.interimResults=!0,b.onstart=()=>{i(!0),o()},b.onend=()=>{if(u.current)try{b.start()}catch{i(!1),n()}else i(!1),n()},b.onerror=m=>{u.current=!1,m.error!=="no-speech"&&m.error!=="aborted"&&a(m.error)},b.onresult=m=>{let p="",S="";for(let v=m.resultIndex;v<m.results.length;++v)m.results[v].isFinal?S+=m.results[v][0].transcript:p+=m.results[v][0].transcript;S?t(S,!0):p&&t(p,!1)},d.current=b,()=>{u.current=!1,b.stop()}},[t,a,o,n]);const c=s.useCallback(b=>{if(d.current&&!r)try{d.current.lang=b,u.current=!0,d.current.start()}catch(m){console.error("Could not start speech recognition:",m),a("Failed to start recognition.")}},[r,a]),y=s.useCallback(()=>{d.current&&r&&(u.current=!1,d.current.stop())},[r]);return s.useMemo(()=>({isListening:r,startRecognition:c,stopRecognition:y}),[r,c,y])},Xs="PaddleOCR-ModelCache",It="models",Ys=1;let la;const $a=()=>new Promise((t,a)=>{if(la)return t(la);const o=indexedDB.open(Xs,Ys);o.onerror=()=>{a("Error opening IndexedDB.")},o.onsuccess=()=>{la=o.result,t(la)},o.onupgradeneeded=()=>{const n=o.result;n.objectStoreNames.contains(It)||n.createObjectStore(It)}}),pa=t=>new Promise(async(a,o)=>{try{const d=(await $a()).transaction(It,"readonly").objectStore(It).get(t);d.onsuccess=()=>{a(d.result)},d.onerror=()=>{o("Error getting data from IndexedDB.")}}catch(n){o(n)}}),ba=(t,a)=>new Promise(async(o,n)=>{try{const u=(await $a()).transaction(It,"readwrite").objectStore(It).put(a,t);u.onsuccess=()=>{o()},u.onerror=()=>{n("Error setting data in IndexedDB.")}}catch(r){n(r)}}),Zs=()=>{const[t,a]=s.useState(null),[o,n]=s.useState("uninitialized"),[r,i]=s.useState(null),d=s.useCallback(()=>{a(null),n("uninitialized"),i(null),console.log("PaddleOCR engine has been unloaded.")},[]),u=s.useCallback(async y=>{t&&(console.log("Unloading previous OCR instance before switching model."),a(null)),n("initializing"),i(null);try{const b=ms||gs,m="det-model",p=`rec-model-${y.key}`,S=`dict-${y.key}`;let v=await pa(m),k=await pa(p),A=await pa(S);const R=[];if(v||R.push(fetch(y.detPath).then(I=>I.arrayBuffer()).then(async I=>{v=I,await ba(m,I)})),k||R.push(fetch(y.recPath).then(I=>I.arrayBuffer()).then(async I=>{k=I,await ba(p,I)})),A||R.push(fetch(y.dictPath).then(I=>I.arrayBuffer()).then(async I=>{A=new TextDecoder("utf-8").decode(I),await ba(S,A)})),R.length>0&&await Promise.all(R),!v||!k||!A)throw new Error("Failed to load required assets.");const F=await hs({det:{input:new Uint8Array(v)},rec:{input:new Uint8Array(k),decodeDic:A,optimize:{space:!1}},ort:b});a(F),n("ready")}catch(b){i(`Initialization failed: ${b.message||"Check models"}`),n("error"),console.error("OCR Engine initialization error:",b)}},[t]),c=s.useCallback(async y=>{if(o!=="ready"||!t)return null;try{const b=performance.now(),m=await t.ocr(y),p=performance.now();return{result:m,time:p-b}}catch(b){throw console.error("Recognition error:",b),new Error(b.message||"OCR processing failed.")}},[t,o]);return{status:o,error:r,recognize:c,initializeOcr:u,unloadOcr:d}},za=t=>{let a;if(t.numberOfChannels>1){a=new Float32Array(t.length);for(let b=0;b<t.length;b++){let m=0;for(let p=0;p<t.numberOfChannels;p++)m+=t.getChannelData(p)[b];a[b]=m/t.numberOfChannels}}else a=t.getChannelData(0);const o=1,n=a.length*o*2+44,r=new ArrayBuffer(n),i=new DataView(r);let d=0;const u=b=>{i.setUint16(d,b,!0),d+=2},c=b=>{i.setUint32(d,b,!0),d+=4},y=b=>{for(let m=0;m<b.length;m++)i.setUint8(d+m,b.charCodeAt(m));d+=b.length};y("RIFF"),c(n-8),y("WAVE"),y("fmt "),c(16),u(1),u(o),c(t.sampleRate),c(t.sampleRate*2*o),u(o*2),u(16),y("data"),c(a.length*2);for(let b=0;b<a.length;b++){let m=Math.max(-1,Math.min(1,a[b]));i.setInt16(d,m<0?m*32768:m*32767,!0),d+=2}return new Blob([i],{type:"audio/wav"})},Qs=t=>{const a=t.box.map(u=>u[0]),o=t.box.map(u=>u[1]),n=Math.min(...a),r=Math.max(...a),i=Math.min(...o),d=Math.max(...o);return{...t,minX:n,maxX:r,minY:i,maxY:d,centerX:(n+r)/2,centerY:(i+d)/2,height:d-i}},ca=t=>{const a=[];return t.sort((o,n)=>o.centerY-n.centerY),t.forEach(o=>{const n=a.find(r=>{const i=r.reduce((u,c)=>u+c.centerY,0)/r.length,d=r.reduce((u,c)=>u+c.height,0)/r.length;return Math.abs(o.centerY-i)<d*.6});n?n.push(o):a.push([o])}),a.sort((o,n)=>{const r=i=>Math.min(...i.map(d=>d.minY));return r(o)-r(n)}),a.map(o=>(o.sort((n,r)=>n.minX-r.minX),o.map(n=>n.text).join(" "))).join(`
`)},en=t=>{if(!t||t.length===0)return"";const a=t.map(Qs);if(a.length<2)return ca(a);const o=Math.min(...a.map(p=>p.minX)),r=Math.max(...a.map(p=>p.maxX))-o,i=new Int32Array(Math.ceil(r)+1);a.forEach(p=>{const S=Math.floor(p.minX-o),v=Math.ceil(p.maxX-o);for(let k=S;k<v;k++)k>=0&&k<i.length&&i[k]++});const d=Math.floor(r*.25),u=Math.floor(r*.75);let c=0,y=-1,b=-1;for(let p=d;p<=u;p++)if(i[p]===0)b===-1&&(b=p);else if(b!==-1){const S=p-b;S>c&&(c=S,y=b+S/2),b=-1}if(y!==-1&&c>10){const p=o+y,S=a.filter(R=>R.centerX<p),v=a.filter(R=>R.centerX>=p),k=ca(S),A=ca(v);return`${k}

${A}`}return ca(a)},tn=t=>{var o;const a=t.src;return!a||a.length===0?((o=t.parragraphs)==null?void 0:o.map(n=>n.text).join(`
`))||"":en(a)},an=()=>{var Aa;const{t,i18n:a}=et(),[o,n]=s.useState(""),[r,i]=s.useState(""),[d,u]=s.useState(da[0]),[c,y]=s.useState(da[6]),[b,m]=s.useState(!1),[p,S]=s.useState(!1),[v,k]=s.useState(!1),[A,R]=s.useState(!1),[F,I]=s.useState(!1),[X,ae]=s.useState(!1),[ee,Y]=s.useState(!1),[ue,B]=s.useState([]),[M,oe]=s.useState(""),[$,ke]=s.useState("gemini-3-flash-preview"),[L,T]=s.useState("gemini"),[N,te]=s.useState(""),[fe,Oe]=s.useState(""),[G,Zt]=s.useState(""),[Ie,Ae]=s.useState(!1),[Sa,ma]=s.useState([]),[Le,At]=s.useState([]),[x,Lt]=s.useState(navigator.onLine),[me,Ne]=s.useState(!1),[Re,Ee]=s.useState(null),[ve,tt]=s.useState(!1),[at,st]=s.useState(""),[Se,$e]=s.useState(1),[nt,ot]=s.useState(1),[z,Nt]=s.useState(!1),[rt,it]=s.useState({}),[J,we]=s.useState(!1),[Me,Te]=s.useState(!1),[K,Ue]=s.useState(4096),[lt,ct]=s.useState(40),[We,dt]=s.useState(.3),[ut,ft]=s.useState(10),[ge,mt]=s.useState(!1),[Pe,gt]=s.useState(0),[V,He]=s.useState(!0),[q,ht]=s.useState(!1),[je,pt]=s.useState(Qe[0].id),[re,Ge]=s.useState(!1),[Rt,De]=s.useState(!1),[Qt,Je]=s.useState({}),[ea,Ke]=s.useState({file:"",progress:0}),[Fe,bt]=s.useState(!1),[ze,qe]=s.useState(1),[Et,Ve]=s.useState(null),[Xe,Be]=s.useState(!1),{status:se,error:Mt,recognize:ta,initializeOcr:Tt,unloadOcr:aa}=Zs(),[wt,sa]=s.useState("ch_v5"),[he,Pt]=s.useState(!1),[xt,yt]=s.useState([]),[xe,ie]=s.useState(null),f=s.useRef(null),O=s.useRef(null),U=s.useRef(h=>{}),P=s.useRef(null),C=s.useCallback((h,g="error")=>{f.current&&clearTimeout(f.current),ie({message:h,type:g}),f.current=window.setTimeout(()=>{ie(null)},5e3)},[]);s.useRef(null),s.useRef(null),s.useRef(""),s.useRef(null);const _=s.useRef(null),Ye=s.useRef([]),pe=s.useRef(null),ne=s.useRef(null),le=s.useRef(null),vt=s.useRef(null),Z=s.useRef(!1),ce=s.useCallback(()=>{if(O.current)return O.current;console.log("Creating offline worker...");const h=new Worker(new URL("/Gemini-AI-Translator/assets/offline.worker-BgHBouAB.js",import.meta.url),{type:"module"});O.current=h;const g=l=>U.current(l);return h.addEventListener("message",g),h.onerror=l=>{console.error("Worker error:",l),C(`A critical worker error occurred: ${l.message}`,"error"),we(!1),m(!1)},h},[C]);s.useEffect(()=>()=>{O.current&&(O.current.terminate(),O.current=null,console.log("Offline worker terminated on component unmount."))},[]);const ga=z&&!!G&&((Aa=rt[G])==null?void 0:Aa.status)==="completed",de=ga&&Me,na=s.useCallback(async h=>{if(!h.trim()){i("");return}ne.current&&ne.current.abort();const g=new AbortController;ne.current=g,m(!0),i("");try{const l=a.t(d.name,{lng:"en"}),w=a.t(c.name,{lng:"en"});if(z){if(!G)throw new Error("Please select an offline model in settings.");if(J)throw new Error("Offline model is still initializing.");if(!de)throw new Error("Selected offline model is not ready.");ce().postMessage({type:"translate",payload:{text:h,sourceLang:l,targetLang:w,sourceLangCode:d.code,targetLangCode:c.code,isTwoStepEnabled:Ie}})}else{if(!x)throw new Error("You are offline. Enable offline mode or connect to the internet.");let j="";const E=W=>{j+=W,i(H=>H.length===0?W.trimStart():H+W)};if(L==="openai"){if(!M)throw new Error("OpenAI API Key is not set. Please add it in the settings.");if(!N)throw new Error("OpenAI API URL is not set. Please add it in the settings.");j=await Ta(h,l,w,M,$,N,E,g.signal)}else{if(!M)throw new Error("Gemini API Key is not set. Please add it in the settings.");j=await Ea(h,l,w,M,$,E,g.signal)}const D={id:Date.now(),inputText:h,translatedText:j,sourceLang:d,targetLang:c};B(W=>{const H=[D,...W].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(H)),H}),m(!1)}}catch(l){if(l instanceof DOMException&&l.name==="AbortError"){console.log("Translation cancelled by user."),m(!1);return}const w=l instanceof Error?l.message:"An unknown error occurred.";C(t("notifications.translationFailed",{errorMessage:w}),"error"),l instanceof Error&&(l.message.includes("select an offline model")||l.message.includes("API Key is not set")||l.message.includes("API URL is not set"))&&ae(!0),console.error(l),m(!1)}finally{!z&&ne.current===g&&(ne.current=null)}},[d,c,M,$,x,z,G,de,J,C,L,N,Ie,t,a,ce]),Ce=s.useCallback(async h=>{if(!h.trim()){i("");return}ne.current&&ne.current.abort();const g=new AbortController;ne.current=g,m(!0),i("");try{const l=a.t(c.name,{lng:"en"}),w=a.t(d.name,{lng:"en"});if(z){if(!G)throw new Error("Please select an offline model in settings.");if(J)throw new Error("Offline model is still initializing.");if(!de)throw new Error("Selected offline model is not ready.");ce().postMessage({type:"translate",payload:{text:h,sourceLang:l,targetLang:w,sourceLangCode:c.code,targetLangCode:d.code,isTwoStepEnabled:Ie}})}else{if(!x)throw new Error("You are offline. Enable offline mode or connect to the internet.");let j="";const E=W=>{j+=W,i(H=>H.length===0?W.trimStart():H+W)};if(L==="openai"){if(!M)throw new Error("OpenAI API Key is not set.");if(!N)throw new Error("OpenAI API URL is not set.");j=await Ta(h,l,w,M,$,N,E,g.signal)}else{if(!M)throw new Error("Gemini API Key is not set.");j=await Ea(h,l,w,M,$,E,g.signal)}const D={id:Date.now(),inputText:h,translatedText:j,sourceLang:c,targetLang:d};B(W=>{const H=[D,...W].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(H)),H}),m(!1)}}catch(l){if(l instanceof DOMException&&l.name==="AbortError"){console.log("Reverse translation cancelled."),m(!1);return}const w=l instanceof Error?l.message:"An unknown error occurred.";C(t("notifications.translationFailed",{errorMessage:w}),"error"),console.error(l),m(!1)}finally{!z&&ne.current===g&&(ne.current=null)}},[c,d,M,$,x,z,G,de,J,C,L,N,Ie,t,a,ce]);s.useEffect(()=>{U.current=h=>{var w;const{type:g,payload:l}=h.data;switch(g){case"init_done":Te(!0),C(t("notifications.offlineModelInitSuccess",{modelIdentifier:l.modelIdentifier}),"success"),we(!1);break;case"init_error":Te(!1),C(l.error||t("notifications.offlineModelInitFailed"),"error"),console.error("Offline model init failed via worker:",l.error),we(!1);break;case"unload_done":Te(!1),we(!1);break;case"translation_chunk":i(D=>D.length===0?l.chunk.trimStart():D+l.chunk);break;case"translation_done":{const D=Z.current?c:d,W=Z.current?d:c,H={id:Date.now(),inputText:o,translatedText:l.result,sourceLang:D,targetLang:W};B(Ze=>{const _e=[H,...Ze].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(_e)),_e}),m(!1);break}case"translation_error":C(t("notifications.translationFailed",{errorMessage:l.error}),"error"),m(!1);break;case"translation_cancelled":m(!1);break;case"extract_text_done":n(l.text),i(""),l.text.trim()||C(t("notifications.noTextInImage"),"error"),m(!1);break;case"extract_text_error":C(t("notifications.imageProcessingFailed",{errorMessage:l.error}),"error"),n(""),m(!1);break;case"transcribe_done":S(!1);const j=((w=l.text)==null?void 0:w.trim())||"";m(!1),j?(n(j),Xe&&(Be(!1),Ce(j))):(n(t("notifications.transcriptionFailedEmpty")),Be(!1));break;case"transcribe_error":S(!1);const E=l.error||"Unknown transcription error.";C(t("notifications.transcriptionFailed",{errorMessage:E}),"error"),n(t("notifications.transcriptionFailed",{errorMessage:E})),m(!1),Be(!1);break}}},[t,C,o,d,c,Xe,Ce,Z]);const ja=s.useRef(Ce);s.useEffect(()=>{ja.current=Ce},[Ce]);const St=s.useCallback(async()=>{const h={};for(const g of Qe)h[g.id]=await Da(g.id);return h},[]),Ca=s.useCallback(h=>{const{type:g,payload:l}=h.data;switch(g){case"progress":(l.status==="progress"||l.status==="download")&&Ke({file:l.file,progress:l.progress});break;case"error":C(l,"error"),n(t("notifications.transcriptionFailed",{errorMessage:l})),Ge(!1),S(!1);break;case"loaded":De(!0),Ge(!1),St().then(Je);break;case"unloaded":De(!1),C(t("notifications.asrModelUnloaded"),"info");break;case"transcription-partial":n(l);break;case"transcription":S(!1);const w=(l||"").trim();w?(n(w),Z.current&&(ja.current(w),Z.current=!1)):(n(t("notifications.transcriptionFailedEmpty")),Z.current=!1);break;case"log":console.log("[ASR Worker]:",l);break}},[C,St,t]),ka=s.useCallback(()=>{P.current&&P.current.terminate();const h=new Worker(new URL("/Gemini-AI-Translator/assets/asr.worker-UVmyh3tE.js",import.meta.url),{type:"module"});h.addEventListener("message",Ca),P.current=h,console.log("ASR Worker initialized.")},[Ca]);s.useEffect(()=>(q&&ka(),()=>{P.current&&(console.log("Cleaning up ASR worker."),P.current.terminate(),P.current=null,De(!1),Ge(!1))}),[q,ka]),s.useEffect(()=>{(async()=>{const g={};for(const l of ua)l.value&&(g[l.value]=await Ot.getStatus(l.value));it(g)})(),St().then(g=>{Je(g)})},[St]),s.useEffect(()=>{const h=()=>Lt(!0),g=()=>Lt(!1);return window.addEventListener("online",h),window.addEventListener("offline",g),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",g)}},[]),s.useEffect(()=>{const h=localStorage.getItem("api-key");h&&oe(h);const g=localStorage.getItem("model-name");g&&ke(g);const l=localStorage.getItem("online-provider");l&&T(l);const w=localStorage.getItem("openai-api-url");w&&te(w);const j=localStorage.getItem("hf-api-key");j&&Oe(j);const E=localStorage.getItem("offline-model-name");E&&Zt(E);const D=localStorage.getItem("offline-mode-enabled");D&&Nt(JSON.parse(D));const W=localStorage.getItem("is-two-step-jp-cn-enabled");W&&Ae(JSON.parse(W));const H=localStorage.getItem("tts-enabled");H&&tt(JSON.parse(H));const Ze=localStorage.getItem("tts-voice-uri");Ze&&st(Ze);const _e=localStorage.getItem("tts-rate");_e&&$e(JSON.parse(_e));const Dt=localStorage.getItem("tts-pitch");Dt&&ot(JSON.parse(Dt));const Ft=localStorage.getItem("offline-max-tokens");Ft&&Ue(JSON.parse(Ft));const zt=localStorage.getItem("offline-top-k");zt&&ct(JSON.parse(zt));const Bt=localStorage.getItem("offline-temperature");Bt&&dt(JSON.parse(Bt));const _t=localStorage.getItem("offline-random-seed");_t&&ft(JSON.parse(_t));const $t=localStorage.getItem("offline-support-audio");$t&&mt(JSON.parse($t));const Ut=localStorage.getItem("offline-max-num-images");Ut&&gt(JSON.parse(Ut));const Wt=localStorage.getItem("is-offline-asr-enabled");Wt&&ht(JSON.parse(Wt));const Ht=localStorage.getItem("is-web-speech-api-enabled");Ht&&He(JSON.parse(Ht));const Gt=localStorage.getItem("asr-model-id");Gt&&pt(Gt);const Jt=localStorage.getItem("is-noise-cancellation-enabled");Jt&&bt(JSON.parse(Jt));const Kt=localStorage.getItem("audio-gain-value");Kt&&qe(JSON.parse(Kt));const qt=localStorage.getItem("custom-offline-models");qt&&ma(JSON.parse(qt));const kt=localStorage.getItem("selected-ocr-model");kt&&Object.prototype.hasOwnProperty.call(fa,kt)&&sa(kt);const La=localStorage.getItem("is-ocr-auto-init-enabled");La&&Pt(JSON.parse(La));try{const ra=localStorage.getItem("translation-history");ra&&B(JSON.parse(ra))}catch(ra){console.error("Failed to load translation history:",ra)}},[]),s.useEffect(()=>{const h=()=>At(window.speechSynthesis.getVoices());window.speechSynthesis.onvoiceschanged=h,h()},[]),s.useEffect(()=>{z&&(ga?G:null)&&!Me&&!J&&yt(g=>[...g,"llm"])},[ga,G,z,Me,J]),s.useEffect(()=>{!z&&(Me||J)&&O.current&&(console.log("Requesting offline model unload."),O.current.postMessage({type:"unload"}))},[z,Me,J]),s.useEffect(()=>{q&&je&&!Rt&&!re&&(async()=>await Da(je)&&yt(l=>[...l,"asr"]))()},[q,je,Rt,re]),s.useEffect(()=>{he&&se==="uninitialized"&&yt(h=>[...h,"ocr"])},[he,se]);const Oa=s.useCallback(aa,[aa]);s.useEffect(()=>{!he&&se!=="uninitialized"&&Oa()},[he,se,Oa]),s.useEffect(()=>{if(J||re||se==="initializing"||xt.length===0)return;const g=xt[0];if(yt(l=>l.slice(1)),console.log(`[Orchestrator] Starting next task: ${g}`),g==="llm"){const l=G;we(!0),Te(!1),Ot.getModelAsBlob(l).then(w=>{if(!w)throw new Error(`Model blob for ${l} not found.`);const j={maxTokens:K,topK:lt,temperature:We,randomSeed:ut,supportAudio:ge,maxNumImages:Pe};ce().postMessage({type:"init",payload:{modelBlob:w,modelSource:l,options:j}})}).catch(w=>{const j=w instanceof Error?w.message:t("notifications.offlineModelInitFailed");C(j,"error"),we(!1)})}else if(g==="asr"){const l=Qe.find(w=>w.id===je);l&&P.current&&(Ge(!0),Ke({file:"",progress:0}),P.current.postMessage({type:"load",payload:{modelId:l.id,quantization:l.quantization}}))}else if(g==="ocr"){const l={key:wt,...fa[wt].paths};Tt(l)}},[xt,J,re,se,G,je,wt,K,lt,We,ut,ge,Pe,ce,Tt,C,t]);const Wa=s.useCallback(()=>{na(o)},[o,na]),Ha=s.useCallback(()=>{var h;z?O.current&&O.current.postMessage({type:"cancel_translation"}):(h=ne.current)==null||h.abort(),le.current&&(le.current.abort(),le.current=null)},[z]),Ga=s.useCallback(()=>{d.code!=="auto"&&(u(c),y(d),n(r),i(o))},[d,c,o,r]),Ja=s.useCallback(async h=>{if(!r)return;if(window.speechSynthesis.speaking&&(window.speechSynthesis.cancel(),me&&(ve||Re===h))){Ne(!1),Ee(null);return}if(Ne(!0),Ee(h),!("speechSynthesis"in window)){Ne(!1),Ee(null);return}const g=new SpeechSynthesisUtterance(r);if(g.lang=c.code,ve){const l=Le.find(w=>w.voiceURI===at);l&&(g.voice=l),g.rate=Se,g.pitch=nt}else{const l=Le.filter(w=>w.lang.startsWith(c.code));if(l.length>0){const w=l.find(D=>/female|women|girl|mei-jia|zira|ayumi|kyoko/i.test(D.name)),j=l.find(D=>/male|men|boy|liang|ichiro/i.test(D.name));let E;h==="female"?E=w||l.find(D=>D!==j)||l[0]:E=j||l.find(D=>D!==w)||l[0],g.voice=E}}g.onstart=()=>{Ne(!0),Ee(ve?null:h)},g.onend=()=>{Ne(!1),Ee(null)},g.onerror=l=>{console.error("SpeechSynthesisUtterance.onerror",l),C(t("notifications.speechError",{error:l.error}),"error"),Ne(!1),Ee(null)},window.speechSynthesis.speak(g)},[r,c,Le,me,Re,C,ve,at,Se,nt,t,x,L,M]),oa=()=>{_.current&&_.current.state==="recording"&&_.current.stop(),le.current&&(le.current.abort(),le.current=null)},jt=h=>{v||A||navigator.mediaDevices.getUserMedia({audio:!0}).then(g=>{Ye.current=[],vt.current=h;const l=new MediaRecorder(g);_.current=l,l.ondataavailable=w=>{w.data.size>0&&Ye.current.push(w.data)},l.onstop=()=>{var E;const w=((E=_.current)==null?void 0:E.mimeType)||"audio/webm",j=new Blob(Ye.current,{type:w});vt.current&&vt.current(j),g.getTracks().forEach(D=>D.stop()),_.current=null,vt.current=null,k(!1),R(!1)},l.onerror=w=>{C(`Recording error: ${w.error.message}`,"error"),k(!1),R(!1)},l.start()}).catch(g=>{C(`Could not start recording: ${g.message}`,"error"),k(!1),R(!1)})},Ka=s.useCallback((h,g)=>{n(h),g&&Z.current&&(Ce(h),Z.current=!1)},[Ce]),qa=s.useCallback(h=>{C(t("notifications.speechRecognitionError",{error:h}),"error")},[C,t]),Va=s.useCallback(()=>{k(!1),R(!1),Z.current=!1},[]),Xa=s.useCallback(()=>{},[]),be=Vs({onResult:Ka,onError:qa,onStart:Xa,onEnd:Va}),Ia=s.useCallback(()=>{_.current&&_.current.state==="recording"?_.current.stop():be.isListening&&be.stopRecognition()},[be]);s.useEffect(()=>(v||A?(Ve(30),pe.current=window.setInterval(()=>{Ve(h=>h!==null&&h<=1?(pe.current&&(clearInterval(pe.current),pe.current=null),Ia(),null):h!==null?h-1:null)},1e3)):(pe.current&&(clearInterval(pe.current),pe.current=null),Ve(null)),()=>{pe.current&&clearInterval(pe.current)}),[v,A,Ia]);const Ya=s.useCallback(()=>{if(v||!q&&V&&be.isListening&&!Z.current)q||!V?oa():be.stopRecognition();else{if(A&&oa(),d.code==="auto"&&(q||!V)){C(t("notifications.selectLanguageError"),"info");return}i(""),k(!0),n(t("translationInput.placeholderListening")),q?jt(async g=>{n(t("notifications.transcribing")),S(!0);try{const l=await ia(g,{noiseSuppression:Fe,gain:ze});if(P.current)P.current.postMessage({type:"transcribe",payload:{audio:l,asrLanguage:d.asrCode,promptLanguage:d.code}});else throw new Error("ASR Worker is not initialized.")}catch(l){console.error(l),n(""),S(!1);const w=l instanceof Error?l.message:"Transcription failed.";C(w,"error")}}):V?be.startRecognition(d.code):z&&ge?de?(n(t("notifications.transcribing")),S(!0),jt(async g=>{const l=await ia(g),w=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),j=w.createBuffer(1,l.length,16e3);j.copyToChannel(l,0);const E=za(j);await w.close(),ce().postMessage({type:"transcribe",payload:{audioData:E,sourceLang:a.t(d.name,{lng:"en"})}})})):(C(t("notifications.offlineModelNotReadyRecording"),"error"),k(!1)):jt(async g=>{n(t("notifications.transcribingApi"));const l=new AbortController;le.current=l;try{let w="";if(L==="openai"){const j=d.code.split("-")[0];w=await Pa(g,j,M,N,l.signal)}else{const j=t(d.name,{lng:"en"});w=await Ma(g,j,M,$,l.signal)}n(w)}catch(w){if(w instanceof DOMException&&w.name==="AbortError")return;const j=w instanceof Error?w.message:"Transcription failed.";C(j,"error"),n("")}finally{le.current=null}})}},[v,A,C,t,d,q,be,Fe,ze,V,L,M,N,$,z,de,ge,ce,a]),Za=s.useCallback(()=>{if(A||!q&&V&&be.isListening&&Z.current)q||!V?oa():be.stopRecognition();else{if(v&&oa(),c.code==="auto"){C(t("notifications.astSelectLanguage"),"info");return}n(""),i(""),R(!0),Z.current=!0,q?jt(async g=>{n(t("notifications.transcribing")),S(!0);try{const l=await ia(g,{noiseSuppression:Fe,gain:ze});if(P.current)P.current.postMessage({type:"transcribe",payload:{audio:l,asrLanguage:c.asrCode,promptLanguage:c.code}});else throw new Error("ASR Worker is not initialized.")}catch(l){console.error(l),n(""),S(!1),Z.current=!1;const w=l instanceof Error?l.message:"Transcription failed.";C(w,"error")}}):V?be.startRecognition(c.code):z&&ge?de?(Be(!0),n(t("notifications.transcribing")),S(!0),jt(async g=>{const l=await ia(g),w=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),j=w.createBuffer(1,l.length,16e3);j.copyToChannel(l,0);const E=za(j);await w.close(),ce().postMessage({type:"transcribe",payload:{audioData:E,sourceLang:a.t(c.name,{lng:"en"})}})})):(C(t("notifications.offlineModelNotReadyRecording"),"error"),R(!1),Z.current=!1):jt(async g=>{n(t("notifications.transcribingApi"));const l=new AbortController;le.current=l;try{let w="";if(L==="openai"){const j=c.code.split("-")[0];w=await Pa(g,j,M,N,l.signal)}else{const j=t(c.name,{lng:"en"});w=await Ma(g,j,M,$,l.signal)}n(w),w.trim()&&Ce(w)}catch(w){if(w instanceof DOMException&&w.name==="AbortError")return;const j=w instanceof Error?w.message:"Transcription failed.";C(j,"error"),n("")}finally{le.current=null,Z.current=!1}})}},[A,v,c,C,t,q,be,Fe,ze,V,L,M,N,$,z,ge,de,ce,Ce,a]),Qa=s.useCallback(async h=>{I(!1),m(!0),n(t("notifications.processingImage")),i("");try{if(se==="ready"){const g=new Image;g.src=h,await new Promise((j,E)=>{g.onload=()=>j(),g.onerror=D=>E(D)});const l=await ta(g);if(!l)throw new Error("OCR recognition returned no data.");const w=tn(l.result);n(w),w.trim()?await na(w):(C(t("notifications.noTextInImage"),"info"),i(""),m(!1));return}if(z){if(!de||Pe<1)throw new Error(t("notifications.offlineImageError"));const g=await new Promise((w,j)=>{const E=new Image;E.onload=()=>createImageBitmap(E).then(w).catch(j),E.onerror=()=>j(new Error("Failed to load image for bitmap.")),E.src=h});ce().postMessage({type:"extractText",payload:{imageBitmap:g}},[g])}else{if(!x)throw new Error(t("notifications.offlineImageTranslateError"));let g;const l=a.t(c.name,{lng:"en"});if(L==="openai"){if(!M)throw new Error("OpenAI API Key is not set.");if(!N)throw new Error("OpenAI API URL is not set.");g=await Hs(h,l,M,$,N)}else{if(!M)throw new Error("Gemini API Key is not set.");g=await Ws(h,l,M,$)}n(g.sourceText),i(g.translatedText);const w={id:Date.now(),inputText:g.sourceText,translatedText:g.translatedText,sourceLang:d,targetLang:c};B(j=>{const E=[w,...j].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(E)),E}),m(!1)}}catch(g){const l=g instanceof Error?g.message:"An unknown error occurred.";C(t("notifications.imageProcessingFailed",{errorMessage:l}),"error"),n(""),m(!1)}},[z,de,Pe,x,M,$,c,d,C,L,N,t,a,ce,se,ta,na]),es=(h,g,l,w,j,E,D,W,H,Ze,_e,Dt,Ft,zt,Bt,_t,$t,Ut,Wt,Ht,Gt,Jt,Kt,qt,kt)=>{oe(h),ke(g),T(H),te(Ze),Oe(l),Zt(w),pt(j),Nt(E),ht(D),He(W),Ae(Bt),tt(_e),st(Dt),$e(Ft),ot(zt),Ue(_t),ct($t),dt(Ut),ft(Wt),mt(Ht),gt(Gt),bt(Jt),qe(Kt),sa(qt),Pt(kt),localStorage.setItem("api-key",h),localStorage.setItem("model-name",g),localStorage.setItem("online-provider",H),localStorage.setItem("openai-api-url",Ze),localStorage.setItem("hf-api-key",l),localStorage.setItem("offline-model-name",w),localStorage.setItem("asr-model-id",j),localStorage.setItem("offline-mode-enabled",JSON.stringify(E)),localStorage.setItem("is-offline-asr-enabled",JSON.stringify(D)),localStorage.setItem("is-web-speech-api-enabled",JSON.stringify(W)),localStorage.setItem("is-two-step-jp-cn-enabled",JSON.stringify(Bt)),localStorage.setItem("tts-enabled",JSON.stringify(_e)),localStorage.setItem("tts-voice-uri",Dt),localStorage.setItem("tts-rate",JSON.stringify(Ft)),localStorage.setItem("tts-pitch",JSON.stringify(zt)),localStorage.setItem("offline-max-tokens",JSON.stringify(_t)),localStorage.setItem("offline-top-k",JSON.stringify($t)),localStorage.setItem("offline-temperature",JSON.stringify(Ut)),localStorage.setItem("offline-random-seed",JSON.stringify(Wt)),localStorage.setItem("offline-support-audio",JSON.stringify(Ht)),localStorage.setItem("offline-max-num-images",JSON.stringify(Gt)),localStorage.setItem("is-noise-cancellation-enabled",JSON.stringify(Jt)),localStorage.setItem("audio-gain-value",JSON.stringify(Kt)),localStorage.setItem("selected-ocr-model",qt),localStorage.setItem("is-ocr-auto-init-enabled",JSON.stringify(kt))},ts=h=>{n(h.inputText),i(h.translatedText),u(h.sourceLang),y(h.targetLang),Y(!1)},as=()=>{B([]),localStorage.removeItem("translation-history")},Ct=s.useCallback((h,g)=>{it(l=>({...l,[h]:g}))},[]),ss=s.useCallback((h,g)=>{Ot.startDownload(h,g,fe,l=>Ct(h,l))},[fe,Ct]),ns=s.useCallback((h,g)=>{Ot.resumeDownload(h,g,fe,l=>Ct(h,l))},[fe,Ct]),os=s.useCallback(h=>{Ot.pauseDownload(h)},[]),rs=s.useCallback(async h=>{await Ot.deleteModel(h),Ct(h,{downloaded:0,total:0,percent:0,status:"not_started"})},[Ct]),is=s.useCallback(async h=>{if(re||!P.current)return;const g=Qe.find(l=>l.id===h);if(!g){C(`ASR model ${h} not found.`,"error");return}Ge(!0),Ke({file:"",progress:0}),P.current.postMessage({type:"load",payload:{modelId:g.id,quantization:g.quantization}})},[re,C]),ls=s.useCallback(async()=>{try{P.current&&(P.current.terminate(),P.current=null),De(!1),await qs(),St().then(Je),C(t("notifications.asrModelDeleted"),"success")}catch(h){const g=h instanceof Error?h.message:"Unknown error";C(g,"error")}},[St,C,t]);return e.jsxs("div",{className:"bg-slate-100 h-full flex flex-col",children:[e.jsxs("div",{className:"w-full h-full max-w-6xl mx-auto flex-grow flex flex-col landscape:flex-row p-2 landscape:p-4 gap-4",children:[e.jsx("main",{className:"flex-1 landscape:h-full flex flex-col min-h-0 min-w-0",children:e.jsx(zs,{translatedText:r,targetLang:c,setTargetLang:y,isLoading:b,onSpeak:Ja,onSwapLanguages:Ga,onOpenHistory:()=>Y(!0),onClearText:()=>i(""),isOfflineModeEnabled:z,isOfflineModelInitializing:J,isOfflineModelReady:de,offlineModelName:G,isSpeaking:me,speakingGender:Re,onlineProvider:L,isOfflineTtsEnabled:ve,isAstRecording:A,onToggleAstRecording:Za,recordingCountdown:Et})}),e.jsx("div",{className:"flex-1 landscape:h-full flex flex-col min-h-0 min-w-0",children:e.jsx(Fs,{inputText:o,setInputText:n,sourceLang:d,setSourceLang:u,isLoading:b||J||re||se==="initializing"||p,onTranslate:Wa,onCancel:Ha,isRecording:v,onToggleRecording:Ya,onOpenCamera:()=>I(!0),onOpenSettings:()=>ae(!0),isOnline:x,isOfflineModeEnabled:z,isOfflineModelReady:de,recordingCountdown:Et})})]}),xe&&e.jsx("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 px-4 py-3 rounded z-20 shadow-lg text-white ${xe.type==="error"?"bg-red-500":xe.type==="success"?"bg-green-500":"bg-blue-500"}`,role:"alert",children:xe.message}),F&&e.jsx(Bs,{onClose:()=>I(!1),onImageCaptured:Qa}),e.jsx(_s,{isOpen:X,onClose:()=>ae(!1),onSave:es,currentApiKey:M,currentModelName:$,currentOnlineProvider:L,currentOpenaiApiUrl:N,currentHuggingFaceApiKey:fe,currentOfflineModelName:G,currentIsOfflineModeEnabled:z,currentIsTwoStepJpCnEnabled:Ie,downloadProgress:rt,onStartDownload:ss,onResumeDownload:ns,onPauseDownload:os,onDeleteModel:rs,isOfflineModelInitializing:J,voices:Le,targetLang:c,currentIsOfflineTtsEnabled:ve,currentOfflineTtsVoiceURI:at,currentOfflineTtsRate:Se,currentOfflineTtsPitch:nt,currentOfflineMaxTokens:K,currentOfflineTopK:lt,currentOfflineTemperature:We,currentOfflineRandomSeed:ut,currentOfflineSupportAudio:ge,currentOfflineMaxNumImages:Pe,currentIsOfflineAsrEnabled:q,currentIsWebSpeechApiEnabled:V,currentAsrModelId:je,currentIsNoiseCancellationEnabled:Fe,currentAudioGainValue:ze,asrModelsCacheStatus:Qt,isAsrInitializing:re,asrLoadingProgress:ea,onDownloadAsrModel:is,onClearAsrCache:ls,ocrEngineStatus:se,ocrEngineError:Mt,onInitializeOcr:Tt,currentSelectedOcrModel:wt,currentIsOcrAutoInitEnabled:he}),e.jsx($s,{isOpen:ee,onClose:()=>Y(!1),history:ue,onSelectHistory:ts,onClearHistory:as})]})},sn={en:{translation:{languages:{autoDetect:"Auto Detect",english:"English",chineseTraditional:"Chinese (Traditional)",chineseTraditionalHK:"Chinese (Traditional) HK",chineseSimplified:"Chinese (Simplified)",spanish:"Spanish",japanese:"Japanese",french:"French",german:"German",korean:"Korean",russian:"Russian",portuguese:"Portuguese",italian:"Italian"},translationInput:{online:"Online",offline:"Offline",cameraAriaLabel:"Translate from camera",settingsAriaLabel:"Open settings",placeholderListening:"Listening...",placeholderEnterText:"Enter text to translate",clearText:"Clear text",countdownPrefix:"0:",recordingStop:"Stop recording",recordingStart:"Start recording",cancelTranslation:"Cancel Translation",translateOffline:"Translate using offline model",translate:"Translate",countdown:"Time left: {{seconds}}s"},translationOutput:{modeOnline:"Mode: Online ({{provider}})",modeOfflineInitializing:"Mode: Offline ({{modelName}}) - Initializing...",modeOfflineReady:"Mode: Offline ({{modelName}})",modeOfflineNotReady:"Mode: Offline ({{modelName}}) - Model not ready",modeOfflineNoModel:"Mode: Offline - No model selected",flipScreenAriaLabel:"Flip screen",copyAriaLabel:"Copy translated text",historyAriaLabel:"View translation history",clearAriaLabel:"Clear translated text",placeholder:"Translation",speakStop:"Stop speaking",speakCustomVoice:"Speak with custom voice",speakFemale:"Speak with female voice",speakMale:"Speak with male voice",astStop:"Stop speech translation",astStart:"Start speech translation",astTitle:"Automatic Speech Translation"},settings:{title:"Settings",closeAriaLabel:"Close settings",tabOnline:"Online",tabOffline:"Offline AI",tabSpeech:"Speech",tabTts:"Offline TTS",tabOfflineParams:"Offline Params",tabOcr:"PaddleOCR",subTabModels:"LLM Models",subTabParameters:"Model Parameters",providerLabel:"Provider",providerGemini:"Gemini",providerOpenAI:"OpenAI",openaiUrlLabel:"OpenAI API URL",openaiUrlPlaceholder:"e.g., https://api.openai.com",apiKeyLabel:"API Key",apiKeyPlaceholder:"Enter your Gemini or OpenAI API Key",modelNameLabel:"Model Name",modelNameGeminiPlaceholder:"e.g., gemini-2.5-flash",modelNameOpenAIPlaceholder:"e.g., gpt-4o",hfApiKeyLabel:"Hugging Face API Key",hfApiKeyPlaceholder:"Required to download models",hfApiKeyDescription:"A key is required for model downloads from Hugging Face.",manageModelsLabel:"Select & Download Offline LLM Model",addCustomModelTitle:"Add Custom Model",customModelUrlLabel:"Hugging Face Model URL",customModelUrlPlaceholder:"e.g., https://huggingface.co/org/repo",customModelLibUrlLabel:"Model Library URL (.wasm)",customModelLibUrlPlaceholder:"e.g., https://.../lib.wasm",addCustomModelButton:"Download and Use Custom Model",asrModelLabel:"Select & Download Offline Speech Recognition Model (ASR)",ocrModelLabel:"Select OCR Model",initializeOcr:"Initialize OCR Engine",switchOcr:"Switch/Reload OCR Model",enableOcrAutoInitLabel:"Auto-initialize OCR Engine",enableOcrAutoInitDescription:"Automatically loads the OCR model on startup for instant camera translation.",download:"Download",pause:"Pause",resume:"Resume",retry:"Retry",deleteModelAriaLabel:"Delete {{modelName}}",modelCached:"Cached",modelDownload:"Download",modelDownloading:"Downloading...",statusInitializing:"Initializing...",statusError:"Error: {{error}}",enableOfflineLabel:"Enable Offline Translation",enableOfflineDescription:"Use local model for translations.",enableWebSpeechLabel:"Web Speech API",enableWebSpeechDescription:"Use browser's built-in recognition (Online).",enableOfflineAsrLabel:"Offline ASR (Whisper)",enableOfflineAsrDescription:"Use local Whisper model. Works with Online & Offline translation.",enableGemmaAudioLabel:"Gemma 3N Native Audio",enableGemmaAudioDescription:"Use LLM's native audio capability. Requires Offline Translation Mode.",enableTwoStepLabel:"High-Accuracy JP→ZH Mode",enableTwoStepDescription:"Improves Japanese to Chinese translation via English.",audioProcessingLabel:"Audio Processing (Whisper)",enableNoiseCancellationLabel:"Noise Cancellation",enableNoiseCancellationDescription:"Reduce background noise.",audioGainLabel:"Microphone Gain",clearCacheButton:"Clear LLM Cache",clearCacheDescription:"Remove all downloaded LLM models.",clearAsrCacheButton:"Clear ASR Cache",ttsSettingsLabel:"Text-to-Speech (TTS) Settings",enableCustomTtsLabel:"Enable Custom Offline TTS",enableCustomTtsDescription:"Customize the voice for text-to-speech.",voiceLabel:"Voice",voicePlaceholder:"No voices available for {{languageName}}",rateLabel:"Rate",pitchLabel:"Pitch",offlineParamsDescription:"Advanced parameters for the local offline model. Changes will require the model to be re-initialized.",maxTokensLabel:"Max Tokens",topKLabel:"Top K",temperatureLabel:"Temperature",randomSeedLabel:"Random Seed",supportAudioLabel:"Enable Audio Input (Gemma)",supportAudioDescription:"Allows the model to process audio files.",maxNumImagesLabel:"Enable Image Input (for OCR)",maxNumImagesDescription:"Allows the model to process one image.",clearSettingsButton:"Clear All Settings",saveSettingsButton:"Save Settings",languageLabel:"UI Language",clearAllAriaLabel:"Clear all settings and cached models"},history:{title:"Translation History",closeAriaLabel:"Close history",empty:"No history yet.",selectAriaLabel:"Select translation from {{sourceLang}} to {{targetLang}}",clearAriaLabel:"Clear all translation history",clearButton:"Clear History"},camera:{title:"Camera Translation View",closeAriaLabel:"Close camera view",errorAccess:"Could not access the camera. Please ensure permissions are granted.",errorCapture:"Failed to capture image: {{message}}",errorLoad:"Failed to load image: {{message}}",zoomAriaLabel:"Zoom camera",galleryAriaLabel:"Import from gallery",captureAriaLabel:"Capture and process image",processingAriaLabel:"Processing image",flashOffAriaLabel:"Turn on flash",flashOnAriaLabel:"Turn off flash"},notifications:{offlineModelInitSuccess:"Offline model {{modelIdentifier}} initialized successfully.",offlineModelInitFailed:"Failed to load offline model.",translationFailed:"Translation Failed: {{errorMessage}}",speechError:"Speech synthesis error: {{error}}",speechRecognitionError:"Speech recognition error: {{error}}",mediaRecorderUnsupported:"MediaRecorder API is not supported in this browser.",processingAudio:"[Processing audio...]",noAudioRecorded:"No audio was recorded.",transcriptionFailed:"Transcription Failed: {{errorMessage}}",transcriptionFailedEmpty:"Transcription failed or no speech was detected. Please try again.",micPermissionError:"Could not start recording. Please grant microphone permissions.",offlineModelNotReadyRecording:"Offline model is not ready for recording.",offlineSRError:"You are offline. Cannot use online speech recognition.",astFailed:"AST Failed: {{errorMessage}}",astSelectLanguage:"Please select a source language before using speech translation.",astOfflineModelNotReady:"Offline model is not ready for speech translation.",astOfflineError:"You are offline. Cannot use online speech translation.",processingImage:"[Processing image...]",offlineImageError:"Offline model is not ready for image processing.",noTextInImage:"No text found in the image.",offlineImageTranslateError:"You are offline. Cannot use online image translation.",imageProcessingFailed:"Image Processing Failed: {{errorMessage}}",offlineFeatureUnavailable:"This feature is not available in offline mode.",cacheCleared:"Offline model cache has been cleared successfully.",downloadInProgress:"A model is already being downloaded. Please wait.",modelDownloaded:"Model {{modelId}} downloaded successfully.",modelDeleted:"Model {{modelId}} deleted successfully.",customModelUrlError:"Please provide both the model URL and the model library URL.",customModelSelected:"Custom model has been selected.",cacheClearError:"Please enable offline mode and select a model before clearing the cache.",transcribing:"[Transcribing...]",transcribingApi:"[Transcribing via API...]",asrReady:"Speech recognition model is ready.",asrFailed:"Failed to initialize speech recognition model: {{error}}",asrModelDeleted:"ASR model cache cleared successfully.",asrModelUnloaded:"Offline speech model unloaded successfully.",asrOnlineUnavailable:"Offline ASR is only available in Offline Translation Mode.",modelIdleUnloaded:"Offline model unloaded due to inactivity to save resources. It will reload on next use.",ocrNotReady:"OCR engine not ready. Please initialize it in Settings > PaddleOCR v5."},common:{status:{not_started:"Not Started",downloading:"Downloading",paused:"Paused",completed:"Completed",error:"Error",consolidating:"Consolidating...",initializing:"Initializing..."}}}},"zh-TW":{translation:{languages:{autoDetect:"自動偵測",english:"英文",chineseTraditional:"繁體中文",chineseTraditionalHK:"繁體中文 (香港)",chineseSimplified:"簡體中文",spanish:"西班牙文",japanese:"日文",french:"法文",german:"德文",korean:"韓文",russian:"俄文",portuguese:"葡萄牙文",italian:"義大利文"},translationInput:{online:"線上",offline:"離線",cameraAriaLabel:"使用相機翻譯",settingsAriaLabel:"開啟設定",placeholderListening:"正在聆聽...",placeholderEnterText:"輸入要翻譯的文字",clearText:"清除文字",countdownPrefix:"0:",recordingStop:"停止錄音",recordingStart:"開始錄音",cancelTranslation:"取消翻譯",translateOffline:"使用離線模型翻譯",translate:"翻譯",countdown:"剩餘時間：{{seconds}}秒"},translationOutput:{modeOnline:"模式：線上 ({{provider}})",modeOfflineInitializing:"模式：離線 ({{modelName}}) - 初始化中...",modeOfflineReady:"模式：離線 ({{modelName}})",modeOfflineNotReady:"模式：離線 ({{modelName}}) - 模型未就緒",modeOfflineNoModel:"模式：離線 - 未選擇模型",flipScreenAriaLabel:"翻轉螢幕",copyAriaLabel:"複製翻譯結果",historyAriaLabel:"檢視翻譯歷史",clearAriaLabel:"清除翻譯結果",placeholder:"翻譯結果",speakStop:"停止朗讀",speakCustomVoice:"使用自訂語音朗讀",speakFemale:"使用女聲朗讀",speakMale:"使用男聲朗讀",astStop:"停止語音翻譯",astStart:"開始語音翻譯",astTitle:"即時語音翻譯"},settings:{title:"設定",closeAriaLabel:"關閉設定",tabOnline:"線上",tabOffline:"離線AI",tabSpeech:"語音",tabTts:"離線 TTS",tabOfflineParams:"離線參數",tabOcr:"PaddleOCR",subTabModels:"LLM 模型",subTabParameters:"模型參數",providerLabel:"服務提供商",providerGemini:"Gemini",providerOpenAI:"OpenAI",openaiUrlLabel:"OpenAI API URL",openaiUrlPlaceholder:"例如：https://api.openai.com",apiKeyLabel:"API 金鑰",apiKeyPlaceholder:"輸入您的 Gemini 或 OpenAI API 金鑰",modelNameLabel:"模型名稱",modelNameGeminiPlaceholder:"例如：gemini-2.5-flash",modelNameOpenAIPlaceholder:"例如：gpt-4o",hfApiKeyLabel:"Hugging Face API 金鑰",hfApiKeyPlaceholder:"下載模型需要金鑰",hfApiKeyDescription:"從 Hugging Face 下載模型需要金鑰。",manageModelsLabel:"選擇並下載離線 LLM 模型",addCustomModelTitle:"新增自訂模型",customModelUrlLabel:"Hugging Face 模型 URL",customModelUrlPlaceholder:"例如：https://huggingface.co/org/repo",customModelLibUrlLabel:"模型庫 URL (.wasm)",customModelLibUrlPlaceholder:"例如：https://.../lib.wasm",addCustomModelButton:"下載並使用自訂模型",asrModelLabel:"選擇並下載離線語音辨識模型 (ASR)",ocrModelLabel:"選擇 OCR 模型",initializeOcr:"初始化 OCR 引擎",switchOcr:"切換/重載 OCR 模型",enableOcrAutoInitLabel:"自動初始化 OCR 引擎",enableOcrAutoInitDescription:"啟動時自動載入 OCR 模型，以便即時使用相機翻譯。",modelCached:"已快取",modelDownload:"下載",modelDownloading:"下載中...",deleteModelAriaLabel:"刪除 {{modelName}}",download:"下載",pause:"暫停",resume:"繼續",retry:"重試",statusInitializing:"初始化中...",statusError:"錯誤：{{error}}",enableOfflineLabel:"啟用離線翻譯",enableOfflineDescription:"使用本機模型進行翻譯。",enableWebSpeechLabel:"Web Speech API",enableWebSpeechDescription:"使用瀏覽器內建辨識 (線上)。",enableOfflineAsrLabel:"離線 ASR (Whisper)",enableOfflineAsrDescription:"使用本機 Whisper 模型。可搭配線上或離線翻譯。",enableGemmaAudioLabel:"Gemma 3N 原生音訊",enableGemmaAudioDescription:"使用 LLM 原生音訊能力。僅限離線翻譯模式。",enableTwoStepLabel:"高準確度 日→中 模式",enableTwoStepDescription:"透過英文中轉，提升日文到中文的翻譯品質。",audioProcessingLabel:"音訊處理 (Whisper)",enableNoiseCancellationLabel:"降噪",enableNoiseCancellationDescription:"減少背景噪音。",audioGainLabel:"麥克風增益",clearCacheButton:"清除 LLM 快取",clearCacheDescription:"移除所有已下載的 LLM 模型。",clearAsrCacheButton:"清除 ASR 快取",ttsSettingsLabel:"文字轉語音 (TTS) 設定",enableCustomTtsLabel:"啟用自訂離線 TTS",enableCustomTtsDescription:"自訂文字轉語音的聲音。",voiceLabel:"語音",voicePlaceholder:"沒有適用於 {{languageName}} 的語音",rateLabel:"速率",pitchLabel:"音高",offlineParamsDescription:"進階離線模型參數。更改後模型需要重新初始化。",maxTokensLabel:"最大權杖數 (Max Tokens)",topKLabel:"Top K",temperatureLabel:"溫度 (Temperature)",randomSeedLabel:"隨機種子 (Random Seed)",supportAudioLabel:"啟用音訊輸入 (Gemma)",supportAudioDescription:"允許模型處理音訊檔案。",maxNumImagesLabel:"啟用圖片輸入 (用於文字擷取)",maxNumImagesDescription:"允許模型處理一張圖片。",clearSettingsButton:"清除所有設定",saveSettingsButton:"儲存設定",languageLabel:"介面語言",clearAllAriaLabel:"清除所有設定和快取模型"},history:{title:"翻譯歷史",closeAriaLabel:"關閉歷史紀錄",empty:"尚無歷史紀錄。",selectAriaLabel:"選擇從 {{sourceLang}} 到 {{targetLang}} 的翻譯",clearAriaLabel:"清除所有翻譯歷史",clearButton:"清除歷史"},camera:{title:"相機翻譯畫面",closeAriaLabel:"關閉相機畫面",errorAccess:"無法存取相機。請確認已授予權限。",errorCapture:"擷取影像失敗：{{message}}",errorLoad:"載入影像失敗：{{message}}",zoomAriaLabel:"縮放相機",galleryAriaLabel:"從相簿匯入",captureAriaLabel:"擷取並處理影像",processingAriaLabel:"正在處理影像",flashOffAriaLabel:"開啟閃光燈",flashOnAriaLabel:"關閉閃光燈"},notifications:{offlineModelInitSuccess:"離線模型 {{modelIdentifier}} 初始化成功。",offlineModelInitFailed:"載入離線模型失敗。",translationFailed:"翻譯失敗：{{errorMessage}}",speechError:"語音合成錯誤：{{error}}",speechRecognitionError:"語音辨識錯誤：{{error}}",mediaRecorderUnsupported:"此瀏覽器不支援 MediaRecorder API。",processingAudio:"[正在處理音訊...]",noAudioRecorded:"未錄製到任何音訊。",transcriptionFailed:"語音轉文字失敗：{{errorMessage}}",transcriptionFailedEmpty:"語音轉文字失敗或未偵測到語音，請重試。",micPermissionError:"無法開始錄音。請授予麥克風權限。",offlineModelNotReadyRecording:"離線模型尚未準備好進行錄音。",offlineSRError:"您處於離線狀態，無法使用線上語音辨識。",astFailed:"語音翻譯失敗：{{errorMessage}}",astSelectLanguage:"使用語音翻譯前，請先選擇來源語言。",astOfflineModelNotReady:"離線模型尚未準備好進行語音翻譯。",astOfflineError:"您處於離線狀態，無法使用線上語音翻譯。",processingImage:"[正在處理影像...]",offlineImageError:"離線模型尚未準備好進行影像處理。",noTextInImage:"影像中未找到文字。",offlineImageTranslateError:"您處於離線狀態，無法使用線上影像翻譯。",imageProcessingFailed:"影像處理失敗：{{errorMessage}}",offlineFeatureUnavailable:"此功能在離線模式下不可用。",cacheCleared:"已成功清除離線模型快取。",downloadInProgress:"已有模型正在下載，請稍候。",modelDownloaded:"模型 {{modelId}} 下載成功。",modelDeleted:"模型 {{modelId}} 刪除成功。",customModelUrlError:"請同時提供模型 URL 和模型庫 URL。",customModelSelected:"已選擇自訂模型。",cacheClearError:"請先啟用離線模式並選擇一個模型，然後再清除快取。",transcribing:"[語音轉換文字中...]",transcribingApi:"[透過 API 轉換語音中...]",asrReady:"語音辨識模型已就緒。",asrFailed:"語音辨識模型初始化失敗：{{error}}",asrModelDeleted:"ASR 模型快取已清除成功。",asrModelUnloaded:"離線語音模型已成功卸載。",asrOnlineUnavailable:"離線 ASR 僅在離線翻譯模式下可用。",modelIdleUnloaded:"離線模型因閒置而卸載以節省資源，下次使用時將自動重新載入。",ocrNotReady:"OCR 引擎尚未就緒。請在 設定 > PaddleOCR v5 中進行初始化。"},common:{status:{not_started:"未開始",downloading:"下載中",paused:"已暫停",completed:"已完成",error:"錯誤",consolidating:"整合中...",initializing:"初始化中..."}}}}};ps.use(bs).use(ws).init({resources:sn,fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const Ua=document.getElementById("root");if(!Ua)throw new Error("Could not find root element to mount to");const nn=xs.createRoot(Ua);nn.render(e.jsx(Na.StrictMode,{children:e.jsx(Na.Suspense,{fallback:"Loading...",children:e.jsx(an,{})})}));
