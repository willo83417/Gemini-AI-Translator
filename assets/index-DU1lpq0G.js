var as=Object.defineProperty;var ss=(t,a,o)=>a in t?as(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o;var Wt=(t,a,o)=>ss(t,typeof a!="symbol"?a+"":a,o);import{j as e,u as Ze,r as s,W as ns,G as ga,T as ca,o as os,_ as ha,B as rs,a as is,L as ls,i as cs,b as ds,c as us,R as fs,d as ja}from"./vendor-CCrPfgt9.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=o(r);fetch(r.href,l)}})();const aa=[{code:"auto",name:"languages.autoDetect"},{code:"en",name:"languages.english",asrCode:"en"},{code:"zh-TW",name:"languages.chineseTraditional",asrCode:"zh"},{code:"zh-HK",name:"languages.chineseTraditionalHK",asrCode:"zh"},{code:"zh-CN",name:"languages.chineseSimplified",asrCode:"zh"},{code:"es",name:"languages.spanish",asrCode:"es"},{code:"ja",name:"languages.japanese",asrCode:"ja"},{code:"fr",name:"languages.french",asrCode:"fr"},{code:"de",name:"languages.german",asrCode:"de"},{code:"ko",name:"languages.korean",asrCode:"ko"},{code:"ru",name:"languages.russian",asrCode:"ru"},{code:"it",name:"languages.italian",asrCode:"it"}],sa=[{name:"Gemma-3n-E2B (3.04 GB)",value:"gemma-3n-E2B-it-int4-Web.litertlm",url:"https://huggingface.co/willopcbeta/Gemma-3n-Web/resolve/main/gemma-3n-E2B-it-int4-Web.litertlm"},{name:"Gemma-3n-E4B (4.28 GB)",value:"gemma-3n-E4B-it-int4-Web.litertlm",url:"https://huggingface.co/willopcbeta/Gemma-3n-Web/resolve/main/gemma-3n-E4B-it-int4-Web.litertlm"}],Ye=[{id:"nicky48/whisper-large-v3-turbo-ONNX",name:"whisper-large-v3-turbo (q4f16)",quantization:{encoder_model:"q4f16",decoder_model_merged:"q4f16"},size:"~600 MB"},{id:"Xenova/whisper-small",name:"Whisper small (q4)",quantization:{encoder_model:"q4",decoder_model_merged:"q4"},size:"~300 MB"},{id:"Xenova/whisper-base",name:"Whisper Base (q4)",quantization:{encoder_model:"q4",decoder_model_merged:"q4"},size:"~150 MB"}],fa={ch_v5:{name:"ch_PP-OCRv5_mobile",description:"Chinese/English/Japanese",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/ch_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/ch_PP-OCRv5_rec_mobile_infer/ppocrv5_dict.txt"}},latin_v5:{name:"latin_PP-OCRv5_mobile",description:"Latin languages (French, German, Spanish, etc.)",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/latin_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/latin_PP-OCRv5_rec_mobile_infer/ppocrv5_latin_dict.txt"}},kr_v5:{name:"korean_PP-OCRv5_mobile",description:"Korean Only",paths:{detPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/det/ch_PP-OCRv5_mobile_det.onnx",recPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/onnx/PP-OCRv5/rec/korean_PP-OCRv5_rec_mobile_infer.onnx",dictPath:"https://www.modelscope.cn/models/RapidAI/RapidOCR/resolve/v3.4.0/paddle/PP-OCRv5/rec/korean_PP-OCRv5_rec_mobile_infer/ppocrv5_korean_dict.txt"}}},ms=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"})}),gs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4a4 4 0 100 8 4 4 0 000-8zM8 21v-2a4 4 0 014-4h0a4 4 0 014 4v2"})}),hs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4a4 4 0 100 8 4 4 0 000-8zM6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"})}),ps=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),bs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),ws=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),xs=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),ys=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),vs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5h12M9 3v2m4 13-4-4-4 4M5 11h10a2 2 0 012 2v2a2 2 0 01-2 2H5a2 2 0 01-2-2v-2a2 2 0 012-2zM19 9l-2 2-2-2"})}),Ht=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),Ss=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16V4m0 12L4 9m3 3l3-3m6 8V4m0 12l3-3m-3 3l-3-3"})}),js=t=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 1l4 4-4 4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 11V9a4 4 0 014-4h14"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 23l-4-4 4-4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13v2a4 4 0 01-4 4H3"})]}),Ma=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),ma=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Cs=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),ks=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825L10 14h- hükümet 3L13 10V3L5.125 10.125m13.75 3.75L15 10m-2.125 8.825L18 14h-3l-1.875 4.825zM1 1l22 22"})}),Os=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Is=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.111 16.222c1.733-1.733 4.589-1.733 6.322 0M5.444 13.556c3.222-3.222 8.444-3.222 11.667 0M2.778 10.889c4.711-4.711 12.333-4.711 17.044 0"})}),As=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.111 16.222c1.733-1.733 4.589-1.733 6.322 0M5.444 13.556c.9-1.033 2.022-1.9 3.222-2.589m5.667.122c.711.389 1.356.844 1.933 1.389M2.778 10.889a14.838 14.838 0 012.667-3.022m11.6.022a14.833 14.833 0 012.667 3.022M1 1l22 22"})}),Ls=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"currentColor",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 017.5 5.25h9a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-9z"})}),Ea=({selectedLang:t,setSelectedLang:a,languages:o})=>{const{t:n}=Ze(),[r,l]=s.useState(!1),[d,u]=s.useState("bottom"),i=s.useRef(null),x=s.useRef(null),w=p=>{a(p),l(!1)};s.useEffect(()=>{if(r&&x.current){const p=x.current.getBoundingClientRect(),y=240;window.innerHeight-p.bottom<y&&p.top>y?u("top"):u("bottom")}},[r]),s.useEffect(()=>{const p=y=>{i.current&&!i.current.contains(y.target)&&l(!1)};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[]);const m=d==="top"?"bottom-full mb-2":"mt-2";return e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{ref:x,onClick:()=>l(!r),className:"flex items-center space-x-2 text-lg font-semibold text-gray-700 hover:text-blue-600",children:[e.jsx("span",{children:n(t.name)}),e.jsx(ws,{className:`h-2.5 w-2.5 transition-transform ${r?"rotate-180":""}`})]}),r&&e.jsx("div",{className:`absolute z-10 ${m} w-56 bg-white rounded-md shadow-lg border border-gray-100 max-h-60 overflow-y-auto`,children:e.jsx("ul",{className:"py-1",children:o.map(p=>e.jsx("li",{children:e.jsx("button",{onClick:()=>w(p),className:`w-full text-left px-4 py-2 text-sm ${t.code===p.code?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-gray-100"}`,children:n(p.name)})},p.code))})})]})},Ca=3e3,Ns=({inputText:t,setInputText:a,sourceLang:o,setSourceLang:n,isLoading:r,onTranslate:l,onCancel:d,isRecording:u,onToggleRecording:i,onOpenCamera:x,onOpenSettings:w,isOnline:m,isOfflineModeEnabled:p,isOfflineModelReady:y,recordingCountdown:v})=>{const{t:C}=Ze(),O=R=>{R.target.value.length<=Ca&&a(R.target.value)},T=!t.trim()||u||(p?!y:!m),L=()=>{r?d():l()};return e.jsxs("div",{className:"bg-white rounded-xl shadow-md h-full flex flex-col p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(Ea,{selectedLang:o,setSelectedLang:n,languages:aa}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-500",children:[e.jsx("div",{title:C(m?"translationInput.online":"translationInput.offline"),children:m?e.jsx(Is,{className:"text-green-500"}):e.jsx(As,{className:"text-gray-400"})}),e.jsx("button",{onClick:x,className:"hover:text-blue-500","aria-label":C("translationInput.cameraAriaLabel"),children:e.jsx(xs,{})}),e.jsx("button",{onClick:w,className:"hover:text-blue-500","aria-label":C("translationInput.settingsAriaLabel"),children:e.jsx(ys,{})})]})]}),e.jsxs("div",{className:"relative border border-gray-200 rounded-lg flex-grow",children:[e.jsx("textarea",{value:t,onChange:O,placeholder:C(u?"translationInput.placeholderListening":"translationInput.placeholderEnterText"),className:"w-full h-full p-4 pr-12 text-lg border-none focus:ring-0 resize-none bg-transparent",disabled:u}),t&&!u&&e.jsx("button",{onClick:()=>a(""),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600","aria-label":C("translationInput.clearText"),children:e.jsx(Ht,{})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-sm text-gray-400 w-20",children:u&&p&&v!==null?e.jsxs("span",{className:"text-red-500 font-semibold text-base tabular-nums",children:[C("translationInput.countdownPrefix"),String(v).padStart(2,"0")]}):`${t.length}/${Ca}`}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:i,className:`p-3 rounded-lg flex items-center justify-center transition-colors ${u?"bg-red-500 text-white animate-pulse":"bg-gray-200 text-gray-600 hover:bg-gray-300"}`,"aria-label":C(u?"translationInput.recordingStop":"translationInput.recordingStart"),children:e.jsx(Ma,{})}),e.jsx("button",{onClick:L,disabled:!r&&T,title:C(r?"translationInput.cancelTranslation":p?"translationInput.translateOffline":"translationInput.translate"),className:`text-white rounded-lg p-3 flex items-center justify-center transition-colors ${r?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed"}`,children:r?e.jsx(Ls,{}):e.jsx(vs,{})})]})]})]})},Rs=({translatedText:t,targetLang:a,setTargetLang:o,isLoading:n,onSpeak:r,onSwapLanguages:l,onOpenHistory:d,onClearText:u,isOfflineModeEnabled:i,isOfflineModelInitializing:x,isOfflineModelReady:w,offlineModelName:m,isSpeaking:p,speakingGender:y,onlineProvider:v,isOfflineTtsEnabled:C,isAstRecording:O,onToggleAstRecording:T,recordingCountdown:L})=>{const{t:R}=Ze(),[X,ee]=s.useState(!1),Y=()=>{t&&navigator.clipboard.writeText(t)},K=()=>{ee(B=>!B)},de=()=>{if(!i){const oe=v.charAt(0).toUpperCase()+v.slice(1);return R("translationOutput.modeOnline",{provider:oe})}const B=sa.find(oe=>oe.value===m),E=B?B.name.split(" ")[0]:"";return x?R("translationOutput.modeOfflineInitializing",{modelName:E}):w?R("translationOutput.modeOfflineReady",{modelName:E}):m?R("translationOutput.modeOfflineNotReady",{modelName:E}):R("translationOutput.modeOfflineNoModel")};return e.jsxs("div",{className:`bg-white rounded-xl shadow-md p-4 h-full flex flex-col transition-transform duration-500 ease-in-out ${X?"rotate-180":""}`,children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx(Ea,{selectedLang:a,setSelectedLang:o,languages:aa.filter(B=>B.code!=="auto")}),e.jsx("button",{onClick:l,className:"p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-500",children:e.jsx(Ss,{})}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-500",children:[e.jsx("button",{onClick:K,className:"hover:text-blue-500","aria-label":R("translationOutput.flipScreenAriaLabel"),children:e.jsx(js,{})}),e.jsx("button",{onClick:Y,disabled:!t,className:"hover:text-blue-500 disabled:text-gray-300 disabled:cursor-not-allowed","aria-label":R("translationOutput.copyAriaLabel"),children:e.jsx(ps,{})}),e.jsx("button",{onClick:d,className:"hover:text-blue-500","aria-label":R("translationOutput.historyAriaLabel"),children:e.jsx(bs,{})}),e.jsx("button",{onClick:u,disabled:!t,className:"hover:text-red-500 disabled:text-gray-300 disabled:cursor-not-allowed","aria-label":R("translationOutput.clearAriaLabel"),children:e.jsx(Ht,{})})]})]}),e.jsx("div",{className:"text-right text-xs text-gray-400 mb-2 px-1",children:de()})]}),e.jsx("div",{className:"text-2xl text-gray-800 break-words flex-grow overflow-y-auto min-h-0 whitespace-pre-wrap",children:n&&!t?e.jsxs("div",{className:"space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2"})]}):t||e.jsx("span",{className:"text-gray-400",children:R("translationOutput.placeholder")})}),e.jsxs("div",{className:"flex items-center justify-start mt-4 space-x-2 flex-shrink-0",children:[C?e.jsx("button",{onClick:()=>r("female"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors ${p?"bg-indigo-600 animate-pulse":"bg-indigo-500 hover:bg-indigo-600"}`,"aria-label":R(p?"translationOutput.speakStop":"translationOutput.speakCustomVoice"),children:e.jsx(ms,{})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r("female"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-pink-200 disabled:cursor-not-allowed transition-colors ${p&&y==="female"?"bg-pink-600 animate-pulse":"bg-pink-400 hover:bg-pink-500"}`,"aria-label":R(p&&y==="female"?"translationOutput.speakStop":"translationOutput.speakFemale"),children:e.jsx(gs,{})}),e.jsx("button",{onClick:()=>r("male"),disabled:!t,className:`text-white rounded-lg p-3 flex items-center justify-center disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors ${p&&y==="male"?"bg-blue-700 animate-pulse":"bg-blue-500 hover:bg-blue-600"}`,"aria-label":R(p&&y==="male"?"translationOutput.speakStop":"translationOutput.speakMale"),children:e.jsx(hs,{})})]}),e.jsx("button",{onClick:T,disabled:n,className:`text-white rounded-lg p-3 flex items-center justify-center transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed ${O?"bg-red-500 animate-pulse":"bg-indigo-500 hover:bg-indigo-600"}`,"aria-label":R(O?"translationOutput.astStop":"translationOutput.astStart"),title:R("translationOutput.astTitle"),children:e.jsx(Ma,{})}),O&&L!==null?e.jsxs("span",{className:"text-red-500 font-semibold text-base tabular-nums ml-2",children:[R("translationInput.countdownPrefix"),String(L).padStart(2,"0")]}):null]})]})},Ms=({onClose:t,onImageCaptured:a})=>{const{t:o}=Ze(),n=s.useRef(null),r=s.useRef(null),[l,d]=s.useState(null),[u,i]=s.useState(null),[x,w]=s.useState(!1),m=s.useRef(!1),[p,y]=s.useState(!1),[v,C]=s.useState(!1),[O,T]=s.useState(0),[L,R]=s.useState(!1),[X,ee]=s.useState({min:1,max:1}),Y=s.useCallback((A,P,N)=>P===N?P:P*Math.pow(N/P,A/100),[]),K=s.useCallback((A,P,N)=>P===N?0:Math.log(A/P)/Math.log(N/P)*100,[]),de=s.useCallback(A=>{d(A);const P=A.getVideoTracks()[0];if(!P)return;const N=P.getCapabilities()||{};if(N.torch&&C(!0),N.zoom){R(!0),ee({min:N.zoom.min,max:N.zoom.max});const Z=P.getSettings().zoom||N.zoom.min;T(K(Z,N.zoom.min,N.zoom.max))}},[K]),B=async A=>{if(!l||!L||m.current)return;const P=parseFloat(A.target.value);T(P);const N=Y(P,X.min,X.max),Z=l.getVideoTracks()[0];try{m.current=!0,await Z.applyConstraints({advanced:[{zoom:N}]})}catch(ue){console.error("Failed to apply zoom:",ue)}finally{m.current=!1}},E=async()=>{if(!l||!v||m.current)return;const A=!p,P=l.getVideoTracks()[0];try{m.current=!0,await P.applyConstraints({advanced:[{torch:A}]}),y(A)}catch(N){console.error("Failed to apply torch:",N)}finally{m.current=!1}},oe=s.useCallback(()=>{if(!(x||!n.current)){w(!0),i(null);try{const A=n.current.getScreenshot({width:1920,height:1080});if(A)a(A);else throw new Error("Could not get screenshot from camera.")}catch(A){const P=A instanceof Error?A.message:"Capture failed.";i(o("camera.errorCapture",{message:P})),w(!1)}}},[x,a,o]),$=A=>{var N;const P=(N=A.target.files)==null?void 0:N[0];if(!(!P||x)){w(!0);try{const Z=new FileReader;Z.onload=ue=>{var J;const Ae=(J=ue.target)==null?void 0:J.result;Ae&&a(Ae)},Z.readAsDataURL(P)}catch{i(o("camera.errorLoad",{message:"File read error"})),w(!1)}}},Ie={facingMode:"environment",width:{ideal:1920},height:{ideal:1080}};return e.jsx("div",{className:"fixed inset-0 bg-black z-50 flex flex-col items-center justify-center overflow-hidden",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(ns,{ref:n,audio:!1,screenshotFormat:"image/jpeg",screenshotQuality:1,videoConstraints:Ie,onUserMedia:de,onUserMediaError:A=>i(o("camera.errorAccess")),className:"w-full h-full object-cover"}),e.jsx("input",{type:"file",accept:"image/*",ref:r,onChange:$,className:"hidden"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-between items-center p-4 z-20 pointer-events-none",children:[e.jsxs("div",{className:"w-full flex justify-between items-start pointer-events-auto",children:[e.jsx("div",{className:"text-white text-xs font-medium bg-black/40 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg border border-white/10"}),e.jsx("button",{onClick:t,className:"text-white bg-black/40 backdrop-blur-sm rounded-full p-2 border border-white/10 hover:bg-black/60 transition-colors shadow-lg","aria-label":o("camera.closeAriaLabel"),children:e.jsx(Ht,{className:"w-8 h-8"})})]}),u&&e.jsx("div",{className:"bg-red-600 text-white px-4 py-2 rounded-full text-sm shadow-xl pointer-events-auto animate-bounce",role:"alert",children:u}),e.jsxs("div",{className:"w-full flex flex-col items-center pb-8 space-y-6 pointer-events-auto",children:[L&&e.jsxs("div",{className:"w-full max-w-xs flex flex-col items-center space-y-2",children:[e.jsxs("div",{className:"flex justify-between w-full px-2 text-[10px] text-white/70 font-bold uppercase tracking-widest",children:[e.jsx("span",{children:"1x"}),e.jsxs("span",{className:"bg-blue-500/80 px-2 py-0.5 rounded text-white",children:[Y(O,X.min,X.max).toFixed(1),"x"]}),e.jsxs("span",{children:[X.max.toFixed(0),"x"]})]}),e.jsx("div",{className:"w-full h-12 flex items-center px-2 bg-black/30 backdrop-blur-md rounded-2xl border border-white/5",children:e.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:O,onChange:B,className:"w-full h-1.5 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-500","aria-label":o("camera.zoomAriaLabel")})})]}),e.jsxs("div",{className:"w-full flex justify-around items-center max-w-sm",children:[e.jsx("button",{onClick:()=>{var A;return(A=r.current)==null?void 0:A.click()},className:"p-3 bg-white/10 backdrop-blur-md rounded-full border border-white/20 text-white hover:bg-white/20 transition-all shadow-lg","aria-label":o("camera.galleryAriaLabel"),children:e.jsx(Os,{className:"w-8 h-8"})}),e.jsxs("button",{onClick:oe,disabled:x,className:"group relative w-20 h-20 flex items-center justify-center disabled:opacity-50","aria-label":o("camera.captureAriaLabel"),children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full animate-pulse group-hover:bg-white/30"}),e.jsx("div",{className:"relative w-16 h-16 bg-white rounded-full shadow-2xl flex items-center justify-center transition-transform active:scale-90",children:x&&e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin",role:"status","aria-label":o("camera.processingAriaLabel")})})]}),v?e.jsx("button",{onClick:E,className:`p-3 backdrop-blur-md rounded-full border transition-all shadow-lg ${p?"bg-yellow-400 border-yellow-500 text-black":"bg-white/10 border-white/20 text-white hover:bg-white/20"}`,"aria-label":o(p?"camera.flashOnAriaLabel":"camera.flashOffAriaLabel"),children:p?e.jsx(Cs,{className:"w-8 h-8"}):e.jsx(ks,{className:"w-8 h-8"})}):e.jsx("div",{className:"w-14 h-14"})]})]})]})]})})},Es=({isOpen:t,onClose:a,onSave:o,currentApiKey:n,currentModelName:r,currentOnlineProvider:l,currentOpenaiApiUrl:d,currentHuggingFaceApiKey:u,currentOfflineModelName:i,currentIsOfflineModeEnabled:x,currentIsTwoStepJpCnEnabled:w,downloadProgress:m,onStartDownload:p,onResumeDownload:y,onPauseDownload:v,onDeleteModel:C,isOfflineModelInitializing:O,voices:T,targetLang:L,currentIsOfflineTtsEnabled:R,currentOfflineTtsVoiceURI:X,currentOfflineTtsRate:ee,currentOfflineTtsPitch:Y,currentOfflineMaxTokens:K,currentOfflineTopK:de,currentOfflineTemperature:B,currentOfflineRandomSeed:E,currentOfflineSupportAudio:oe,currentOfflineMaxNumImages:$,currentIsOfflineAsrEnabled:Ie,currentIsWebSpeechApiEnabled:A,currentAsrModelId:P,currentIsNoiseCancellationEnabled:N,currentAudioGainValue:Z,asrModelsCacheStatus:ue,isAsrInitializing:Ae,asrLoadingProgress:J,onDownloadAsrModel:Gt,onClearAsrCache:Le,ocrEngineStatus:Ne,ocrEngineError:ba,onInitializeOcr:na,currentSelectedOcrModel:Re})=>{const{t:S,i18n:fe}=Ze(),[me,pt]=s.useState("online"),[Se,_e]=s.useState(n),[je,be]=s.useState(r),[Me,Ee]=s.useState(l),[bt,Be]=s.useState(d),[Jt,Qe]=s.useState(u),[et,_]=s.useState(i),[$e,tt]=s.useState(x),[wt,re]=s.useState(w),[W,We]=s.useState(Ie),[Te,Ue]=s.useState(A),[at,He]=s.useState(P),[xt,Ge]=s.useState(N),[st,Je]=s.useState(Z),[yt,ge]=s.useState(R),[Pe,we]=s.useState(X),[vt,Q]=s.useState(ee),[St,G]=s.useState(Y),[nt,Ke]=s.useState([]),[jt,xe]=s.useState(K),[De,ot]=s.useState(de),[qe,Ct]=s.useState(B),[rt,kt]=s.useState(E),[it,ye]=s.useState(oe),[Ot,Ce]=s.useState($),[Ve,lt]=s.useState(Re);if(s.useEffect(()=>{t&&(_e(n),be(r),Ee(l),Be(d),Qe(u),_(i),tt(x),re(w),ge(R),we(X),Q(ee),G(Y),xe(K),ot(de),Ct(B),kt(E),ye(oe),Ce($),We(Ie),Ue(A),He(P),Ge(N),Je(Z),lt(Re))},[t,n,r,l,d,u,i,x,w,R,X,ee,Y,K,de,B,E,oe,$,Ie,A,P,N,Z,Re]),s.useEffect(()=>{var f;if(t&&T.length>0&&L){const I=T.filter(z=>z.lang.startsWith(L.code));Ke(I),Pe&&!I.some(z=>z.voiceURI===Pe)&&we(((f=I[0])==null?void 0:f.voiceURI)||"")}},[t,T,L,Pe]),!t)return null;const It=()=>{o(Se,je,Jt,et,at,$e,W,Te,Me,bt,yt,Pe,vt,St,wt,jt,De,qe,rt,it,Ot,xt,st,Ve),a()},Kt=()=>{_e(""),be("gemini-2.5-flash"),Ee("gemini"),Be(""),Qe(""),_(""),tt(!1),re(!1),ge(!1),we(""),Q(1),G(1),xe(4096),ot(40),Ct(.3),kt(101),ye(!1),Ce(0),lt("ch_v5"),We(!1),Ue(!0),He(Ye[0].id),Ge(!1),Je(1),Le(),sa.forEach(f=>f.value&&C(f.value)),o("","gemini-2.5-flash","","",Ye[0].id,!1,!1,!0,"gemini","",!1,"",1,1,!1,4096,40,.3,101,!1,0,!1,1,"ch_v5")},ct=f=>{_(f.target.value)},dt=f=>{He(f.target.value)},oa=async()=>{const f={key:Ve,...fa[Ve].paths};await na(f)},ke=({tabName:f,label:I})=>e.jsx("button",{onClick:()=>pt(f),className:`px-4 py-2 text-sm font-medium rounded-md focus:outline-none ${me===f?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"}`,"aria-selected":me===f,role:"tab",children:I}),qt=(f,I=2)=>{if(!f||f===0)return"0 Bytes";const z=1024,ae=I<0?0:I,D=["Bytes","KB","MB","GB","TB"],j=Math.floor(Math.log(f)/Math.log(z));return parseFloat((f/Math.pow(z,j)).toFixed(ae))+" "+D[j]},ra=f=>{const I=m[f.value]||{status:"not_started",percent:0,downloaded:0,total:0},z=O&&et===f.value,ae=({onClick:At,text:he,className:ne="bg-blue-500 hover:bg-blue-600",disabled:ie})=>e.jsx("button",{onClick:At,disabled:ie,className:`text-white text-xs font-semibold py-1 px-3 rounded-md transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed ${ne}`,children:he}),D=z||I.status==="consolidating",j=I.status,se=S(`common.status.${j}`);return e.jsxs("div",{className:"flex flex-col space-y-2 p-3 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`model-${f.value}`,name:"offline-model-selection",value:f.value,checked:et===f.value,onChange:ct,disabled:I.status!=="completed"||D,className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 disabled:cursor-not-allowed"}),e.jsx("label",{htmlFor:`model-${f.value}`,className:"ml-2 text-sm font-medium text-gray-800",children:f.name})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[I.status==="not_started"&&e.jsx(ae,{onClick:()=>p(f.value,f.url),text:S("settings.download")}),I.status==="downloading"&&e.jsx(ae,{onClick:()=>v(f.value),text:S("settings.pause"),className:"bg-yellow-500 hover:bg-yellow-600"}),I.status==="paused"&&e.jsx(ae,{onClick:()=>y(f.value,f.url),text:S("settings.resume")}),I.status==="error"&&e.jsx(ae,{onClick:()=>y(f.value,f.url),text:S("settings.retry")}),I.status!=="not_started"&&I.status!=="downloading"&&I.status!=="consolidating"&&e.jsx("button",{onClick:()=>C(f.value),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-full","aria-label":S("settings.deleteModelAriaLabel",{modelName:f.name}),children:e.jsx(ma,{className:"w-4 h-4"})})]})]}),(I.status!=="not_started"||D)&&e.jsxs("div",{children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 relative overflow-hidden",children:e.jsx("div",{className:`h-2 rounded-full ${D?"bg-green-400 w-full animate-pulse":"bg-blue-500"}`,style:{width:`${I.percent}%`}})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex justify-between",children:[e.jsx("span",{children:se}),I.status==="downloading"&&!D&&e.jsxs("span",{children:[qt(I.downloaded)," / ",qt(I.total)," (",Math.round(I.percent),"%)"]})]})]}),I.status==="error"&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:S("settings.statusError",{error:I.error})})]})},Fe=({id:f,label:I,value:z,onChange:ae,min:D,max:j,step:se})=>e.jsxs("div",{children:[e.jsxs("label",{htmlFor:f,className:"flex justify-between items-center text-sm font-medium text-gray-700 mb-1",children:[e.jsx("span",{children:I}),e.jsx("span",{className:"text-gray-500 font-normal",children:z})]}),e.jsx("input",{type:"range",id:f,min:D,max:j,step:se,value:z,onChange:ae,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),te=({id:f,isEnabled:I,setIsEnabled:z,title:ae,description:D,disabled:j})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:f,className:`text-sm font-medium ${j?"text-gray-400":"text-gray-700"}`,children:[ae,e.jsx("span",{className:`block text-xs ${j?"text-gray-300":"text-gray-500"}`,children:D})]}),e.jsx("button",{id:f,onClick:()=>!j&&z(!I),disabled:j,className:`relative inline-flex items-center h-6 rounded-full w-11 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${I?"bg-blue-600":"bg-gray-200"} ${j?"opacity-50 cursor-not-allowed":""}`,role:"switch","aria-checked":I,children:e.jsx("span",{className:`inline-block w-4 h-4 transform bg-white rounded-full transition-transform ${I?"translate-x-6":"translate-x-1"}`})})]});return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"settings-title",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl h-full w-full max-w-md overflow-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{id:"settings-title",className:"text-xl font-semibold text-gray-800",children:S("settings.title")}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600","aria-label":S("settings.closeAriaLabel"),children:e.jsx(Ht,{})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"language-select",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.languageLabel")}),e.jsxs("select",{id:"language-select",value:fe.language,onChange:f=>fe.changeLanguage(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"zh-TW",children:"繁體中文"})]})]})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-2 p-2 overflow-x-auto",role:"tablist","aria-label":"Settings tabs",children:[e.jsx(ke,{tabName:"online",label:S("settings.tabOnline")}),e.jsx(ke,{tabName:"offline",label:S("settings.tabOffline")}),e.jsx(ke,{tabName:"speech",label:S("settings.tabSpeech")}),e.jsx(ke,{tabName:"tts",label:S("settings.tabTts")}),e.jsx(ke,{tabName:"offline-params",label:S("settings.tabOfflineParams")}),e.jsx(ke,{tabName:"ocr",label:S("settings.tabOcr")})]})}),e.jsxs("div",{className:"p-6 space-y-6 min-h-[350px]",children:[me==="online"&&e.jsxs("div",{role:"tabpanel",id:"online-settings","aria-labelledby":"online-tab",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:S("settings.providerLabel")}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"provider-gemini",name:"online-provider",type:"radio",value:"gemini",checked:Me==="gemini",onChange:f=>Ee(f.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"provider-gemini",className:"ml-2 block text-sm text-gray-900",children:S("settings.providerGemini")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"provider-openai",name:"online-provider",type:"radio",value:"openai",checked:Me==="openai",onChange:f=>Ee(f.target.value),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"provider-openai",className:"ml-2 block text-sm text-gray-900",children:S("settings.providerOpenAI")})]})]})]}),Me==="openai"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"openai-api-url",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.openaiUrlLabel")}),e.jsx("input",{type:"text",id:"openai-api-url",value:bt,onChange:f=>Be(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:S("settings.openaiUrlPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"api-key",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.apiKeyLabel")}),e.jsx("input",{type:"password",id:"api-key",value:Se,onChange:f=>_e(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:S("settings.apiKeyPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"model-name",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.modelNameLabel")}),e.jsx("input",{type:"text",id:"model-name",value:je,onChange:f=>be(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white",placeholder:S(Me==="gemini"?"settings.modelNameGeminiPlaceholder":"settings.modelNameOpenAIPlaceholder")})]})]}),me==="offline"&&e.jsxs("div",{role:"tabpanel",id:"offline-settings","aria-labelledby":"offline-tab",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:S("settings.manageModelsLabel")}),sa.filter(f=>f.value).map(f=>e.jsx("div",{children:ra(f)},f.value))]}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx(te,{id:"offline-toggle",isEnabled:$e,setIsEnabled:tt,title:S("settings.enableOfflineLabel"),description:S("settings.enableOfflineDescription")}),e.jsx(te,{id:"twostep-toggle",isEnabled:wt,setIsEnabled:re,title:S("settings.enableTwoStepLabel"),description:S("settings.enableTwoStepDescription")})]})]}),me==="speech"&&e.jsxs("div",{role:"tabpanel",id:"speech-settings","aria-labelledby":"speech-tab",className:"space-y-6",children:[e.jsx(te,{id:"web-speech-toggle",isEnabled:Te,setIsEnabled:f=>{Ue(f)},title:S("settings.enableWebSpeechLabel"),description:S("settings.enableWebSpeechDescription")}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx(te,{id:"asr-toggle",isEnabled:W,setIsEnabled:f=>{We(f),f&&ye(!1)},title:S("settings.enableOfflineAsrLabel"),description:S("settings.enableOfflineAsrDescription")}),e.jsxs("div",{className:`space-y-3 transition-opacity ${W?"":"opacity-50"}`,children:[e.jsx("label",{className:`block text-sm font-medium ${W?"text-gray-700":"text-gray-400"}`,children:S("settings.asrModelLabel")}),Ye.map(f=>{const I=ue[f.id]||!1,z=Ae&&at===f.id;return e.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg bg-gray-50 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:`asr-model-${f.id}`,name:"asr-model-selection",value:f.id,checked:at===f.id,onChange:dt,className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500",disabled:!W}),e.jsxs("label",{htmlFor:`asr-model-${f.id}`,className:`ml-3 text-sm font-medium ${W?"text-gray-800":"text-gray-400"}`,children:[f.name," ",e.jsxs("span",{className:"text-gray-500 font-normal",children:["(",f.size,")"]})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:!z&&(I?e.jsx("span",{className:"text-sm font-medium text-green-600",children:S("settings.modelCached")||"Cached"}):e.jsx("button",{onClick:()=>Gt(f.id),disabled:Ae||!W,className:"text-sm font-medium text-blue-600 hover:text-blue-800 disabled:text-gray-400 disabled:cursor-not-allowed",children:S("settings.modelDownload")||"Download"}))})]}),z&&e.jsxs("div",{className:"pt-1 text-center text-sm text-blue-600",children:[J.file," (",Math.round(J.progress),"%)"]})]},f.id)}),e.jsx("div",{children:e.jsxs("button",{onClick:Le,disabled:!W,className:"w-full flex items-center justify-center space-x-2 text-red-600 font-medium py-2 px-4 rounded-lg border border-red-200 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors mt-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ma,{className:"h-5 w-5"}),e.jsx("span",{children:S("settings.clearAsrCacheButton")})]})})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsxs("div",{className:`space-y-4 transition-opacity ${W?"":"opacity-50"}`,children:[e.jsx("label",{className:`block text-sm font-medium -mb-2 ${W?"text-gray-700":"text-gray-400"}`,children:S("settings.audioProcessingLabel")}),e.jsx(te,{id:"noise-cancellation-toggle",isEnabled:xt,setIsEnabled:Ge,title:S("settings.enableNoiseCancellationLabel"),description:S("settings.enableNoiseCancellationDescription"),disabled:!W}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"gain-slider",className:`flex justify-between items-center text-sm font-medium mb-1 ${W?"text-gray-700":"text-gray-400"}`,children:[e.jsx("span",{children:S("settings.audioGainLabel")}),e.jsxs("span",{className:"font-normal text-gray-500",children:[st.toFixed(1),"x"]})]}),e.jsx("input",{type:"range",id:"gain-slider",min:.5,max:5,step:.1,value:st,onChange:f=>Je(parseFloat(f.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:!W})]})]}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx(te,{id:"support-audio-toggle",isEnabled:it,setIsEnabled:f=>{ye(f),f&&We(!1)},title:S("settings.enableGemmaAudioLabel"),description:S("settings.enableGemmaAudioDescription"),disabled:!$e}),!$e&&e.jsx("p",{className:"text-xs text-amber-600 mt-1 ml-1",children:'* Requires "Enable Offline Translation" to be ON.'})]}),me==="tts"&&e.jsxs("div",{role:"tabpanel",id:"tts-settings","aria-labelledby":"tts-tab",className:"space-y-6",children:[e.jsx(te,{id:"tts-toggle",isEnabled:yt,setIsEnabled:ge,title:S("settings.enableCustomTtsLabel"),description:S("settings.enableCustomTtsDescription")}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"voice-select",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.voiceLabel")}),e.jsx("select",{id:"voice-select",value:Pe,onChange:f=>we(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100",disabled:nt.length===0,children:nt.length>0?nt.map(f=>e.jsxs("option",{value:f.voiceURI,children:[f.name," (",f.lang,")"]},f.voiceURI)):e.jsx("option",{value:"",children:S("settings.voicePlaceholder",{languageName:S(L.name)})})})]}),e.jsx(Fe,{id:"rate-slider",label:S("settings.rateLabel"),value:vt,onChange:f=>Q(parseFloat(f.target.value)),min:.5,max:2,step:.1}),e.jsx(Fe,{id:"pitch-slider",label:S("settings.pitchLabel"),value:St,onChange:f=>G(parseFloat(f.target.value)),min:0,max:2,step:.1})]}),me==="offline-params"&&e.jsxs("div",{role:"tabpanel",id:"offline-params-settings","aria-labelledby":"offline-params-tab",className:"space-y-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:S("settings.offlineParamsDescription")}),e.jsx(Fe,{id:"max-tokens-slider",label:S("settings.maxTokensLabel"),value:jt,onChange:f=>xe(parseInt(f.target.value,10)),min:256,max:8192,step:256}),e.jsx(Fe,{id:"top-k-slider",label:S("settings.topKLabel"),value:De,onChange:f=>ot(parseInt(f.target.value,10)),min:1,max:100,step:1}),e.jsx(Fe,{id:"temperature-slider",label:S("settings.temperatureLabel"),value:qe,onChange:f=>Ct(parseFloat(f.target.value)),min:0,max:1,step:.05}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"random-seed",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.randomSeedLabel")}),e.jsx("input",{type:"number",id:"random-seed",value:rt,onChange:f=>kt(parseInt(f.target.value,10)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx(te,{id:"max-num-images-toggle",isEnabled:Ot===1,setIsEnabled:f=>Ce(f?1:0),title:S("settings.maxNumImagesLabel"),description:S("settings.maxNumImagesDescription")})]}),me==="ocr"&&e.jsxs("div",{role:"tabpanel",id:"ocr-settings","aria-labelledby":"ocr-tab",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ocr-model-select",className:"block text-sm font-medium text-gray-700 mb-1",children:S("settings.ocrModelLabel")}),e.jsx("select",{id:"ocr-model-select",value:Ve,onChange:f=>lt(f.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:Object.entries(fa).map(([f,I])=>e.jsx("option",{value:f,children:I.description},f))})]}),e.jsx("button",{onClick:oa,disabled:Ne==="initializing",className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg text-sm font-medium transition disabled:bg-indigo-300 disabled:cursor-wait",children:S(Ne==="initializing"?"common.status.initializing":Ne==="ready"?"settings.switchOcr":"settings.initializeOcr")}),Ne==="ready"&&e.jsx("p",{className:"text-sm text-center text-green-600",children:"OCR Engine Ready."}),Ne==="error"&&e.jsxs("p",{className:"text-sm text-center text-red-600",children:["OCR Engine failed to initialize: ",ba]})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 rounded-b-lg flex justify-between items-center",children:[e.jsx("button",{onClick:Kt,className:"text-red-600 font-medium py-2 px-4 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors","aria-label":S("history.clearAriaLabel"),children:S("settings.clearSettingsButton")}),e.jsx("button",{onClick:It,className:"bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:S("settings.saveSettingsButton")})]})]})})},Ts=({isOpen:t,onClose:a,history:o,onSelectHistory:n,onClearHistory:r})=>{const{t:l}=Ze();return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"history-title",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md h-[70vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{id:"history-title",className:"text-xl font-semibold text-gray-800",children:l("history.title")}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600","aria-label":l("history.closeAriaLabel"),children:e.jsx(Ht,{})})]}),e.jsx("div",{className:"p-2 flex-grow overflow-y-auto",children:o.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:l("history.empty")}):e.jsx("ul",{children:o.map(d=>e.jsx("li",{className:"border-b border-gray-200 last:border-b-0",children:e.jsxs("button",{onClick:()=>n(d),className:"w-full text-left p-4 hover:bg-gray-50 transition-colors","aria-label":l("history.selectAriaLabel",{sourceLang:l(d.sourceLang.name),targetLang:l(d.targetLang.name)}),children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 bg-gray-100 py-1 px-2 rounded-full",children:l(d.sourceLang.name)}),e.jsx("p",{className:"text-gray-800 mt-1 truncate",children:d.inputText})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-semibold text-blue-500 bg-blue-50 py-1 px-2 rounded-full",children:l(d.targetLang.name)}),e.jsx("p",{className:"text-blue-700 font-medium mt-1 truncate",children:d.translatedText})]})]})},d.id))})}),o.length>0&&e.jsx("div",{className:"p-4 bg-gray-50 rounded-b-lg flex justify-end items-center",children:e.jsxs("button",{onClick:r,className:"flex items-center space-x-2 text-red-600 font-medium py-2 px-4 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors","aria-label":l("history.clearAriaLabel"),children:[e.jsx(ma,{className:"h-5 w-5"}),e.jsx("span",{children:l("history.clearButton")})]})})]})}):null},Ps=t=>new Promise((a,o)=>{const n=new FileReader;n.onloadend=()=>{const l=n.result.split(",")[1];a(l)},n.onerror=o,n.readAsDataURL(t)}),ka=async(t,a,o,n,r,l,d)=>{if(!n)throw new Error("Gemini API Key is not set. Please add it in the settings.");if(!r)throw new Error("Model Name is not configured. Please add it in the settings.");try{const u=new ga({apiKey:n}),x=`${a==="Auto Detect"?"First, auto-detect the source language of the following text.":`The source language is ${a}.`} Then, translate the text to ${o}.
Do not add any extra explanations, comments, or annotations. Return only the translated text.`,w=await u.models.generateContentStream({model:r,contents:t,config:{systemInstruction:x,thinkingConfig:{thinkingBudget:0}}});let m="";for await(const p of w){if(d.aborted)throw new DOMException("Translation cancelled by user.","AbortError");const y=p.text;y&&(m+=y,l(y))}return m.trim()}catch(u){throw console.error("Error translating text:",u),u instanceof DOMException&&u.name==="AbortError"?u:new Error("Gemini API request failed.")}},Ds=async(t,a,o,n)=>{var w;if(!o)throw new Error("Gemini API Key is not set. Please add it in the settings.");const r=new ga({apiKey:o}),l=t.match(/^data:(image\/\w+);base64,(.*)$/);if(!l)throw new Error("Invalid image data URL format.");const d=l[1],u=l[2],i={inlineData:{mimeType:d,data:u}},x={text:`1. First, accurately extract all text from the provided image.
2. Then, translate the extracted text into ${a}.
3. Finally, return a single JSON object with two keys: "sourceText" containing the exact extracted text, and "translatedText" containing the translation. Do not include any other explanations or markdown formatting.`};try{const p=((w=(await r.models.generateContent({model:n,contents:{parts:[x,i]},config:{responseMimeType:"application/json",responseSchema:{type:ca.OBJECT,properties:{sourceText:{type:ca.STRING,description:"The text extracted from the image."},translatedText:{type:ca.STRING,description:"The translated text."}},required:["sourceText","translatedText"]}}})).text)==null?void 0:w.trim())||"{}",y=JSON.parse(p);if(typeof y.sourceText=="string"&&typeof y.translatedText=="string")return y;throw new Error("Invalid JSON structure in API response.")}catch(m){throw console.error("Error translating image:",m),m instanceof SyntaxError?new Error("Failed to parse the response from the Gemini API. The response was not valid JSON."):new Error("Gemini API request for image translation failed.")}},Oa=async(t,a,o,n,r)=>{var w;if(!o)throw new Error("Gemini API Key is not set. Please add it in the settings.");const l=new ga({apiKey:o}),d=await Ps(t);let u=t.type;u.includes(";")&&(u=u.split(";")[0]),u||(u="audio/wav");const i={inlineData:{mimeType:u,data:d}},x=`Transcribe the following audio. The language is ${a}. Return only the transcribed text.`;try{const m=await l.models.generateContent({model:n,contents:{parts:[i,{text:x}]}});if(r!=null&&r.aborted)throw new DOMException("Transcription cancelled by user.","AbortError");return((w=m.text)==null?void 0:w.trim())||""}catch(m){throw console.error("Error transcribing audio:",m),m instanceof DOMException&&m.name==="AbortError"?m:new Error("Gemini API transcription request failed.")}},Ia=async(t,a,o,n,r,l,d,u)=>{var w,m,p,y;if(!n)throw new Error("OpenAI API Key is not set.");if(!r)throw new Error("Model Name is not configured.");if(!l)throw new Error("OpenAI API URL is not set.");const x=`${a==="Auto Detect"?"First, auto-detect the source language of the following text.":`The source language is ${a}.`} Then, translate the text to ${o}. Do not add any extra explanations, comments, or annotations. Return only the translated text.`;try{const v=await fetch(`${l}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:r,messages:[{role:"system",content:x},{role:"user",content:t}],temperature:1,stream:!0}),signal:u});if(!v.ok){if(u.aborted)throw new DOMException("Request aborted by user","AbortError");const L=await v.json();throw new Error(((w=L.error)==null?void 0:w.message)||`OpenAI API request failed with status ${v.status}`)}if(!v.body)throw new Error("Response body is null, cannot stream.");const C=v.body.getReader(),O=new TextDecoder;let T="";for(;;){const{done:L,value:R}=await C.read();if(L)break;const ee=O.decode(R,{stream:!0}).split(`
`).filter(Y=>Y.trim().startsWith("data:"));for(const Y of ee){const K=Y.replace(/^data: /,"").trim();if(K==="[DONE]")break;try{const B=(y=(p=(m=JSON.parse(K).choices)==null?void 0:m[0])==null?void 0:p.delta)==null?void 0:y.content;B&&(T+=B,d(B))}catch{}}}return T.trim()}catch(v){throw console.error("Error translating text with OpenAI:",v),v instanceof Error&&v.name==="AbortError"?v:new Error("OpenAI API request failed.")}},Fs=async(t,a,o,n,r)=>{var d,u,i;if(!o)throw new Error("OpenAI API Key is not set.");if(!r)throw new Error("OpenAI API URL is not set.");if(!t.startsWith("data:image/")||!t.includes(";base64,"))throw new Error("Invalid image data URL format. It must be a base64 encoded image data URL.");const l=`1. First, accurately extract all text from the provided image.
2. Then, translate the extracted text into ${a}.
3. Finally, return a single JSON object with two keys: "sourceText" containing the exact extracted text, and "translatedText" containing the translation. Do not include any other explanations, markdown formatting, or code fences.`;try{const x=await fetch(`${r}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:n,messages:[{role:"user",content:[{type:"text",text:l},{type:"image_url",image_url:{url:t}}]}],max_tokens:2048,response_format:{type:"json_object"},stream:!1})});if(!x.ok){const y=await x.json();throw new Error(((d=y.error)==null?void 0:d.message)||`OpenAI API image request failed with status ${x.status}`)}const m=(i=(u=(await x.json()).choices[0])==null?void 0:u.message)==null?void 0:i.content;if(!m)throw new Error("No content in OpenAI API response.");const p=JSON.parse(m);if(typeof p.sourceText=="string"&&typeof p.translatedText=="string")return p;throw new Error("Invalid JSON structure in API response.")}catch(x){throw console.error("Error translating image with OpenAI:",x),x instanceof SyntaxError?new Error("Failed to parse the response from the OpenAI API. The response was not valid JSON."):x instanceof Error?x:new Error("OpenAI API request for image translation failed.")}},Aa=async(t,a,o,n,r)=>{var u;if(!o)throw new Error("OpenAI API Key is not set.");if(!n)throw new Error("OpenAI API URL is not set.");const l=new FormData,d=t.type.includes("wav")?"wav":"webm";l.append("file",t,`recording.${d}`),l.append("model","whisper-1"),a&&a!=="auto"&&l.append("language",a);try{const i=await fetch(`${n}/v1/audio/transcriptions`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:l,signal:r});if(!i.ok){if(r!=null&&r.aborted)throw new DOMException("Request aborted by user","AbortError");const w=await i.json();throw new Error(((u=w.error)==null?void 0:u.message)||`OpenAI API audio request failed with status ${i.status}`)}return(await i.json()).text||""}catch(i){throw console.error("Error transcribing audio with OpenAI:",i),i instanceof Error&&i.name==="AbortError"?i:new Error("OpenAI API request for audio transcription failed.")}},zs="offline-model-db",ve="model-chunks",V="model-meta",Ut="consolidated-models",_s=3;class Bs{constructor(){Wt(this,"dbPromise");Wt(this,"controllers",new Map);Wt(this,"isOpfsSupported");Wt(this,"opfsRootPromise");this.dbPromise=os(zs,_s,{upgrade(a){a.objectStoreNames.contains(ve)||a.createObjectStore(ve,{keyPath:["modelName","chunkIndex"]}).createIndex("modelName","modelName",{unique:!1}),a.objectStoreNames.contains(V)||a.createObjectStore(V,{keyPath:"modelName"}),a.objectStoreNames.contains(Ut)||a.createObjectStore(Ut,{keyPath:"modelName"})}}),this.isOpfsSupported="getDirectory"in navigator.storage,this.opfsRootPromise=this.isOpfsSupported?navigator.storage.getDirectory().catch(a=>(console.error("Failed to get OPFS root directory:",a),null)):Promise.resolve(null),this.isOpfsSupported?console.log("Origin Private File System is supported and will be used for model storage."):console.log("Origin Private File System not supported, falling back to IndexedDB.")}async getOpfsRoot(){return this.opfsRootPromise}async startDownload(a,o,n,r){if(this.controllers.has(a)){console.warn(`Download for ${a} is already in progress.`);return}this.isOpfsSupported?await this.runOpfsDownload(a,o,n,r,!1):await this.runIdbDownload(a,o,n,r,!1)}async resumeDownload(a,o,n,r){this.controllers.has(a)||(this.isOpfsSupported?await this.runOpfsDownload(a,o,n,r,!0):await this.runIdbDownload(a,o,n,r,!0))}async runOpfsDownload(a,o,n,r,l){const d=new AbortController;this.controllers.set(a,d);let u=0,i=0;try{const x=await this.getOpfsRoot();if(!x)throw new Error("Could not access OPFS.");const w=await x.getFileHandle(a,{create:!0}),m=await this.getDb(),p=await m.get(V,a);if(l&&p&&p.total>0&&(i=p.total,u=(await w.getFile()).size,u>=i&&(console.warn(`Resuming download for ${a}, but existing file is complete or corrupt. Restarting.`),u=0)),i===0){const v=await fetch(o,{method:"HEAD",signal:d.signal});if(!v.ok)throw new Error(`Failed to get model info. Status: ${v.status}`);if(i=Number(v.headers.get("Content-Length")),isNaN(i)||i===0)throw new Error("Could not determine file size.");u=0}if(await m.put(V,{modelName:a,total:i,status:"downloading"}),r({downloaded:u,total:i,percent:i>0?u/i*100:0,status:"downloading"}),u<i){const v=await fetch(o,{headers:{Range:`bytes=${u}-`},signal:d.signal});if(!v.ok||!v.body)throw new Error(`Download request failed. Status: ${v.status}`);const C=await w.createWritable({keepExistingData:!0});await C.seek(u);const O=v.body.getReader();for(;;){const{done:T,value:L}=await O.read();if(T)break;await C.write(L),u+=L.length,r({downloaded:u,total:i,percent:u/i*100,status:"downloading"})}await C.close()}const y=await w.getFile();if(y.size!==i)throw new Error(`Final file size ${y.size} does not match expected size ${i}`);await m.put(V,{modelName:a,total:i,status:"completed"}),r({downloaded:i,total:i,percent:100,status:"completed"}),console.log(`Model ${a} downloaded to OPFS successfully.`)}catch(x){this.handleDownloadError(x,a,u,i,r)}finally{this.controllers.delete(a)}}async runIdbDownload(a,o,n,r,l){const d=new AbortController;this.controllers.set(a,d);let u=0,i=0,x=0;const w=5*1024*1024;try{const m=await this.getDb();if(l){const p=await m.get(V,a);if(!p||!p.total)return this.runIdbDownload(a,o,n,r,!1);i=p.total;const y=await m.getAllFromIndex(ve,"modelName",a);u=y.reduce((v,C)=>v+C.data.byteLength,0),x=y.length}else{await this.deleteModel(a);const p=await fetch(o,{method:"HEAD",signal:d.signal});if(!p.ok)throw new Error(`Failed to get model info. Status: ${p.status}`);if(i=Number(p.headers.get("Content-Length")),isNaN(i)||i===0)throw new Error("Could not determine file size.")}for(await m.put(V,{modelName:a,total:i,status:"downloading"});u<i;){const p=u,y=Math.min(u+w-1,i-1),v=await fetch(o,{headers:{Range:`bytes=${p}-${y}`},signal:d.signal});if(!v.ok)throw new Error(`Chunk download failed. Status: ${v.status}`);const C=await v.arrayBuffer();await m.put(ve,{modelName:a,chunkIndex:x,data:C}),u+=C.byteLength,x++,r({downloaded:u,total:i,percent:u/i*100,status:"downloading"})}await this._consolidateModel(a,r)}catch(m){this.handleDownloadError(m,a,u,i,r)}finally{this.controllers.delete(a)}}handleDownloadError(a,o,n,r,l){if(a instanceof DOMException&&a.name==="AbortError")console.log(`Download for ${o} was paused.`),this.getDb().then(d=>d.put(V,{modelName:o,total:r,status:"paused",downloaded:n})),l({downloaded:n,total:r,percent:r>0?n/r*100:0,status:"paused"});else{const d=a instanceof Error?a.message:"Unknown download error";console.error(`Download error for ${o}:`,a),this.getDb().then(u=>u.put(V,{modelName:o,status:"error",error:d,total:r})),l({downloaded:n,total:r,percent:r>0?n/r*100:0,status:"error",error:d})}}async _consolidateModel(a,o){const n=await this.getDb(),r=await n.get(V,a);if(!r)return;const l=r.total||0,d=r.downloaded||l;try{o({downloaded:d,total:l,percent:100,status:"consolidating"});const u=await this.getModelFromChunksAsStream(a);if(!u)throw new Error("Failed to reconstruct model from chunks.");await n.put(Ut,{modelName:a,blob:u}),await this._deleteChunks(a),await n.put(V,{modelName:a,total:l,status:"completed",downloaded:l}),o({downloaded:l,total:l,percent:100,status:"completed"}),console.log(`Model ${a} consolidated successfully.`)}catch(u){const i=u instanceof Error?u.message:"Unknown consolidation error";console.error(`Consolidation error for ${a}:`,u),await n.put(V,{modelName:a,status:"error",error:i,total:l}),o({downloaded:d,total:l,percent:d/l*100,status:"error",error:`Consolidation failed: ${i}`})}}async _deleteChunks(a){const n=(await this.getDb()).transaction(ve,"readwrite");let l=await n.objectStore(ve).index("modelName").openCursor(IDBKeyRange.only(a));for(;l;)l.delete(),l=await l.continue();await n.done}pauseDownload(a){const o=this.controllers.get(a);o&&(o.abort(),this.controllers.delete(a))}async deleteModel(a){if(this.pauseDownload(a),this.isOpfsSupported)try{const n=await this.getOpfsRoot();n&&await n.removeEntry(a)}catch(n){n instanceof DOMException&&n.name==="NotFoundError"||console.error(`Error deleting ${a} from OPFS:`,n)}const o=await this.getDb();await o.delete(V,a),await o.delete(Ut,a),await this._deleteChunks(a)}async getStatus(a){const o=await this.getDb(),n=await o.get(V,a);if(!n)return{downloaded:0,total:0,percent:0,status:"not_started"};const r=n.total||0;if(n.status==="completed")return{downloaded:r,total:r,percent:100,status:"completed"};let l=0;if(this.isOpfsSupported)try{const d=await this.getOpfsRoot();d&&(l=(await(await d.getFileHandle(a)).getFile()).size)}catch{}else l=(await o.getAllFromIndex(ve,"modelName",a)).reduce((u,i)=>u+i.data.byteLength,0);return{downloaded:l,total:r,percent:r>0?l/r*100:0,status:n.status,error:n.error}}async getModelAsBlob(a){const o=await this.getDb(),n=await o.get(V,a);if(!n||n.status!=="completed")return null;if(this.isOpfsSupported)try{const l=await this.getOpfsRoot();if(l){const u=await(await l.getFileHandle(a)).getFile();return u.size===n.total?u:(console.error(`OPFS file for ${a} is incomplete. Expected ${n.total}, found ${u.size}.`),null)}}catch(l){console.warn(`Could not get model ${a} from OPFS, will check IndexedDB.`,l)}const r=await o.get(Ut,a);return r&&r.blob?r.blob:(console.warn(`Consolidated model for ${a} not found in store. Reconstructing from chunks as a fallback.`),this.getModelFromChunksAsStream(a))}async getModelFromChunksAsStream(a){const o=await this.getDb();if(!await o.getFromIndex(ve,"modelName",a))return null;const r=new ReadableStream({async start(l){let i=await o.transaction(ve,"readonly").objectStore(ve).index("modelName").openCursor(IDBKeyRange.only(a));for(;i;)l.enqueue(new Uint8Array(i.value.data)),i=await i.continue();l.close()}});try{return await new Response(r).blob()}catch{return null}}getDb(){return this.dbPromise}}const gt=new Bs,pa="transformers-cache";ha.backends.onnx.executionProviders=["webgpu","wasm"];ha.useBrowserCache=!0;ha.cacheDir=pa;const La=async t=>{if(!("caches"in window))return!1;try{const a=await caches.open(pa),o=`https://huggingface.co/${t}/resolve/main/config.json`;return!!await a.match(o)}catch(a){return console.error(`Error checking ASR cache status for ${t}:`,a),!1}},$s=async()=>{if("caches"in window)try{await caches.delete(pa),console.log("ASR model cache cleared successfully.")}catch(t){throw console.error("Error clearing ASR model cache:",t),t}},Qt=async(t,a={})=>{const{noiseSuppression:o=!1,gain:n=1}=a,r=window.AudioContext||window.webkitAudioContext,l=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!r)throw new Error("Your browser does not support the Web Audio API, which is required for transcription.");const d=await t.arrayBuffer(),u=new r,i=await u.decodeAudioData(d);let x;if(i.numberOfChannels>1){x=new Float32Array(i.length);for(let O=0;O<i.length;O++){let T=0;for(let L=0;L<i.numberOfChannels;L++)T+=i.getChannelData(L)[O];x[O]=T/i.numberOfChannels}}else x=i.getChannelData(0);const w=16e3,m=u.createBuffer(1,x.length,i.sampleRate);m.copyToChannel(x,0);const p=new l(1,Math.ceil(m.duration*w),w),y=p.createBufferSource();y.buffer=m;let v=y;if(o){const O=p.createBiquadFilter();O.type="highpass",O.frequency.value=100,v.connect(O),v=O}if(n&&n!==1){const O=p.createGain();O.gain.value=n,v.connect(O),v=O}v.connect(p.destination),y.start();const C=await p.startRendering();return await u.close(),C.getChannelData(0)},Na=window.SpeechRecognition||window.webkitSpeechRecognition,Ws=({onResult:t,onError:a,onStart:o,onEnd:n})=>{const[r,l]=s.useState(!1),d=s.useRef(null),u=s.useRef(!1);s.useEffect(()=>{if(!Na){console.warn("Web Speech API is not supported by this browser.");return}const w=new Na;return w.continuous=!0,w.interimResults=!0,w.onstart=()=>{l(!0),o()},w.onend=()=>{if(u.current)try{w.start()}catch{l(!1),n()}else l(!1),n()},w.onerror=m=>{u.current=!1,m.error!=="no-speech"&&m.error!=="aborted"&&a(m.error)},w.onresult=m=>{let p="",y="";for(let v=m.resultIndex;v<m.results.length;++v)m.results[v].isFinal?y+=m.results[v][0].transcript:p+=m.results[v][0].transcript;y?t(y,!0):p&&t(p,!1)},d.current=w,()=>{u.current=!1,w.stop()}},[t,a,o,n]);const i=s.useCallback(w=>{if(d.current&&!r)try{d.current.lang=w,u.current=!0,d.current.start()}catch(m){console.error("Could not start speech recognition:",m),a("Failed to start recognition.")}},[r,a]),x=s.useCallback(()=>{d.current&&r&&(u.current=!1,d.current.stop())},[r]);return s.useMemo(()=>({isListening:r,startRecognition:i,stopRecognition:x}),[r,i,x])},Us="PaddleOCR-ModelCache",ht="models",Hs=1;let ea;const Ta=()=>new Promise((t,a)=>{if(ea)return t(ea);const o=indexedDB.open(Us,Hs);o.onerror=()=>{a("Error opening IndexedDB.")},o.onsuccess=()=>{ea=o.result,t(ea)},o.onupgradeneeded=()=>{const n=o.result;n.objectStoreNames.contains(ht)||n.createObjectStore(ht)}}),da=t=>new Promise(async(a,o)=>{try{const d=(await Ta()).transaction(ht,"readonly").objectStore(ht).get(t);d.onsuccess=()=>{a(d.result)},d.onerror=()=>{o("Error getting data from IndexedDB.")}}catch(n){o(n)}}),ua=(t,a)=>new Promise(async(o,n)=>{try{const u=(await Ta()).transaction(ht,"readwrite").objectStore(ht).put(a,t);u.onsuccess=()=>{o()},u.onerror=()=>{n("Error setting data in IndexedDB.")}}catch(r){n(r)}}),Gs=()=>{const[t,a]=s.useState(null),[o,n]=s.useState("uninitialized"),[r,l]=s.useState(null),d=s.useCallback(async i=>{n("initializing"),l(null);try{const x=rs||is,w="det-model",m=`rec-model-${i.key}`,p=`dict-${i.key}`;let y=await da(w),v=await da(m),C=await da(p);const O=[];if(y||O.push(fetch(i.detPath).then(L=>L.arrayBuffer()).then(async L=>{y=L,await ua(w,L)})),v||O.push(fetch(i.recPath).then(L=>L.arrayBuffer()).then(async L=>{v=L,await ua(m,L)})),C||O.push(fetch(i.dictPath).then(L=>L.arrayBuffer()).then(async L=>{C=new TextDecoder("utf-8").decode(L),await ua(p,C)})),O.length>0&&await Promise.all(O),!y||!v||!C)throw new Error("Failed to load required assets.");const T=await ls({det:{input:new Uint8Array(y)},rec:{input:new Uint8Array(v),decodeDic:C,optimize:{space:!1}},ort:x});a(T),n("ready")}catch(x){l(`Initialization failed: ${x.message||"Check models"}`),n("error"),console.error("OCR Engine initialization error:",x)}},[]),u=s.useCallback(async i=>{if(o!=="ready"||!t)return null;try{const x=performance.now(),w=await t.ocr(i),m=performance.now();return{result:w,time:m-x}}catch(x){throw console.error("Recognition error:",x),new Error(x.message||"OCR processing failed.")}},[t,o]);return{status:o,error:r,recognize:u,initializeOcr:d}},Ra=t=>{let a;if(t.numberOfChannels>1){a=new Float32Array(t.length);for(let w=0;w<t.length;w++){let m=0;for(let p=0;p<t.numberOfChannels;p++)m+=t.getChannelData(p)[w];a[w]=m/t.numberOfChannels}}else a=t.getChannelData(0);const o=1,n=a.length*o*2+44,r=new ArrayBuffer(n),l=new DataView(r);let d=0;const u=w=>{l.setUint16(d,w,!0),d+=2},i=w=>{l.setUint32(d,w,!0),d+=4},x=w=>{for(let m=0;m<w.length;m++)l.setUint8(d+m,w.charCodeAt(m));d+=w.length};x("RIFF"),i(n-8),x("WAVE"),x("fmt "),i(16),u(1),u(o),i(t.sampleRate),i(t.sampleRate*2*o),u(o*2),u(16),x("data"),i(a.length*2);for(let w=0;w<a.length;w++){let m=Math.max(-1,Math.min(1,a[w]));l.setInt16(d,m<0?m*32768:m*32767,!0),d+=2}return new Blob([l],{type:"audio/wav"})},Js=t=>{const a=t.box.map(u=>u[0]),o=t.box.map(u=>u[1]),n=Math.min(...a),r=Math.max(...a),l=Math.min(...o),d=Math.max(...o);return{...t,minX:n,maxX:r,minY:l,maxY:d,centerX:(n+r)/2,centerY:(l+d)/2,height:d-l}},ta=t=>{const a=[];return t.sort((o,n)=>o.centerY-n.centerY),t.forEach(o=>{const n=a.find(r=>{const l=r.reduce((u,i)=>u+i.centerY,0)/r.length,d=r.reduce((u,i)=>u+i.height,0)/r.length;return Math.abs(o.centerY-l)<d*.6});n?n.push(o):a.push([o])}),a.sort((o,n)=>{const r=l=>Math.min(...l.map(d=>d.minY));return r(o)-r(n)}),a.map(o=>(o.sort((n,r)=>n.minX-r.minX),o.map(n=>n.text).join(" "))).join(`
`)},Ks=t=>{if(!t||t.length===0)return"";const a=t.map(Js);if(a.length<2)return ta(a);const o=Math.min(...a.map(p=>p.minX)),r=Math.max(...a.map(p=>p.maxX))-o,l=new Int32Array(Math.ceil(r)+1);a.forEach(p=>{const y=Math.floor(p.minX-o),v=Math.ceil(p.maxX-o);for(let C=y;C<v;C++)C>=0&&C<l.length&&l[C]++});const d=Math.floor(r*.25),u=Math.floor(r*.75);let i=0,x=-1,w=-1;for(let p=d;p<=u;p++)if(l[p]===0)w===-1&&(w=p);else if(w!==-1){const y=p-w;y>i&&(i=y,x=w+y/2),w=-1}if(x!==-1&&i>10){const p=o+x,y=a.filter(T=>T.centerX<p),v=a.filter(T=>T.centerX>=p),C=ta(y),O=ta(v);return`${C}

${O}`}return ta(a)},qs=t=>{var o;const a=t.src;return!a||a.length===0?((o=t.parragraphs)==null?void 0:o.map(n=>n.text).join(`
`))||"":Ks(a)},Vs=()=>{var Sa;const{t,i18n:a}=Ze(),[o,n]=s.useState(""),[r,l]=s.useState(""),[d,u]=s.useState(aa[0]),[i,x]=s.useState(aa[6]),[w,m]=s.useState(!1),[p,y]=s.useState(!1),[v,C]=s.useState(!1),[O,T]=s.useState(!1),[L,R]=s.useState(!1),[X,ee]=s.useState(!1),[Y,K]=s.useState(!1),[de,B]=s.useState([]),[E,oe]=s.useState(""),[$,Ie]=s.useState("gemini-2.5-flash"),[A,P]=s.useState("gemini"),[N,Z]=s.useState(""),[ue,Ae]=s.useState(""),[J,Gt]=s.useState(""),[Le,Ne]=s.useState(!1),[ba,na]=s.useState([]),[Re,S]=s.useState([]),[fe,me]=s.useState(navigator.onLine),[pt,Se]=s.useState(!1),[_e,je]=s.useState(null),[be,Me]=s.useState(!1),[Ee,bt]=s.useState(""),[Be,Jt]=s.useState(1),[Qe,et]=s.useState(1),[_,$e]=s.useState(!1),[tt,wt]=s.useState({}),[re,W]=s.useState(!1),[We,Te]=s.useState(!1),[Ue,at]=s.useState(4096),[He,xt]=s.useState(40),[Ge,st]=s.useState(.3),[Je,yt]=s.useState(101),[ge,Pe]=s.useState(!1),[we,vt]=s.useState(0),[Q,St]=s.useState(!0),[G,nt]=s.useState(!1),[Ke,jt]=s.useState(Ye[0].id),[xe,De]=s.useState(!1),[ot,qe]=s.useState(!1),[Ct,rt]=s.useState({}),[kt,it]=s.useState({file:"",progress:0}),[ye,Ot]=s.useState(!1),[Ce,Ve]=s.useState(1),[lt,It]=s.useState(null),[Kt,ct]=s.useState(!1),{status:dt,error:oa,recognize:ke,initializeOcr:qt}=Gs(),[ra,Fe]=s.useState("ch_v5"),[te,f]=s.useState(null),I=s.useRef(null),z=s.useRef(null),ae=s.useRef(g=>{}),D=s.useRef(null),j=s.useCallback((g,h="error")=>{I.current&&clearTimeout(I.current),f({message:g,type:h}),I.current=window.setTimeout(()=>{f(null)},5e3)},[]);s.useRef(null),s.useRef(null),s.useRef(""),s.useRef(null);const se=s.useRef(null),At=s.useRef([]),he=s.useRef(null),ne=s.useRef(null),ie=s.useRef(null),Vt=s.useRef(null),q=s.useRef(!1),le=s.useCallback(()=>{if(z.current)return z.current;console.log("Creating offline worker...");const g=new Worker(new URL("/Gemini-AI-Translator/assets/offline.worker-DatAPfgz.js",import.meta.url),{type:"module"});z.current=g;const h=c=>ae.current(c);return g.addEventListener("message",h),g.onerror=c=>{console.error("Worker error:",c),j(`A critical worker error occurred: ${c.message}`,"error"),W(!1),m(!1)},g},[j]);s.useEffect(()=>()=>{z.current&&(z.current.terminate(),z.current=null,console.log("Offline worker terminated on component unmount."))},[]);const ia=_&&!!J&&((Sa=tt[J])==null?void 0:Sa.status)==="completed",ce=ia&&We,Xt=s.useCallback(async g=>{if(!g.trim()){l("");return}ne.current&&ne.current.abort();const h=new AbortController;ne.current=h,m(!0),l("");try{const c=a.t(d.name,{lng:"en"}),b=a.t(i.name,{lng:"en"});if(_){if(!J)throw new Error("Please select an offline model in settings.");if(re)throw new Error("Offline model is still initializing.");if(!ce)throw new Error("Selected offline model is not ready.");le().postMessage({type:"translate",payload:{text:g,sourceLang:c,targetLang:b,sourceLangCode:d.code,targetLangCode:i.code,isTwoStepEnabled:Le}})}else{if(!fe)throw new Error("You are offline. Enable offline mode or connect to the internet.");let k="";const M=U=>{k+=U,l(H=>H.length===0?U.trimStart():H+U)};if(A==="openai"){if(!E)throw new Error("OpenAI API Key is not set. Please add it in the settings.");if(!N)throw new Error("OpenAI API URL is not set. Please add it in the settings.");k=await Ia(g,c,b,E,$,N,M,h.signal)}else{if(!E)throw new Error("Gemini API Key is not set. Please add it in the settings.");k=await ka(g,c,b,E,$,M,h.signal)}const F={id:Date.now(),inputText:g,translatedText:k,sourceLang:d,targetLang:i};B(U=>{const H=[F,...U].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(H)),H}),m(!1)}}catch(c){if(c instanceof DOMException&&c.name==="AbortError"){console.log("Translation cancelled by user."),m(!1);return}const b=c instanceof Error?c.message:"An unknown error occurred.";j(t("notifications.translationFailed",{errorMessage:b}),"error"),c instanceof Error&&(c.message.includes("select an offline model")||c.message.includes("API Key is not set")||c.message.includes("API URL is not set"))&&ee(!0),console.error(c),m(!1)}finally{!_&&ne.current===h&&(ne.current=null)}},[d,i,E,$,fe,_,J,ce,re,j,A,N,Le,t,a,le]),Oe=s.useCallback(async g=>{if(!g.trim()){l("");return}ne.current&&ne.current.abort();const h=new AbortController;ne.current=h,m(!0),l("");try{const c=a.t(i.name,{lng:"en"}),b=a.t(d.name,{lng:"en"});if(_){if(!J)throw new Error("Please select an offline model in settings.");if(re)throw new Error("Offline model is still initializing.");if(!ce)throw new Error("Selected offline model is not ready.");le().postMessage({type:"translate",payload:{text:g,sourceLang:c,targetLang:b,sourceLangCode:i.code,targetLangCode:d.code,isTwoStepEnabled:Le}})}else{if(!fe)throw new Error("You are offline. Enable offline mode or connect to the internet.");let k="";const M=U=>{k+=U,l(H=>H.length===0?U.trimStart():H+U)};if(A==="openai"){if(!E)throw new Error("OpenAI API Key is not set.");if(!N)throw new Error("OpenAI API URL is not set.");k=await Ia(g,c,b,E,$,N,M,h.signal)}else{if(!E)throw new Error("Gemini API Key is not set.");k=await ka(g,c,b,E,$,M,h.signal)}const F={id:Date.now(),inputText:g,translatedText:k,sourceLang:i,targetLang:d};B(U=>{const H=[F,...U].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(H)),H}),m(!1)}}catch(c){if(c instanceof DOMException&&c.name==="AbortError"){console.log("Reverse translation cancelled."),m(!1);return}const b=c instanceof Error?c.message:"An unknown error occurred.";j(t("notifications.translationFailed",{errorMessage:b}),"error"),console.error(c),m(!1)}finally{!_&&ne.current===h&&(ne.current=null)}},[i,d,E,$,fe,_,J,ce,re,j,A,N,Le,t,a,le]);s.useEffect(()=>{ae.current=g=>{var b;const{type:h,payload:c}=g.data;switch(h){case"init_done":Te(!0),j(t("notifications.offlineModelInitSuccess",{modelIdentifier:c.modelIdentifier}),"success"),W(!1);break;case"init_error":Te(!1),j(c.error||t("notifications.offlineModelInitFailed"),"error"),console.error("Offline model init failed via worker:",c.error),W(!1);break;case"unload_done":Te(!1),W(!1);break;case"translation_chunk":l(F=>F.length===0?c.chunk.trimStart():F+c.chunk);break;case"translation_done":{const F=q.current?i:d,U=q.current?d:i,H={id:Date.now(),inputText:o,translatedText:c.result,sourceLang:F,targetLang:U};B(Xe=>{const ze=[H,...Xe].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(ze)),ze}),m(!1);break}case"translation_error":j(t("notifications.translationFailed",{errorMessage:c.error}),"error"),m(!1);break;case"translation_cancelled":m(!1);break;case"extract_text_done":n(c.text),l(""),c.text.trim()||j(t("notifications.noTextInImage"),"error"),m(!1);break;case"extract_text_error":j(t("notifications.imageProcessingFailed",{errorMessage:c.error}),"error"),n(""),m(!1);break;case"transcribe_done":y(!1);const k=((b=c.text)==null?void 0:b.trim())||"";m(!1),k?(n(k),Kt&&(ct(!1),Oe(k))):(n(t("notifications.transcriptionFailedEmpty")),ct(!1));break;case"transcribe_error":y(!1);const M=c.error||"Unknown transcription error.";j(t("notifications.transcriptionFailed",{errorMessage:M}),"error"),n(t("notifications.transcriptionFailed",{errorMessage:M})),m(!1),ct(!1);break}}},[t,j,o,d,i,Kt,Oe,q]);const wa=s.useRef(Oe);s.useEffect(()=>{wa.current=Oe},[Oe]);const ut=s.useCallback(async()=>{const g={};for(const h of Ye)g[h.id]=await La(h.id);return g},[]),xa=s.useCallback(g=>{const{type:h,payload:c}=g.data;switch(h){case"progress":(c.status==="progress"||c.status==="download")&&it({file:c.file,progress:c.progress});break;case"error":j(c,"error"),n(t("notifications.transcriptionFailed",{errorMessage:c})),De(!1),y(!1);break;case"loaded":qe(!0),De(!1),ut().then(rt);break;case"unloaded":qe(!1),j(t("notifications.asrModelUnloaded"),"info");break;case"transcription-partial":n(c);break;case"transcription":y(!1);const b=(c||"").trim();b?(n(b),q.current&&(wa.current(b),q.current=!1)):(n(t("notifications.transcriptionFailedEmpty")),q.current=!1);break;case"log":console.log("[ASR Worker]:",c);break}},[j,ut,t]),ya=s.useCallback(()=>{D.current&&D.current.terminate();const g=new Worker(new URL("/Gemini-AI-Translator/assets/asr.worker-CWoSFOAw.js",import.meta.url),{type:"module"});g.addEventListener("message",xa),D.current=g,console.log("ASR Worker initialized.")},[xa]);s.useEffect(()=>(G&&ya(),()=>{D.current&&(console.log("Cleaning up ASR worker."),D.current.terminate(),D.current=null,qe(!1),De(!1))}),[G,ya]),s.useEffect(()=>{G&&D.current&&Ke&&!ot&&!xe&&(async()=>{if(await La(Ke)){const c=Ye.find(b=>b.id===Ke);c&&(console.log(`Auto-loading cached ASR model: ${c.id}`),De(!0),it({file:"",progress:0}),D.current.postMessage({type:"load",payload:{modelId:c.id,quantization:c.quantization}}))}})()},[G,Ke,ot,xe]),s.useEffect(()=>{(async()=>{const h={};for(const c of sa)c.value&&(h[c.value]=await gt.getStatus(c.value));wt(h)})(),ut().then(h=>{rt(h)})},[ut]),s.useEffect(()=>{const g=()=>me(!0),h=()=>me(!1);return window.addEventListener("online",g),window.addEventListener("offline",h),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",h)}},[]),s.useEffect(()=>{const g=localStorage.getItem("api-key");g&&oe(g);const h=localStorage.getItem("model-name");h&&Ie(h);const c=localStorage.getItem("online-provider");c&&P(c);const b=localStorage.getItem("openai-api-url");b&&Z(b);const k=localStorage.getItem("hf-api-key");k&&Ae(k);const M=localStorage.getItem("offline-model-name");M&&Gt(M);const F=localStorage.getItem("offline-mode-enabled");F&&$e(JSON.parse(F));const U=localStorage.getItem("is-two-step-jp-cn-enabled");U&&Ne(JSON.parse(U));const H=localStorage.getItem("tts-enabled");H&&Me(JSON.parse(H));const Xe=localStorage.getItem("tts-voice-uri");Xe&&bt(Xe);const ze=localStorage.getItem("tts-rate");ze&&Jt(JSON.parse(ze));const Lt=localStorage.getItem("tts-pitch");Lt&&et(JSON.parse(Lt));const Nt=localStorage.getItem("offline-max-tokens");Nt&&at(JSON.parse(Nt));const Rt=localStorage.getItem("offline-top-k");Rt&&xt(JSON.parse(Rt));const Mt=localStorage.getItem("offline-temperature");Mt&&st(JSON.parse(Mt));const Et=localStorage.getItem("offline-random-seed");Et&&yt(JSON.parse(Et));const Tt=localStorage.getItem("offline-support-audio");Tt&&Pe(JSON.parse(Tt));const Pt=localStorage.getItem("offline-max-num-images");Pt&&vt(JSON.parse(Pt));const Dt=localStorage.getItem("is-offline-asr-enabled");Dt&&nt(JSON.parse(Dt));const Ft=localStorage.getItem("is-web-speech-api-enabled");Ft&&St(JSON.parse(Ft));const zt=localStorage.getItem("asr-model-id");zt&&jt(zt);const _t=localStorage.getItem("is-noise-cancellation-enabled");_t&&Ot(JSON.parse(_t));const Bt=localStorage.getItem("audio-gain-value");Bt&&Ve(JSON.parse(Bt));const $t=localStorage.getItem("custom-offline-models");$t&&na(JSON.parse($t));const la=localStorage.getItem("selected-ocr-model");la&&Object.prototype.hasOwnProperty.call(fa,la)&&Fe(la);try{const Zt=localStorage.getItem("translation-history");Zt&&B(JSON.parse(Zt))}catch(Zt){console.error("Failed to load translation history:",Zt)}},[]),s.useEffect(()=>{const g=()=>S(window.speechSynthesis.getVoices());window.speechSynthesis.onvoiceschanged=g,g()},[]),s.useEffect(()=>{const g=ia?J:null;if(!_||!g){(We||re)&&z.current&&(console.log("Requesting offline model unload."),z.current.postMessage({type:"unload"}));return}(async()=>{W(!0),Te(!1);try{const c=await gt.getModelAsBlob(g);if(!c)throw new Error(`Model blob for ${g} not found.`);const b={maxTokens:Ue,topK:He,temperature:Ge,randomSeed:Je,supportAudio:ge,maxNumImages:we};le().postMessage({type:"init",payload:{modelBlob:c,modelSource:g,options:b}})}catch(c){const b=c instanceof Error?c.message:t("notifications.offlineModelInitFailed");j(b,"error"),console.error("Offline model init failed (main thread):",c),Te(!1),W(!1)}})()},[ia,J,_,j,t,le,Ue,He,Ge,Je,ge,we]);const Da=s.useCallback(()=>{Xt(o)},[o,Xt]),Fa=s.useCallback(()=>{var g;_?z.current&&z.current.postMessage({type:"cancel_translation"}):(g=ne.current)==null||g.abort(),ie.current&&(ie.current.abort(),ie.current=null)},[_]),za=s.useCallback(()=>{d.code!=="auto"&&(u(i),x(d),n(r),l(o))},[d,i,o,r]),_a=s.useCallback(async g=>{if(!r)return;if(window.speechSynthesis.speaking&&(window.speechSynthesis.cancel(),pt&&(be||_e===g))){Se(!1),je(null);return}if(Se(!0),je(g),!("speechSynthesis"in window)){Se(!1),je(null);return}const h=new SpeechSynthesisUtterance(r);if(h.lang=i.code,be){const c=Re.find(b=>b.voiceURI===Ee);c&&(h.voice=c),h.rate=Be,h.pitch=Qe}else{const c=Re.filter(b=>b.lang.startsWith(i.code));if(c.length>0){const b=c.find(F=>/female|women|girl|mei-jia|zira|ayumi|kyoko/i.test(F.name)),k=c.find(F=>/male|men|boy|liang|ichiro/i.test(F.name));let M;g==="female"?M=b||c.find(F=>F!==k)||c[0]:M=k||c.find(F=>F!==b)||c[0],h.voice=M}}h.onstart=()=>{Se(!0),je(be?null:g)},h.onend=()=>{Se(!1),je(null)},h.onerror=c=>{console.error("SpeechSynthesisUtterance.onerror",c),j(t("notifications.speechError",{error:c.error}),"error"),Se(!1),je(null)},window.speechSynthesis.speak(h)},[r,i,Re,pt,_e,j,be,Ee,Be,Qe,t,fe,A,E]),Yt=()=>{se.current&&se.current.state==="recording"&&se.current.stop(),ie.current&&(ie.current.abort(),ie.current=null)},ft=g=>{v||O||navigator.mediaDevices.getUserMedia({audio:!0}).then(h=>{At.current=[],Vt.current=g;const c=new MediaRecorder(h);se.current=c,c.ondataavailable=b=>{b.data.size>0&&At.current.push(b.data)},c.onstop=()=>{var M;const b=((M=se.current)==null?void 0:M.mimeType)||"audio/webm",k=new Blob(At.current,{type:b});Vt.current&&Vt.current(k),h.getTracks().forEach(F=>F.stop()),se.current=null,Vt.current=null,C(!1),T(!1)},c.onerror=b=>{j(`Recording error: ${b.error.message}`,"error"),C(!1),T(!1)},c.start()}).catch(h=>{j(`Could not start recording: ${h.message}`,"error"),C(!1),T(!1)})},Ba=s.useCallback((g,h)=>{n(g),h&&q.current&&(Oe(g),q.current=!1)},[Oe]),$a=s.useCallback(g=>{j(t("notifications.speechRecognitionError",{error:g}),"error")},[j,t]),Wa=s.useCallback(()=>{C(!1),T(!1),q.current=!1},[]),Ua=s.useCallback(()=>{},[]),pe=Ws({onResult:Ba,onError:$a,onStart:Ua,onEnd:Wa}),va=s.useCallback(()=>{se.current&&se.current.state==="recording"?se.current.stop():pe.isListening&&pe.stopRecognition()},[pe]);s.useEffect(()=>(v||O?(It(30),he.current=window.setInterval(()=>{It(g=>g!==null&&g<=1?(he.current&&(clearInterval(he.current),he.current=null),va(),null):g!==null?g-1:null)},1e3)):(he.current&&(clearInterval(he.current),he.current=null),It(null)),()=>{he.current&&clearInterval(he.current)}),[v,O,va]);const Ha=s.useCallback(()=>{if(v||!G&&Q&&pe.isListening&&!q.current)G||!Q?Yt():pe.stopRecognition();else{if(O&&Yt(),d.code==="auto"&&(G||!Q)){j(t("notifications.selectLanguageError"),"info");return}l(""),C(!0),n(t("translationInput.placeholderListening")),G?ft(async h=>{n(t("notifications.transcribing")),y(!0);try{const c=await Qt(h,{noiseSuppression:ye,gain:Ce});if(D.current)D.current.postMessage({type:"transcribe",payload:{audio:c,asrLanguage:d.asrCode,promptLanguage:d.code}});else throw new Error("ASR Worker is not initialized.")}catch(c){console.error(c),n(""),y(!1);const b=c instanceof Error?c.message:"Transcription failed.";j(b,"error")}}):Q?pe.startRecognition(d.code):_&&ge?ce?(n(t("notifications.transcribing")),y(!0),ft(async h=>{const c=await Qt(h),b=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),k=b.createBuffer(1,c.length,16e3);k.copyToChannel(c,0);const M=Ra(k);await b.close(),le().postMessage({type:"transcribe",payload:{audioData:M,sourceLang:a.t(d.name,{lng:"en"})}})})):(j(t("notifications.offlineModelNotReadyRecording"),"error"),C(!1)):ft(async h=>{n(t("notifications.transcribingApi"));const c=new AbortController;ie.current=c;try{let b="";if(A==="openai"){const k=d.code.split("-")[0];b=await Aa(h,k,E,N,c.signal)}else{const k=t(d.name,{lng:"en"});b=await Oa(h,k,E,$,c.signal)}n(b)}catch(b){if(b instanceof DOMException&&b.name==="AbortError")return;const k=b instanceof Error?b.message:"Transcription failed.";j(k,"error"),n("")}finally{ie.current=null}})}},[v,O,j,t,d,G,pe,ye,Ce,Q,A,E,N,$,_,ce,ge,le,a]),Ga=s.useCallback(()=>{if(O||!G&&Q&&pe.isListening&&q.current)G||!Q?Yt():pe.stopRecognition();else{if(v&&Yt(),i.code==="auto"){j(t("notifications.astSelectLanguage"),"info");return}n(""),l(""),T(!0),q.current=!0,G?ft(async h=>{n(t("notifications.transcribing")),y(!0);try{const c=await Qt(h,{noiseSuppression:ye,gain:Ce});if(D.current)D.current.postMessage({type:"transcribe",payload:{audio:c,asrLanguage:i.asrCode,promptLanguage:i.code}});else throw new Error("ASR Worker is not initialized.")}catch(c){console.error(c),n(""),y(!1),q.current=!1;const b=c instanceof Error?c.message:"Transcription failed.";j(b,"error")}}):Q?pe.startRecognition(i.code):_&&ge?ce?(ct(!0),n(t("notifications.transcribing")),y(!0),ft(async h=>{const c=await Qt(h),b=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),k=b.createBuffer(1,c.length,16e3);k.copyToChannel(c,0);const M=Ra(k);await b.close(),le().postMessage({type:"transcribe",payload:{audioData:M,sourceLang:a.t(i.name,{lng:"en"})}})})):(j(t("notifications.offlineModelNotReadyRecording"),"error"),T(!1),q.current=!1):ft(async h=>{n(t("notifications.transcribingApi"));const c=new AbortController;ie.current=c;try{let b="";if(A==="openai"){const k=i.code.split("-")[0];b=await Aa(h,k,E,N,c.signal)}else{const k=t(i.name,{lng:"en"});b=await Oa(h,k,E,$,c.signal)}n(b),b.trim()&&Oe(b)}catch(b){if(b instanceof DOMException&&b.name==="AbortError")return;const k=b instanceof Error?b.message:"Transcription failed.";j(k,"error"),n("")}finally{ie.current=null,q.current=!1}})}},[O,v,i,j,t,G,pe,ye,Ce,Q,A,E,N,$,_,ge,ce,le,Oe,a]),Ja=s.useCallback(async g=>{R(!1),m(!0),n(t("notifications.processingImage")),l("");try{if(dt==="ready"){const h=new Image;h.src=g,await new Promise((k,M)=>{h.onload=()=>k(),h.onerror=F=>M(F)});const c=await ke(h);if(!c)throw new Error("OCR recognition returned no data.");const b=qs(c.result);n(b),b.trim()?await Xt(b):(j(t("notifications.noTextInImage"),"info"),l(""),m(!1));return}if(_){if(!ce||we<1)throw new Error(t("notifications.offlineImageError"));const h=await new Promise((b,k)=>{const M=new Image;M.onload=()=>createImageBitmap(M).then(b).catch(k),M.onerror=()=>k(new Error("Failed to load image for bitmap.")),M.src=g});le().postMessage({type:"extractText",payload:{imageBitmap:h}},[h])}else{if(!fe)throw new Error(t("notifications.offlineImageTranslateError"));let h;const c=a.t(i.name,{lng:"en"});if(A==="openai"){if(!E)throw new Error("OpenAI API Key is not set.");if(!N)throw new Error("OpenAI API URL is not set.");h=await Fs(g,c,E,$,N)}else{if(!E)throw new Error("Gemini API Key is not set.");h=await Ds(g,c,E,$)}n(h.sourceText),l(h.translatedText);const b={id:Date.now(),inputText:h.sourceText,translatedText:h.translatedText,sourceLang:d,targetLang:i};B(k=>{const M=[b,...k].slice(0,50);return localStorage.setItem("translation-history",JSON.stringify(M)),M}),m(!1)}}catch(h){const c=h instanceof Error?h.message:"An unknown error occurred.";j(t("notifications.imageProcessingFailed",{errorMessage:c}),"error"),n(""),m(!1)}},[_,ce,we,fe,E,$,i,d,j,A,N,t,a,le,dt,ke,Xt]),Ka=(g,h,c,b,k,M,F,U,H,Xe,ze,Lt,Nt,Rt,Mt,Et,Tt,Pt,Dt,Ft,zt,_t,Bt,$t)=>{oe(g),Ie(h),P(H),Z(Xe),Ae(c),Gt(b),jt(k),$e(M),nt(F),St(U),Ne(Mt),Me(ze),bt(Lt),Jt(Nt),et(Rt),at(Et),xt(Tt),st(Pt),yt(Dt),Pe(Ft),vt(zt),Ot(_t),Ve(Bt),Fe($t),localStorage.setItem("api-key",g),localStorage.setItem("model-name",h),localStorage.setItem("online-provider",H),localStorage.setItem("openai-api-url",Xe),localStorage.setItem("hf-api-key",c),localStorage.setItem("offline-model-name",b),localStorage.setItem("asr-model-id",k),localStorage.setItem("offline-mode-enabled",JSON.stringify(M)),localStorage.setItem("is-offline-asr-enabled",JSON.stringify(F)),localStorage.setItem("is-web-speech-api-enabled",JSON.stringify(U)),localStorage.setItem("is-two-step-jp-cn-enabled",JSON.stringify(Mt)),localStorage.setItem("tts-enabled",JSON.stringify(ze)),localStorage.setItem("tts-voice-uri",Lt),localStorage.setItem("tts-rate",JSON.stringify(Nt)),localStorage.setItem("tts-pitch",JSON.stringify(Rt)),localStorage.setItem("offline-max-tokens",JSON.stringify(Et)),localStorage.setItem("offline-top-k",JSON.stringify(Tt)),localStorage.setItem("offline-temperature",JSON.stringify(Pt)),localStorage.setItem("offline-random-seed",JSON.stringify(Dt)),localStorage.setItem("offline-support-audio",JSON.stringify(Ft)),localStorage.setItem("offline-max-num-images",JSON.stringify(zt)),localStorage.setItem("is-noise-cancellation-enabled",JSON.stringify(_t)),localStorage.setItem("audio-gain-value",JSON.stringify(Bt)),localStorage.setItem("selected-ocr-model",$t)},qa=g=>{n(g.inputText),l(g.translatedText),u(g.sourceLang),x(g.targetLang),K(!1)},Va=()=>{B([]),localStorage.removeItem("translation-history")},mt=s.useCallback((g,h)=>{wt(c=>({...c,[g]:h}))},[]),Xa=s.useCallback((g,h)=>{gt.startDownload(g,h,ue,c=>mt(g,c))},[ue,mt]),Ya=s.useCallback((g,h)=>{gt.resumeDownload(g,h,ue,c=>mt(g,c))},[ue,mt]),Za=s.useCallback(g=>{gt.pauseDownload(g)},[]),Qa=s.useCallback(async g=>{await gt.deleteModel(g),mt(g,{downloaded:0,total:0,percent:0,status:"not_started"})},[mt]),es=s.useCallback(async g=>{if(xe||!D.current)return;const h=Ye.find(c=>c.id===g);if(!h){j(`ASR model ${g} not found.`,"error");return}De(!0),it({file:"",progress:0}),D.current.postMessage({type:"load",payload:{modelId:h.id,quantization:h.quantization}})},[xe,j]),ts=s.useCallback(async()=>{try{D.current&&(D.current.terminate(),D.current=null),qe(!1),await $s(),ut().then(rt),j(t("notifications.asrModelDeleted"),"success")}catch(g){const h=g instanceof Error?g.message:"Unknown error";j(h,"error")}},[ut,j,t]);return e.jsxs("div",{className:"bg-slate-100 h-full flex flex-col",children:[e.jsxs("div",{className:"w-full h-full max-w-6xl mx-auto flex-grow flex flex-col landscape:flex-row p-2 landscape:p-4 gap-4",children:[e.jsx("main",{className:"flex-1 landscape:h-full flex flex-col min-h-0 min-w-0",children:e.jsx(Rs,{translatedText:r,targetLang:i,setTargetLang:x,isLoading:w,onSpeak:_a,onSwapLanguages:za,onOpenHistory:()=>K(!0),onClearText:()=>l(""),isOfflineModeEnabled:_,isOfflineModelInitializing:re,isOfflineModelReady:ce,offlineModelName:J,isSpeaking:pt,speakingGender:_e,onlineProvider:A,isOfflineTtsEnabled:be,isAstRecording:O,onToggleAstRecording:Ga,recordingCountdown:lt})}),e.jsx("div",{className:"flex-1 landscape:h-full flex flex-col min-h-0 min-w-0",children:e.jsx(Ns,{inputText:o,setInputText:n,sourceLang:d,setSourceLang:u,isLoading:w||re||xe||dt==="initializing"||p,onTranslate:Da,onCancel:Fa,isRecording:v,onToggleRecording:Ha,onOpenCamera:()=>R(!0),onOpenSettings:()=>ee(!0),isOnline:fe,isOfflineModeEnabled:_,isOfflineModelReady:ce,recordingCountdown:lt})})]}),te&&e.jsx("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 px-4 py-3 rounded z-20 shadow-lg text-white ${te.type==="error"?"bg-red-500":te.type==="success"?"bg-green-500":"bg-blue-500"}`,role:"alert",children:te.message}),L&&e.jsx(Ms,{onClose:()=>R(!1),onImageCaptured:Ja}),e.jsx(Es,{isOpen:X,onClose:()=>ee(!1),onSave:Ka,currentApiKey:E,currentModelName:$,currentOnlineProvider:A,currentOpenaiApiUrl:N,currentHuggingFaceApiKey:ue,currentOfflineModelName:J,currentIsOfflineModeEnabled:_,currentIsTwoStepJpCnEnabled:Le,downloadProgress:tt,onStartDownload:Xa,onResumeDownload:Ya,onPauseDownload:Za,onDeleteModel:Qa,isOfflineModelInitializing:re,voices:Re,targetLang:i,currentIsOfflineTtsEnabled:be,currentOfflineTtsVoiceURI:Ee,currentOfflineTtsRate:Be,currentOfflineTtsPitch:Qe,currentOfflineMaxTokens:Ue,currentOfflineTopK:He,currentOfflineTemperature:Ge,currentOfflineRandomSeed:Je,currentOfflineSupportAudio:ge,currentOfflineMaxNumImages:we,currentIsOfflineAsrEnabled:G,currentIsWebSpeechApiEnabled:Q,currentAsrModelId:Ke,currentIsNoiseCancellationEnabled:ye,currentAudioGainValue:Ce,asrModelsCacheStatus:Ct,isAsrInitializing:xe,asrLoadingProgress:kt,onDownloadAsrModel:es,onClearAsrCache:ts,ocrEngineStatus:dt,ocrEngineError:oa,onInitializeOcr:qt,currentSelectedOcrModel:ra}),e.jsx(Ts,{isOpen:Y,onClose:()=>K(!1),history:de,onSelectHistory:qa,onClearHistory:Va})]})},Xs={en:{translation:{languages:{autoDetect:"Auto Detect",english:"English",chineseTraditional:"Chinese (Traditional)",chineseTraditionalHK:"Chinese (Traditional) HK",chineseSimplified:"Chinese (Simplified)",spanish:"Spanish",japanese:"Japanese",french:"French",german:"German",korean:"Korean",russian:"Russian",portuguese:"Portuguese",italian:"Italian"},translationInput:{online:"Online",offline:"Offline",cameraAriaLabel:"Translate from camera",settingsAriaLabel:"Open settings",placeholderListening:"Listening...",placeholderEnterText:"Enter text to translate",clearText:"Clear text",countdownPrefix:"0:",recordingStop:"Stop recording",recordingStart:"Start recording",cancelTranslation:"Cancel Translation",translateOffline:"Translate using offline model",translate:"Translate",countdown:"Time left: {{seconds}}s"},translationOutput:{modeOnline:"Mode: Online ({{provider}})",modeOfflineInitializing:"Mode: Offline ({{modelName}}) - Initializing...",modeOfflineReady:"Mode: Offline ({{modelName}})",modeOfflineNotReady:"Mode: Offline ({{modelName}}) - Model not ready",modeOfflineNoModel:"Mode: Offline - No model selected",flipScreenAriaLabel:"Flip screen",copyAriaLabel:"Copy translated text",historyAriaLabel:"View translation history",clearAriaLabel:"Clear translated text",placeholder:"Translation",speakStop:"Stop speaking",speakCustomVoice:"Speak with custom voice",speakFemale:"Speak with female voice",speakMale:"Speak with male voice",astStop:"Stop speech translation",astStart:"Start speech translation",astTitle:"Automatic Speech Translation"},settings:{title:"Settings",closeAriaLabel:"Close settings",tabOnline:"Online",tabOffline:"Offline AI",tabSpeech:"Speech",tabTts:"Offline TTS",tabOfflineParams:"Offline Params",tabOcr:"PaddleOCR",subTabModels:"LLM Models",subTabParameters:"Model Parameters",providerLabel:"Provider",providerGemini:"Gemini",providerOpenAI:"OpenAI",openaiUrlLabel:"OpenAI API URL",openaiUrlPlaceholder:"e.g., https://api.openai.com",apiKeyLabel:"API Key",apiKeyPlaceholder:"Enter your Gemini or OpenAI API Key",modelNameLabel:"Model Name",modelNameGeminiPlaceholder:"e.g., gemini-2.5-flash",modelNameOpenAIPlaceholder:"e.g., gpt-4o",hfApiKeyLabel:"Hugging Face API Key",hfApiKeyPlaceholder:"Required to download models",hfApiKeyDescription:"A key is required for model downloads from Hugging Face.",manageModelsLabel:"Select & Download Offline LLM Model",addCustomModelTitle:"Add Custom Model",customModelUrlLabel:"Hugging Face Model URL",customModelUrlPlaceholder:"e.g., https://huggingface.co/org/repo",customModelLibUrlLabel:"Model Library URL (.wasm)",customModelLibUrlPlaceholder:"e.g., https://.../lib.wasm",addCustomModelButton:"Download and Use Custom Model",asrModelLabel:"Select & Download Offline Speech Recognition Model (ASR)",ocrModelLabel:"Select OCR Model",initializeOcr:"Initialize OCR Engine",switchOcr:"Switch/Reload OCR Model",download:"Download",pause:"Pause",resume:"Resume",retry:"Retry",deleteModelAriaLabel:"Delete {{modelName}}",modelCached:"Cached",modelDownload:"Download",modelDownloading:"Downloading...",statusInitializing:"Initializing...",statusError:"Error: {{error}}",enableOfflineLabel:"Enable Offline Translation",enableOfflineDescription:"Use local model for translations.",enableWebSpeechLabel:"Web Speech API",enableWebSpeechDescription:"Use browser's built-in recognition (Online).",enableOfflineAsrLabel:"Offline ASR (Whisper)",enableOfflineAsrDescription:"Use local Whisper model. Works with Online & Offline translation.",enableGemmaAudioLabel:"Gemma 3N Native Audio",enableGemmaAudioDescription:"Use LLM's native audio capability. Requires Offline Translation Mode.",enableTwoStepLabel:"High-Accuracy JP→ZH Mode",enableTwoStepDescription:"Improves Japanese to Chinese translation via English.",audioProcessingLabel:"Audio Processing (Whisper)",enableNoiseCancellationLabel:"Noise Cancellation",enableNoiseCancellationDescription:"Reduce background noise.",audioGainLabel:"Microphone Gain",clearCacheButton:"Clear LLM Cache",clearCacheDescription:"Remove all downloaded LLM models.",clearAsrCacheButton:"Clear ASR Cache",ttsSettingsLabel:"Text-to-Speech (TTS) Settings",enableCustomTtsLabel:"Enable Custom Offline TTS",enableCustomTtsDescription:"Customize the voice for text-to-speech.",voiceLabel:"Voice",voicePlaceholder:"No voices available for {{languageName}}",rateLabel:"Rate",pitchLabel:"Pitch",offlineParamsDescription:"Advanced parameters for the local offline model. Changes will require the model to be re-initialized.",maxTokensLabel:"Max Tokens",topKLabel:"Top K",temperatureLabel:"Temperature",randomSeedLabel:"Random Seed",supportAudioLabel:"Enable Audio Input (Gemma)",supportAudioDescription:"Allows the model to process audio files.",maxNumImagesLabel:"Enable Image Input (for OCR)",maxNumImagesDescription:"Allows the model to process one image.",clearSettingsButton:"Clear All Settings",saveSettingsButton:"Save Settings",languageLabel:"UI Language",clearAllAriaLabel:"Clear all settings and cached models"},history:{title:"Translation History",closeAriaLabel:"Close history",empty:"No history yet.",selectAriaLabel:"Select translation from {{sourceLang}} to {{targetLang}}",clearAriaLabel:"Clear all translation history",clearButton:"Clear History"},camera:{title:"Camera Translation View",closeAriaLabel:"Close camera view",errorAccess:"Could not access the camera. Please ensure permissions are granted.",errorCapture:"Failed to capture image: {{message}}",errorLoad:"Failed to load image: {{message}}",zoomAriaLabel:"Zoom camera",galleryAriaLabel:"Import from gallery",captureAriaLabel:"Capture and process image",processingAriaLabel:"Processing image",flashOffAriaLabel:"Turn on flash",flashOnAriaLabel:"Turn off flash"},notifications:{offlineModelInitSuccess:"Offline model {{modelIdentifier}} initialized successfully.",offlineModelInitFailed:"Failed to load offline model.",translationFailed:"Translation Failed: {{errorMessage}}",speechError:"Speech synthesis error: {{error}}",speechRecognitionError:"Speech recognition error: {{error}}",mediaRecorderUnsupported:"MediaRecorder API is not supported in this browser.",processingAudio:"[Processing audio...]",noAudioRecorded:"No audio was recorded.",transcriptionFailed:"Transcription Failed: {{errorMessage}}",transcriptionFailedEmpty:"Transcription failed or no speech was detected. Please try again.",micPermissionError:"Could not start recording. Please grant microphone permissions.",offlineModelNotReadyRecording:"Offline model is not ready for recording.",offlineSRError:"You are offline. Cannot use online speech recognition.",astFailed:"AST Failed: {{errorMessage}}",astSelectLanguage:"Please select a source language before using speech translation.",astOfflineModelNotReady:"Offline model is not ready for speech translation.",astOfflineError:"You are offline. Cannot use online speech translation.",processingImage:"[Processing image...]",offlineImageError:"Offline model is not ready for image processing.",noTextInImage:"No text found in the image.",offlineImageTranslateError:"You are offline. Cannot use online image translation.",imageProcessingFailed:"Image Processing Failed: {{errorMessage}}",offlineFeatureUnavailable:"This feature is not available in offline mode.",cacheCleared:"Offline model cache has been cleared successfully.",downloadInProgress:"A model is already being downloaded. Please wait.",modelDownloaded:"Model {{modelId}} downloaded successfully.",modelDeleted:"Model {{modelId}} deleted successfully.",customModelUrlError:"Please provide both the model URL and the model library URL.",customModelSelected:"Custom model has been selected.",cacheClearError:"Please enable offline mode and select a model before clearing the cache.",transcribing:"[Transcribing...]",transcribingApi:"[Transcribing via API...]",asrReady:"Speech recognition model is ready.",asrFailed:"Failed to initialize speech recognition model: {{error}}",asrModelDeleted:"ASR model cache cleared successfully.",asrModelUnloaded:"Offline speech model unloaded successfully.",asrOnlineUnavailable:"Offline ASR is only available in Offline Translation Mode.",modelIdleUnloaded:"Offline model unloaded due to inactivity to save resources. It will reload on next use.",ocrNotReady:"OCR engine not ready. Please initialize it in Settings > PaddleOCR v5."},common:{status:{not_started:"Not Started",downloading:"Downloading",paused:"Paused",completed:"Completed",error:"Error",consolidating:"Consolidating...",initializing:"Initializing..."}}}},"zh-TW":{translation:{languages:{autoDetect:"自動偵測",english:"英文",chineseTraditional:"繁體中文",chineseTraditionalHK:"繁體中文 (香港)",chineseSimplified:"簡體中文",spanish:"西班牙文",japanese:"日文",french:"法文",german:"德文",korean:"韓文",russian:"俄文",portuguese:"葡萄牙文",italian:"義大利文"},translationInput:{online:"線上",offline:"離線",cameraAriaLabel:"使用相機翻譯",settingsAriaLabel:"開啟設定",placeholderListening:"正在聆聽...",placeholderEnterText:"輸入要翻譯的文字",clearText:"清除文字",countdownPrefix:"0:",recordingStop:"停止錄音",recordingStart:"開始錄音",cancelTranslation:"取消翻譯",translateOffline:"使用離線模型翻譯",translate:"翻譯",countdown:"剩餘時間：{{seconds}}秒"},translationOutput:{modeOnline:"模式：線上 ({{provider}})",modeOfflineInitializing:"模式：離線 ({{modelName}}) - 初始化中...",modeOfflineReady:"模式：離線 ({{modelName}})",modeOfflineNotReady:"模式：離線 ({{modelName}}) - 模型未就緒",modeOfflineNoModel:"模式：離線 - 未選擇模型",flipScreenAriaLabel:"翻轉螢幕",copyAriaLabel:"複製翻譯結果",historyAriaLabel:"檢視翻譯歷史",clearAriaLabel:"清除翻譯結果",placeholder:"翻譯結果",speakStop:"停止朗讀",speakCustomVoice:"使用自訂語音朗讀",speakFemale:"使用女聲朗讀",speakMale:"使用男聲朗讀",astStop:"停止語音翻譯",astStart:"開始語音翻譯",astTitle:"即時語音翻譯"},settings:{title:"設定",closeAriaLabel:"關閉設定",tabOnline:"線上",tabOffline:"離線AI",tabSpeech:"語音",tabTts:"離線 TTS",tabOfflineParams:"離線參數",tabOcr:"PaddleOCR",subTabModels:"LLM 模型",subTabParameters:"模型參數",providerLabel:"服務提供商",providerGemini:"Gemini",providerOpenAI:"OpenAI",openaiUrlLabel:"OpenAI API URL",openaiUrlPlaceholder:"例如：https://api.openai.com",apiKeyLabel:"API 金鑰",apiKeyPlaceholder:"輸入您的 Gemini 或 OpenAI API 金鑰",modelNameLabel:"模型名稱",modelNameGeminiPlaceholder:"例如：gemini-2.5-flash",modelNameOpenAIPlaceholder:"例如：gpt-4o",hfApiKeyLabel:"Hugging Face API 金鑰",hfApiKeyPlaceholder:"下載模型需要金鑰",hfApiKeyDescription:"從 Hugging Face 下載模型需要金鑰。",manageModelsLabel:"選擇並下載離線 LLM 模型",addCustomModelTitle:"新增自訂模型",customModelUrlLabel:"Hugging Face 模型 URL",customModelUrlPlaceholder:"例如：https://huggingface.co/org/repo",customModelLibUrlLabel:"模型庫 URL (.wasm)",customModelLibUrlPlaceholder:"例如：https://.../lib.wasm",addCustomModelButton:"下載並使用自訂模型",asrModelLabel:"選擇並下載離線語音辨識模型 (ASR)",ocrModelLabel:"選擇 OCR 模型",initializeOcr:"初始化 OCR 引擎",switchOcr:"切換/重載 OCR 模型",modelCached:"已快取",modelDownload:"下載",modelDownloading:"下載中...",deleteModelAriaLabel:"刪除 {{modelName}}",download:"下載",pause:"暫停",resume:"繼續",retry:"重試",statusInitializing:"初始化中...",statusError:"錯誤：{{error}}",enableOfflineLabel:"啟用離線翻譯",enableOfflineDescription:"使用本機模型進行翻譯。",enableWebSpeechLabel:"Web Speech API",enableWebSpeechDescription:"使用瀏覽器內建辨識 (線上)。",enableOfflineAsrLabel:"離線 ASR (Whisper)",enableOfflineAsrDescription:"使用本機 Whisper 模型。可搭配線上或離線翻譯。",enableGemmaAudioLabel:"Gemma 3N 原生音訊",enableGemmaAudioDescription:"使用 LLM 原生音訊能力。僅限離線翻譯模式。",enableTwoStepLabel:"高準確度 日→中 模式",enableTwoStepDescription:"透過英文中轉，提升日文到中文的翻譯品質。",audioProcessingLabel:"音訊處理 (Whisper)",enableNoiseCancellationLabel:"降噪",enableNoiseCancellationDescription:"減少背景噪音。",audioGainLabel:"麥克風增益",clearCacheButton:"清除 LLM 快取",clearCacheDescription:"移除所有已下載的 LLM 模型。",clearAsrCacheButton:"清除 ASR 快取",ttsSettingsLabel:"文字轉語音 (TTS) 設定",enableCustomTtsLabel:"啟用自訂離線 TTS",enableCustomTtsDescription:"自訂文字轉語音的聲音。",voiceLabel:"語音",voicePlaceholder:"沒有適用於 {{languageName}} 的語音",rateLabel:"速率",pitchLabel:"音高",offlineParamsDescription:"進階離線模型參數。更改後模型需要重新初始化。",maxTokensLabel:"最大權杖數 (Max Tokens)",topKLabel:"Top K",temperatureLabel:"溫度 (Temperature)",randomSeedLabel:"隨機種子 (Random Seed)",supportAudioLabel:"啟用音訊輸入 (Gemma)",supportAudioDescription:"允許模型處理音訊檔案。",maxNumImagesLabel:"啟用圖片輸入 (用於文字擷取)",maxNumImagesDescription:"允許模型處理一張圖片。",clearSettingsButton:"清除所有設定",saveSettingsButton:"儲存設定",languageLabel:"介面語言",clearAllAriaLabel:"清除所有設定和快取模型"},history:{title:"翻譯歷史",closeAriaLabel:"關閉歷史紀錄",empty:"尚無歷史紀錄。",selectAriaLabel:"選擇從 {{sourceLang}} 到 {{targetLang}} 的翻譯",clearAriaLabel:"清除所有翻譯歷史",clearButton:"清除歷史"},camera:{title:"相機翻譯畫面",closeAriaLabel:"關閉相機畫面",errorAccess:"無法存取相機。請確認已授予權限。",errorCapture:"擷取影像失敗：{{message}}",errorLoad:"載入影像失敗：{{message}}",zoomAriaLabel:"縮放相機",galleryAriaLabel:"從相簿匯入",captureAriaLabel:"擷取並處理影像",processingAriaLabel:"正在處理影像",flashOffAriaLabel:"開啟閃光燈",flashOnAriaLabel:"關閉閃光燈"},notifications:{offlineModelInitSuccess:"離線模型 {{modelIdentifier}} 初始化成功。",offlineModelInitFailed:"載入離線模型失敗。",translationFailed:"翻譯失敗：{{errorMessage}}",speechError:"語音合成錯誤：{{error}}",speechRecognitionError:"語音辨識錯誤：{{error}}",mediaRecorderUnsupported:"此瀏覽器不支援 MediaRecorder API。",processingAudio:"[正在處理音訊...]",noAudioRecorded:"未錄製到任何音訊。",transcriptionFailed:"語音轉文字失敗：{{errorMessage}}",transcriptionFailedEmpty:"語音轉文字失敗或未偵測到語音，請重試。",micPermissionError:"無法開始錄音。請授予麥克風權限。",offlineModelNotReadyRecording:"離線模型尚未準備好進行錄音。",offlineSRError:"您處於離線狀態，無法使用線上語音辨識。",astFailed:"語音翻譯失敗：{{errorMessage}}",astSelectLanguage:"使用語音翻譯前，請先選擇來源語言。",astOfflineModelNotReady:"離線模型尚未準備好進行語音翻譯。",astOfflineError:"您處於離線狀態，無法使用線上語音翻譯。",processingImage:"[正在處理影像...]",offlineImageError:"離線模型尚未準備好進行影像處理。",noTextInImage:"影像中未找到文字。",offlineImageTranslateError:"您處於離線狀態，無法使用線上影像翻譯。",imageProcessingFailed:"影像處理失敗：{{errorMessage}}",offlineFeatureUnavailable:"此功能在離線模式下不可用。",cacheCleared:"已成功清除離線模型快取。",downloadInProgress:"已有模型正在下載，請稍候。",modelDownloaded:"模型 {{modelId}} 下載成功。",modelDeleted:"模型 {{modelId}} 刪除成功。",customModelUrlError:"請同時提供模型 URL 和模型庫 URL。",customModelSelected:"已選擇自訂模型。",cacheClearError:"請先啟用離線模式並選擇一個模型，然後再清除快取。",transcribing:"[語音轉換文字中...]",transcribingApi:"[透過 API 轉換語音中...]",asrReady:"語音辨識模型已就緒。",asrFailed:"語音辨識模型初始化失敗：{{error}}",asrModelDeleted:"ASR 模型快取已清除成功。",asrModelUnloaded:"離線語音模型已成功卸載。",asrOnlineUnavailable:"離線 ASR 僅在離線翻譯模式下可用。",modelIdleUnloaded:"離線模型因閒置而卸載以節省資源，下次使用時將自動重新載入。",ocrNotReady:"OCR 引擎尚未就緒。請在 設定 > PaddleOCR v5 中進行初始化。"},common:{status:{not_started:"未開始",downloading:"下載中",paused:"已暫停",completed:"已完成",error:"錯誤",consolidating:"整合中...",initializing:"初始化中..."}}}}};cs.use(ds).use(us).init({resources:Xs,fallbackLng:"en",debug:!0,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const Pa=document.getElementById("root");if(!Pa)throw new Error("Could not find root element to mount to");const Ys=fs.createRoot(Pa);Ys.render(e.jsx(ja.StrictMode,{children:e.jsx(ja.Suspense,{fallback:"Loading...",children:e.jsx(Vs,{})})}));
